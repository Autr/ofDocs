{"data":[{"page":{"entry":{"name":"ofQTKitMovieRenderer.h","filename":"ofQTKitMovieRenderer.h","absolute":"/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/video/ofQTKitMovieRenderer.h","path":"/openframeworks/video/ofQTKitMovieRenderer_h","route":"/openframeworks/video/ofQTKitMovieRenderer.h","dir":"../libs/openFrameworks/video","ext":"h","type":"source","id":338,"parent":323,"breadcrumbs":[323,164],"siblings":[],"translations":{}},"document":"\n<span class=\"token comment\" spellcheck=\"true\">// Copyright (c) 2012 openFrameworks team</span>\n<span class=\"token comment\" spellcheck=\"true\">// openFrameworks is released under the MIT License. See libs/_Licence.txt</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">if</span> !defined(MAC_OS_X_VERSION_10_12) || MAC_OS_X_VERSION_MAX_ALLOWED &lt; MAC_OS_X_VERSION_10_12</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> OF_VIDEO_PLAYER_QTKIT</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;Cocoa/Cocoa.h></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;Quartz/Quartz.h></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;QTKit/QTKit.h></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;OpenGL/OpenGL.h></span>\n\n\n@interface QTKitMovieRenderer <span class=\"token operator\">:</span> NSObject\n<span class=\"token punctuation\">{</span>\n\tQTMovie <span class=\"token operator\">*</span> _movie<span class=\"token punctuation\">;</span>\n\tQTVisualContextRef _visualContext<span class=\"token punctuation\">;</span>\n\n\tCVOpenGLTextureCacheRef _textureCache<span class=\"token punctuation\">;</span>\n\tCVOpenGLTextureRef _latestTextureFrame<span class=\"token punctuation\">;</span>\n\tCVPixelBufferRef _latestPixelFrame<span class=\"token punctuation\">;</span>\n\n\tNSSize movieSize<span class=\"token punctuation\">;</span>\n\tQTTime movieDuration<span class=\"token punctuation\">;</span>\n\tNSInteger frameCount<span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//\tdouble frameStep;</span>\n    QTTime lastMovieTime<span class=\"token punctuation\">;</span>\n\tBOOL frameUpdated<span class=\"token punctuation\">;</span>\n\tBOOL useTexture<span class=\"token punctuation\">;</span>\n\tBOOL usePixels<span class=\"token punctuation\">;</span>\n\tBOOL useAlpha<span class=\"token punctuation\">;</span>\n\tBOOL synchronousSeek<span class=\"token punctuation\">;</span>\n\tBOOL justSetFrame<span class=\"token punctuation\">;</span>\n\tBOOL frameIsNew<span class=\"token punctuation\">;</span>\n\tBOOL hasVideo<span class=\"token punctuation\">;</span>\n\tBOOL hasAudio<span class=\"token punctuation\">;</span>\n\tBOOL loadedFirstFrame<span class=\"token punctuation\">;</span>\n\tNSArray<span class=\"token operator\">*</span> frameTimeValues<span class=\"token punctuation\">;</span>\n\tNSCondition<span class=\"token operator\">*</span> synchronousSeekLock<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> NSSize movieSize<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> BOOL useTexture<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> BOOL usePixels<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> BOOL useAlpha<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> NSTimeInterval duration<span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">//duration in seconds</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> NSInteger frameCount<span class=\"token punctuation\">;</span>  <span class=\"token comment\" spellcheck=\"true\">//total frames</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> BOOL isFinished<span class=\"token punctuation\">;</span>  <span class=\"token comment\" spellcheck=\"true\">//returns true if the movie is not looping and over</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>readwrite<span class=\"token punctuation\">)</span> BOOL justSetFrame<span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">//this needs to be set *before* calls to _movie.setTime to allow synchronous seeking</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readwrite<span class=\"token punctuation\">)</span> BOOL synchronousSeek<span class=\"token punctuation\">;</span>\n\n\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readwrite<span class=\"token punctuation\">)</span> <span class=\"token keyword\">float</span> rate<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readwrite<span class=\"token punctuation\">)</span> <span class=\"token keyword\">float</span> volume<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> CGFloat time<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeValue<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readwrite<span class=\"token punctuation\">)</span> CGFloat position<span class=\"token punctuation\">;</span>  <span class=\"token comment\" spellcheck=\"true\">//set and get frame position by percent</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readwrite<span class=\"token punctuation\">)</span> NSInteger frame<span class=\"token punctuation\">;</span>  <span class=\"token comment\" spellcheck=\"true\">//set and get frame position by percent</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readwrite<span class=\"token punctuation\">)</span> BOOL loops<span class=\"token punctuation\">;</span>  <span class=\"token comment\" spellcheck=\"true\">//set and get loopstate</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readwrite<span class=\"token punctuation\">)</span> BOOL palindrome<span class=\"token punctuation\">;</span>  <span class=\"token comment\" spellcheck=\"true\">//set and get palindrome state</span>\n\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> BOOL textureAllocated<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> GLuint textureID<span class=\"token punctuation\">;</span>\n@<span class=\"token function\">property</span> <span class=\"token punctuation\">(</span>nonatomic<span class=\"token punctuation\">,</span> readonly<span class=\"token punctuation\">)</span> GLenum textureTarget<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>NSDictionary <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pixelBufferAttributes<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>draw<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>NSRect<span class=\"token punctuation\">)</span>drawRect<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>BOOL<span class=\"token punctuation\">)</span>loadMovie<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>NSString <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>moviePath pathIsURL<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>BOOL<span class=\"token punctuation\">)</span>isURL allowTexture<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>BOOL<span class=\"token punctuation\">)</span>useTexture allowPixels<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>BOOL<span class=\"token punctuation\">)</span>usePixels allowAlpha<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>BOOL<span class=\"token punctuation\">)</span>useAlpha<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>BOOL<span class=\"token punctuation\">)</span>update<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>bindTexture<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>unbindTexture<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//copies ARGB pixels to RGB or RGBA depending on allowAlpha</span>\n<span class=\"token comment\" spellcheck=\"true\">//outbuf must be allocated with enough space depending on movieSize</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>pixels<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>outbuf<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>setBalance<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span>balance<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>stepForward<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>stepBackward<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>gotoBeginning<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>frameAvailable<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>CVImageBufferRef<span class=\"token punctuation\">)</span>image<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>frameFailed<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>synchronizeSeek<span class=\"token punctuation\">;</span>\n\n@end\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n","type":"source","static":true}}],"fetch":[]}