{"data":[{"page":{"entry":{"name":"ofBufferObject.cpp","filename":"ofBufferObject.cpp","absolute":"/Users/gilbertsinnott/Code/openFrameworks/libs/openFrameworks/gl/ofBufferObject.cpp","path":"/openframeworks/gl/ofBufferObject_cpp","route":"/openframeworks/gl/ofBufferObject.cpp","dir":"../libs/openFrameworks/gl","ext":"cpp","type":"source","id":236,"parent":235,"breadcrumbs":[235,195],"siblings":[],"translations":{}},"document":"<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofBufferObject.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofConstants.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofAppRunner.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofPixels.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofGLUtils.h\"</span></span>\n\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> std<span class=\"token punctuation\">;</span>\n\nofBufferObject<span class=\"token operator\">::</span>Data<span class=\"token operator\">::</span><span class=\"token function\">Data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">:</span><span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">,</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">,</span><span class=\"token function\">lastTarget</span><span class=\"token punctuation\">(</span>GL_ARRAY_BUFFER<span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n<span class=\"token punctuation\">,</span><span class=\"token function\">isDSA</span><span class=\"token punctuation\">(</span><span class=\"token function\">ofIsGLProgrammableRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> GLEW_ARB_direct_state_access<span class=\"token punctuation\">)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">else</span></span>\n<span class=\"token punctuation\">,</span><span class=\"token function\">isDSA</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n<span class=\"token punctuation\">{</span>\n\t\n\t<span class=\"token comment\" spellcheck=\"true\">// tig: glGenBuffers does not actually create a buffer, it just </span>\n\t<span class=\"token comment\" spellcheck=\"true\">//      returns the next available name, and only a subsequent </span>\n\t<span class=\"token comment\" spellcheck=\"true\">//      call to bind() will actualy initialize the buffer in</span>\n\t<span class=\"token comment\" spellcheck=\"true\">//      memory. </span>\n\t<span class=\"token comment\" spellcheck=\"true\">//</span>\n\t<span class=\"token comment\" spellcheck=\"true\">//      This is why, for direct state access, we need to call</span>\n\t<span class=\"token comment\" spellcheck=\"true\">//      glCreateBuffers(), so that the buffer is initialized</span>\n\t<span class=\"token comment\" spellcheck=\"true\">//      when we pin data to it using setData()</span>\n\t<span class=\"token comment\" spellcheck=\"true\">// </span>\n\t<span class=\"token comment\" spellcheck=\"true\">//      see also: https://www.opengl.org/registry/specs/ARB/direct_state_access.txt</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>isDSA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// the above condition is only true if GLEW can provide us</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// with direct state access methods. we use this to test</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// whether the driver is OpenGL 4.5 ready.</span>\n\t\t<span class=\"token function\">glCreateBuffers</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token function\">glGenBuffers</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nofBufferObject<span class=\"token operator\">::</span>Data<span class=\"token operator\">::</span><span class=\"token operator\">~</span><span class=\"token function\">Data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">glDeleteBuffers</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">ofBufferObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\tdata <span class=\"token operator\">=</span> std<span class=\"token operator\">::</span>make_shared<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span>GLsizeiptr bytes<span class=\"token punctuation\">,</span> GLenum usage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>usage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span>GLsizeiptr bytes<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> data<span class=\"token punctuation\">,</span> GLenum usage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span>data<span class=\"token punctuation\">,</span>usage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">bool</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">isAllocated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>GLenum target<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glBindBuffer</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget <span class=\"token operator\">=</span> target<span class=\"token punctuation\">;</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span>GLenum target<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">glBindBuffer</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifndef</span> TARGET_OPENGLES</span>\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">bindBase</span><span class=\"token punctuation\">(</span>GLenum target<span class=\"token punctuation\">,</span>GLuint index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glBindBufferBase</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">,</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget <span class=\"token operator\">=</span> target<span class=\"token punctuation\">;</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">unbindBase</span><span class=\"token punctuation\">(</span>GLenum target<span class=\"token punctuation\">,</span>GLuint index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">glBindBufferBase</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">bindRange</span><span class=\"token punctuation\">(</span>GLenum target<span class=\"token punctuation\">,</span>GLuint index<span class=\"token punctuation\">,</span> GLintptr offset<span class=\"token punctuation\">,</span> GLsizeiptr size<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glBindBufferRange</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">,</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">,</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget <span class=\"token operator\">=</span> target<span class=\"token punctuation\">;</span>\n\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">unbindRange</span><span class=\"token punctuation\">(</span>GLenum target<span class=\"token punctuation\">,</span>GLuint index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">glBindBufferBase</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\nGLuint ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>GLsizeiptr bytes<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> data<span class=\"token punctuation\">,</span> GLenum usage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>size <span class=\"token operator\">=</span> bytes<span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isDSA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glNamedBufferData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">,</span> bytes<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> usage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">/// --------| invariant: direct state access is not available</span>\n\t<span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">glBufferData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">,</span> bytes<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> usage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">updateData</span><span class=\"token punctuation\">(</span>GLintptr offset<span class=\"token punctuation\">,</span> GLsizeiptr bytes<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isDSA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glNamedBufferSubData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">,</span>bytes<span class=\"token punctuation\">,</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">/// --------| invariant: direct state access is not available</span>\n\n\t<span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">glBufferSubData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">,</span>bytes<span class=\"token punctuation\">,</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">updateData</span><span class=\"token punctuation\">(</span>GLsizeiptr bytes<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">updateData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>bytes<span class=\"token punctuation\">,</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifndef</span> TARGET_OPENGLES</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>GLenum access<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isDSA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">glMapNamedBuffer</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">,</span>access<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">/// --------| invariant: direct state access is not available</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// if the buffer wasn't already bound and the operation</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// is one of unpack/pack buffer alternate between the 2</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// since the tipical use is to pack to copy to the buffer</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// then unpack to copy from it.</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// for more advanced usages one can just bind the buffer</span>\n\t\t<span class=\"token comment\" spellcheck=\"true\">// before mapping</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token operator\">==</span>GL_PIXEL_PACK_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget <span class=\"token operator\">=</span> GL_PIXEL_UNPACK_BUFFER<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget <span class=\"token operator\">==</span> GL_PIXEL_UNPACK_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tdata<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget <span class=\"token operator\">=</span> GL_PIXEL_PACK_BUFFER<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">glBindBuffer</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">,</span> data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">auto</span> ret <span class=\"token operator\">=</span> <span class=\"token function\">glMapBuffer</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">,</span>access<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">unmap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isDSA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glUnmapNamedBuffer</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">/// --------| invariant: direct state access is not available</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glBindBuffer</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">,</span> data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token function\">glUnmapBuffer</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isBound<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">mapRange</span><span class=\"token punctuation\">(</span>GLintptr offset<span class=\"token punctuation\">,</span> GLsizeiptr length<span class=\"token punctuation\">,</span> GLenum access<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isDSA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">glMapNamedBufferRange</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">,</span>length<span class=\"token punctuation\">,</span>access<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">/// --------| invariant: direct state access is not available</span>\n\n\t<span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">glMapBufferRange</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>lastTarget<span class=\"token punctuation\">,</span>offset<span class=\"token punctuation\">,</span>length<span class=\"token punctuation\">,</span>access<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">unmapRange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">unmap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">copyTo</span><span class=\"token punctuation\">(</span>ofBufferObject <span class=\"token operator\">&amp;</span> dstBuffer<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isDSA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glCopyNamedBufferSubData</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">,</span>dstBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>GL_COPY_READ_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tdstBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>GL_COPY_WRITE_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">glCopyBufferSubData</span><span class=\"token punctuation\">(</span>GL_COPY_READ_BUFFER<span class=\"token punctuation\">,</span>GL_COPY_WRITE_BUFFER<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span>GL_COPY_READ_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tdstBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span>GL_COPY_WRITE_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">copyTo</span><span class=\"token punctuation\">(</span>ofBufferObject <span class=\"token operator\">&amp;</span> dstBuffer<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> readOffset<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> writeOffset<span class=\"token punctuation\">,</span> size_t size<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> GLEW_VERSION_4_5</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>isDSA<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">glCopyNamedBufferSubData</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">,</span>dstBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>readOffset<span class=\"token punctuation\">,</span>writeOffset<span class=\"token punctuation\">,</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n\t<span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>GL_COPY_READ_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tdstBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>GL_COPY_WRITE_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">glCopyBufferSubData</span><span class=\"token punctuation\">(</span>GL_COPY_READ_BUFFER<span class=\"token punctuation\">,</span>GL_COPY_WRITE_BUFFER<span class=\"token punctuation\">,</span>readOffset<span class=\"token punctuation\">,</span>writeOffset<span class=\"token punctuation\">,</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span>GL_COPY_READ_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tdstBuffer<span class=\"token punctuation\">.</span><span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span>GL_COPY_WRITE_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token keyword\">void</span> ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">glInvalidateBufferData</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">-</span><span class=\"token operator\">></span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\nGLsizeiptr ofBufferObject<span class=\"token operator\">::</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> data<span class=\"token operator\">-</span><span class=\"token operator\">></span>size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n","type":"source"}}],"fetch":[]}