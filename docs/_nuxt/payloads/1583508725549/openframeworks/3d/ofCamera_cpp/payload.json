{"data":[{"page":{"entry":{"name":"ofCamera.cpp","filename":"ofCamera.cpp","absolute":"/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/3d/ofCamera.cpp","path":"/openframeworks/3d/ofCamera_cpp","route":"/openframeworks/3d/ofCamera.cpp","dir":"../libs/openFrameworks/3d","ext":"cpp","type":"source","id":200,"parent":194,"breadcrumbs":[194,195],"siblings":[],"translations":{}},"document":"<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofCamera.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofLog.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofRectangle.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofGraphics.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofAppRunner.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ofGraphicsBaseTypes.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"glm/gtx/transform.hpp\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"glm/gtc/quaternion.hpp\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"of3dGraphics.h\"</span></span>\n\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> std<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nofCamera<span class=\"token operator\">::</span><span class=\"token function\">ofCamera</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\n<span class=\"token function\">isOrtho</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">fov</span><span class=\"token punctuation\">(</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">nearClip</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">farClip</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">lensOffset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">forceAspectRatio</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">aspectRatio</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">vFlip</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nofCamera<span class=\"token operator\">::</span><span class=\"token operator\">~</span><span class=\"token function\">ofCamera</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setFov</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> f<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfov <span class=\"token operator\">=</span> f<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setNearClip</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> f<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tnearClip <span class=\"token operator\">=</span> f<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setFarClip</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> f<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfarClip <span class=\"token operator\">=</span> f<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setLensOffset</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> glm<span class=\"token operator\">::</span>vec2 <span class=\"token operator\">&amp;</span> lensOffset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>lensOffset <span class=\"token operator\">=</span> lensOffset<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setAspectRatio</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> aspectRatio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>aspectRatio <span class=\"token operator\">=</span> aspectRatio<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setForceAspectRatio</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setForceAspectRatio</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> forceAspectRatio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>forceAspectRatio <span class=\"token operator\">=</span> forceAspectRatio<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setupPerspective</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> _vFlip<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> fov<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> nearDist<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> farDist<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> glm<span class=\"token operator\">::</span>vec2 <span class=\"token operator\">&amp;</span> lensOffset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\tofRectangle orientedViewport <span class=\"token operator\">=</span> <span class=\"token function\">getRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getNativeViewport</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">float</span> eyeX <span class=\"token operator\">=</span> orientedViewport<span class=\"token punctuation\">.</span>width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">float</span> eyeY <span class=\"token operator\">=</span> orientedViewport<span class=\"token punctuation\">.</span>height <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">float</span> halfFov <span class=\"token operator\">=</span> PI <span class=\"token operator\">*</span> fov <span class=\"token operator\">/</span> <span class=\"token number\">360</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">float</span> theTan <span class=\"token operator\">=</span> <span class=\"token function\">tanf</span><span class=\"token punctuation\">(</span>halfFov<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">float</span> dist <span class=\"token operator\">=</span> eyeY <span class=\"token operator\">/</span> theTan<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>nearDist <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> nearDist <span class=\"token operator\">=</span> dist <span class=\"token operator\">/</span> <span class=\"token number\">10.0f</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>farDist <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> farDist <span class=\"token operator\">=</span> dist <span class=\"token operator\">*</span> <span class=\"token number\">10.0f</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">setFov</span><span class=\"token punctuation\">(</span>fov<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setNearClip</span><span class=\"token punctuation\">(</span>nearDist<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setFarClip</span><span class=\"token punctuation\">(</span>farDist<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setLensOffset</span><span class=\"token punctuation\">(</span>lensOffset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setForceAspectRatio</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">setPosition</span><span class=\"token punctuation\">(</span>eyeX<span class=\"token punctuation\">,</span>eyeY<span class=\"token punctuation\">,</span>dist<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">lookAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>eyeX<span class=\"token punctuation\">,</span>eyeY<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tvFlip <span class=\"token operator\">=</span> _vFlip<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setupOffAxisViewPortal</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> glm<span class=\"token operator\">::</span>vec3 <span class=\"token operator\">&amp;</span> topLeft<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> glm<span class=\"token operator\">::</span>vec3 <span class=\"token operator\">&amp;</span> bottomLeft<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> glm<span class=\"token operator\">::</span>vec3 <span class=\"token operator\">&amp;</span> bottomRight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">auto</span> bottomEdge <span class=\"token operator\">=</span> bottomRight <span class=\"token operator\">-</span> bottomLeft<span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">// plane x axis</span>\n\t<span class=\"token keyword\">auto</span> leftEdge <span class=\"token operator\">=</span> topLeft <span class=\"token operator\">-</span> bottomLeft<span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">// plane y axis</span>\n\t<span class=\"token keyword\">auto</span> bottomEdgeNorm <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>bottomEdge<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">auto</span> leftEdgeNorm <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">normalize</span><span class=\"token punctuation\">(</span>leftEdge<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">auto</span> bottomLeftToCam <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> bottomLeft<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">auto</span> cameraLookVector <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">cross</span><span class=\"token punctuation\">(</span>leftEdgeNorm<span class=\"token punctuation\">,</span> bottomEdgeNorm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">auto</span> cameraUpVector <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">cross</span><span class=\"token punctuation\">(</span>bottomEdgeNorm<span class=\"token punctuation\">,</span> cameraLookVector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token function\">lookAt</span><span class=\"token punctuation\">(</span>cameraLookVector <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cameraUpVector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">//lensoffset</span>\n\tglm<span class=\"token operator\">::</span>vec2 lensOffset<span class=\"token punctuation\">;</span>\n\tlensOffset<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>glm<span class=\"token operator\">::</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>bottomLeftToCam<span class=\"token punctuation\">,</span> bottomEdgeNorm<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">2.0f</span> <span class=\"token operator\">/</span> glm<span class=\"token operator\">::</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span>bottomEdge<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0f</span><span class=\"token punctuation\">;</span>\n\tlensOffset<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>glm<span class=\"token operator\">::</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>bottomLeftToCam<span class=\"token punctuation\">,</span> leftEdgeNorm<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">2.0f</span> <span class=\"token operator\">/</span> glm<span class=\"token operator\">::</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span>leftEdge<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0f</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setLensOffset</span><span class=\"token punctuation\">(</span>lensOffset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setAspectRatio</span><span class=\"token punctuation\">(</span> glm<span class=\"token operator\">::</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span>bottomEdge<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> glm<span class=\"token operator\">::</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span>leftEdge<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">auto</span> distanceAlongOpticalAxis <span class=\"token operator\">=</span> <span class=\"token function\">fabs</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>bottomLeftToCam<span class=\"token punctuation\">,</span> cameraLookVector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setFov</span><span class=\"token punctuation\">(</span><span class=\"token number\">2.0f</span> <span class=\"token operator\">*</span> RAD_TO_DEG <span class=\"token operator\">*</span> <span class=\"token function\">atan</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span>leftEdge<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2.0f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> distanceAlongOpticalAxis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setVFlip</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> vflip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\tvFlip <span class=\"token operator\">=</span> vflip<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">bool</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">isVFlipped</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> vFlip<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">enableOrtho</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tisOrtho <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">disableOrtho</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tisOrtho <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">bool</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">getOrtho</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> isOrtho<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">float</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">getImagePlaneDistance</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> viewport<span class=\"token punctuation\">.</span>height <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2.0f</span> <span class=\"token operator\">*</span> <span class=\"token function\">tanf</span><span class=\"token punctuation\">(</span>PI <span class=\"token operator\">*</span> fov <span class=\"token operator\">/</span> <span class=\"token number\">360.0f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">ofGetCurrentRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// if begin(); pushes first, then we need an end to pop</span>\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">ofGetCurrentRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">unbind</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nglm<span class=\"token operator\">::</span>mat4 ofCamera<span class=\"token operator\">::</span><span class=\"token function\">getProjectionMatrix</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\" spellcheck=\"true\">// autocalculate near/far clip planes if not set by user</span>\n\t<span class=\"token keyword\">const_cast</span><span class=\"token operator\">&lt;</span>ofCamera<span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">calcClipPlanes</span><span class=\"token punctuation\">(</span>viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>isOrtho<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> glm<span class=\"token operator\">::</span><span class=\"token function\">translate</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span><span class=\"token function\">mat4</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">-</span>lensOffset<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>lensOffset<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> glm<span class=\"token operator\">::</span><span class=\"token function\">ortho</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token operator\">-</span> viewport<span class=\"token punctuation\">.</span>width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token operator\">+</span> viewport<span class=\"token punctuation\">.</span>width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token operator\">-</span> viewport<span class=\"token punctuation\">.</span>height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token operator\">+</span> viewport<span class=\"token punctuation\">.</span>height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\tnearClip<span class=\"token punctuation\">,</span>\n\t\t\tfarClip\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float</span> aspect <span class=\"token operator\">=</span> forceAspectRatio <span class=\"token operator\">?</span> aspectRatio <span class=\"token operator\">:</span> viewport<span class=\"token punctuation\">.</span>width<span class=\"token operator\">/</span>viewport<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">auto</span> projection <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">perspective</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span><span class=\"token function\">radians</span><span class=\"token punctuation\">(</span>fov<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> aspect<span class=\"token punctuation\">,</span> nearClip<span class=\"token punctuation\">,</span> farClip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tprojection <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">translate</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span><span class=\"token function\">mat4</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">-</span>lensOffset<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>lensOffset<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> projection<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> projection<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nglm<span class=\"token operator\">::</span>mat4 ofCamera<span class=\"token operator\">::</span><span class=\"token function\">getModelViewMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> glm<span class=\"token operator\">::</span><span class=\"token function\">inverse</span><span class=\"token punctuation\">(</span><span class=\"token function\">getGlobalTransformMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nglm<span class=\"token operator\">::</span>mat4 ofCamera<span class=\"token operator\">::</span><span class=\"token function\">getModelViewProjectionMatrix</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">getProjectionMatrix</span><span class=\"token punctuation\">(</span>viewport<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">getModelViewMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nglm<span class=\"token operator\">::</span>vec3 ofCamera<span class=\"token operator\">::</span><span class=\"token function\">worldToScreen</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span>vec3 WorldXYZ<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">auto</span> CameraXYZ <span class=\"token operator\">=</span> <span class=\"token function\">worldToCamera</span><span class=\"token punctuation\">(</span>WorldXYZ<span class=\"token punctuation\">,</span> viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\tglm<span class=\"token operator\">::</span>vec3 ScreenXYZ<span class=\"token punctuation\">;</span>\n\tScreenXYZ<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>CameraXYZ<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> <span class=\"token number\">1.0f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2.0f</span> <span class=\"token operator\">*</span> viewport<span class=\"token punctuation\">.</span>width <span class=\"token operator\">+</span> viewport<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n\tScreenXYZ<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.0f</span> <span class=\"token operator\">-</span> CameraXYZ<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2.0f</span> <span class=\"token operator\">*</span> viewport<span class=\"token punctuation\">.</span>height <span class=\"token operator\">+</span> viewport<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n\tScreenXYZ<span class=\"token punctuation\">.</span>z <span class=\"token operator\">=</span> CameraXYZ<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">return</span> ScreenXYZ<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nglm<span class=\"token operator\">::</span>vec3 ofCamera<span class=\"token operator\">::</span><span class=\"token function\">screenToWorld</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span>vec3 ScreenXYZ<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\" spellcheck=\"true\">//convert from screen to camera</span>\n\tglm<span class=\"token operator\">::</span>vec3 CameraXYZ<span class=\"token punctuation\">;</span>\n\tCameraXYZ<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">2.0f</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>ScreenXYZ<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> viewport<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> viewport<span class=\"token punctuation\">.</span>width <span class=\"token operator\">-</span> <span class=\"token number\">1.0f</span><span class=\"token punctuation\">;</span>\n\tCameraXYZ<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token number\">1.0f</span> <span class=\"token operator\">-</span> <span class=\"token number\">2.0f</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>ScreenXYZ<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> viewport<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> viewport<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n\tCameraXYZ<span class=\"token punctuation\">.</span>z <span class=\"token operator\">=</span> ScreenXYZ<span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">cameraToWorld</span><span class=\"token punctuation\">(</span>CameraXYZ<span class=\"token punctuation\">,</span> viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nglm<span class=\"token operator\">::</span>vec3 ofCamera<span class=\"token operator\">::</span><span class=\"token function\">worldToCamera</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span>vec3 WorldXYZ<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">auto</span> MVPmatrix <span class=\"token operator\">=</span> <span class=\"token function\">getModelViewProjectionMatrix</span><span class=\"token punctuation\">(</span>viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>vFlip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tMVPmatrix <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">scale</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span><span class=\"token function\">mat4</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> glm<span class=\"token operator\">::</span><span class=\"token function\">vec3</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> MVPmatrix<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">auto</span> camera <span class=\"token operator\">=</span> MVPmatrix <span class=\"token operator\">*</span> glm<span class=\"token operator\">::</span><span class=\"token function\">vec4</span><span class=\"token punctuation\">(</span>WorldXYZ<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> glm<span class=\"token operator\">::</span><span class=\"token function\">vec3</span><span class=\"token punctuation\">(</span>camera<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> camera<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">;</span>\n\t\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\nglm<span class=\"token operator\">::</span>vec3 ofCamera<span class=\"token operator\">::</span><span class=\"token function\">cameraToWorld</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span>vec3 CameraXYZ<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">auto</span> MVPmatrix <span class=\"token operator\">=</span> <span class=\"token function\">getModelViewProjectionMatrix</span><span class=\"token punctuation\">(</span>viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>vFlip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tMVPmatrix <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">scale</span><span class=\"token punctuation\">(</span>glm<span class=\"token operator\">::</span><span class=\"token function\">mat4</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> glm<span class=\"token operator\">::</span><span class=\"token function\">vec3</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> MVPmatrix<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">auto</span> world <span class=\"token operator\">=</span> glm<span class=\"token operator\">::</span><span class=\"token function\">inverse</span><span class=\"token punctuation\">(</span>MVPmatrix<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> glm<span class=\"token operator\">::</span><span class=\"token function\">vec4</span><span class=\"token punctuation\">(</span>CameraXYZ<span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> glm<span class=\"token operator\">::</span><span class=\"token function\">vec3</span><span class=\"token punctuation\">(</span>world<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> world<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//----------------------------------------</span>\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">calcClipPlanes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\" spellcheck=\"true\">// autocalculate near/far clip planes if not set by user</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>nearClip <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> farClip <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">float</span> dist <span class=\"token operator\">=</span> <span class=\"token function\">getImagePlaneDistance</span><span class=\"token punctuation\">(</span>viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tnearClip <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>nearClip <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> dist <span class=\"token operator\">/</span> <span class=\"token number\">100.0f</span> <span class=\"token operator\">:</span> nearClip<span class=\"token punctuation\">;</span>\n\t\tfarClip <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>farClip <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> dist <span class=\"token operator\">*</span> <span class=\"token number\">10.0f</span> <span class=\"token operator\">:</span> farClip<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nofRectangle ofCamera<span class=\"token operator\">::</span><span class=\"token function\">getViewport</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">getRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getCurrentViewport</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nshared_ptr<span class=\"token operator\">&lt;</span>ofBaseRenderer<span class=\"token operator\">></span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">getRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>renderer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">ofGetCurrentRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> renderer<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">setRenderer</span><span class=\"token punctuation\">(</span>shared_ptr<span class=\"token operator\">&lt;</span>ofBaseRenderer<span class=\"token operator\">></span> _renderer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\trenderer <span class=\"token operator\">=</span> _renderer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> ofCamera<span class=\"token operator\">::</span><span class=\"token function\">drawFrustum</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> ofRectangle <span class=\"token operator\">&amp;</span> viewport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">ofPushMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">// In World Space, the camera frustum is the \"capped pyramid\" which </span>\n\t<span class=\"token comment\" spellcheck=\"true\">// contains everything which can be seen from a camera. </span>\n\t<span class=\"token comment\" spellcheck=\"true\">//</span>\n\t<span class=\"token comment\" spellcheck=\"true\">// In Clip Space, the frustum is defined as a box with dimensions: -1, -1, -1 to +1, +1, +1.</span>\n\t<span class=\"token comment\" spellcheck=\"true\">//</span>\n\t<span class=\"token comment\" spellcheck=\"true\">// Much simpler. </span>\n\t<span class=\"token comment\" spellcheck=\"true\">//</span>\n\t<span class=\"token comment\" spellcheck=\"true\">// We therefore want to draw our frustum as if in Clip Space. </span>\n\t<span class=\"token comment\" spellcheck=\"true\">// For this, we must find a matrix which will transform Clip Space </span>\n\t<span class=\"token comment\" spellcheck=\"true\">// back to World Space. </span>\n\n\n\t<span class=\"token comment\" spellcheck=\"true\">// Note: globalTransformMatrix == inverse(modelViewMatrix)</span>\n\tglm<span class=\"token operator\">::</span>mat4 clipSpaceToWorld <span class=\"token operator\">=</span> <span class=\"token function\">getGlobalTransformMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> glm<span class=\"token operator\">::</span><span class=\"token function\">inverse</span><span class=\"token punctuation\">(</span><span class=\"token function\">getProjectionMatrix</span><span class=\"token punctuation\">(</span>viewport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">// Move into Clip Space - this matrix will transform anything we </span>\n\t<span class=\"token comment\" spellcheck=\"true\">// draw from Clip Space to World Space</span>\n\t<span class=\"token function\">ofMultMatrix</span><span class=\"token punctuation\">(</span>clipSpaceToWorld<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\" spellcheck=\"true\">// Anything we draw now is transformed from Clip Space back to World Space</span>\n\n\t<span class=\"token function\">ofPushStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">ofNoFill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">ofDrawBox</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">// In Clip Space, the frustum is standardised to be a box of dimensions -1,1 in each axis</span>\n\t<span class=\"token function\">ofPopStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">ofPopMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n","type":"source"}}],"fetch":[]}