<!doctype html>
<html data-n-head-ssr>
  <head>
    <meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" data-hid="keyword" name="keyword" content=""><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><link rel="preload" href="/_nuxt/76844c096ee4b2a8e8b3.js" as="script"><link rel="preload" href="/_nuxt/561e36663ec83bdcd2ac.js" as="script"><link rel="preload" href="/_nuxt/fe12c0cb7395fa1032f4.css" as="style"><link rel="preload" href="/_nuxt/26c5a70906ce7aaac460.js" as="script"><link rel="preload" href="/_nuxt/75259d9b56378e7dbe47.css" as="style"><link rel="preload" href="/_nuxt/426713a49089294b64e8.js" as="script"><link rel="preload" href="/_nuxt/74971516fa343f955f83.css" as="style"><link rel="preload" href="/_nuxt/0128aba013e56fe5f14b.js" as="script"><link rel="stylesheet" href="/_nuxt/fe12c0cb7395fa1032f4.css"><link rel="stylesheet" href="/_nuxt/75259d9b56378e7dbe47.css"><link rel="stylesheet" href="/_nuxt/74971516fa343f955f83.css">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="app" class="unknown"><div id="menu"><h1 class="of"><div class="inner"><span><a href="/" class="nuxt-link-active"><div class="txt"><span class="docs f7 questrial">ofDocs </span><span class="version">0.11.0</span></div></a></span></div></h1><div id="search"><div class="inner"><div class="field text"><div class="field-inner"><svg viewbox="0 0 36 36" x="0px" y="0px" enable-background="new 0 0 36 36" xml:space="preserve"><path d="M35.525,31.228l-8.88-8.882c1.444-2.238,2.298-4.895,2.298-7.752c0-7.909-6.438-14.343-14.346-14.343						c-7.911,0-14.343,6.434-14.343,14.343c0,7.911,6.433,14.344,14.343,14.344c2.856,0,5.513-0.849,7.752-2.294l8.88,8.88						c0.295,0.297,0.782,0.297,1.076,0l3.22-3.221C35.824,32.008,35.824,31.523,35.525,31.228z M4.81,14.593						c0-5.396,4.391-9.788,9.788-9.788c5.398,0,9.787,4.392,9.787,9.788c0,5.398-4.389,9.789-9.787,9.789						C9.2,24.382,4.81,19.991,4.81,14.593z"></path></svg><!----><div class="text-wrapper"><input id="search_field" name="search_field" placeholder="Search (Alt+F)" autocomplete="off" tabindex="0"></div><!----><!----></div></div></div><div id="results" class="mt1"></div></div><div id="lists" class="menu-inner mt1"><div class="inner"><div class="item"><a href="/documentation/" title="/documentation/"><!----><span>documentation</span></a><!----></div><div class="item"><a href="/guides/" title="/guides/"><!----><span>guides</span></a><!----></div><div class="item"><a href="/examples/" title="/examples/"><!----><span>examples</span></a><!----></div><div class="item"><a href="/openframeworks/" title="/openframeworks/" class="nuxt-link-active"><!----><span>openFrameworks</span></a><div class="list"><div class="item"><a href="/openframeworks/3d/" title="/openframeworks/3d/"><!----><span>3d</span></a><!----></div><div class="item"><a href="/openframeworks/app/" title="/openframeworks/app/"><!----><span>app</span></a><!----></div><div class="item"><a href="/openframeworks/communication/" title="/openframeworks/communication/"><!----><span>communication</span></a><!----></div><div class="item"><a href="/openframeworks/events/" title="/openframeworks/events/"><!----><span>events</span></a><!----></div><div class="item"><a href="/openframeworks/gl/" title="/openframeworks/gl/"><!----><span>gl</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/" title="/openframeworks/graphics/"><!----><span>graphics</span></a><!----></div><div class="item"><a href="/openframeworks/math/" title="/openframeworks/math/"><!----><span>math</span></a><!----></div><div class="item"><a href="/openframeworks/sound/" title="/openframeworks/sound/"><!----><span>sound</span></a><!----></div><div class="item"><a href="/openframeworks/types/" title="/openframeworks/types/"><!----><span>types</span></a><!----></div><div class="item"><a href="/openframeworks/utils/" title="/openframeworks/utils/"><!----><span>utils</span></a><!----></div><div class="item"><a href="/openframeworks/video/" title="/openframeworks/video/" class="nuxt-link-active"><!----><span>video</span></a><div class="list"><div class="item"><a href="/openframeworks/video/ofAVFoundationGrabber_h" title="/openframeworks/video/ofAVFoundationGrabber.h"><!----><span>ofAVFoundationGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofAVFoundationPlayer_h" title="/openframeworks/video/ofAVFoundationPlayer.h"><!----><span>ofAVFoundationPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofAVFoundationVideoPlayer_h" title="/openframeworks/video/ofAVFoundationVideoPlayer.h"><!----><span>ofAVFoundationVideoPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofDirectShowGrabber_cpp" title="/openframeworks/video/ofDirectShowGrabber.cpp"><!----><span>ofDirectShowGrabber.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofDirectShowGrabber_h" title="/openframeworks/video/ofDirectShowGrabber.h"><!----><span>ofDirectShowGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofDirectShowPlayer_cpp" title="/openframeworks/video/ofDirectShowPlayer.cpp"><!----><span>ofDirectShowPlayer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofDirectShowPlayer_h" title="/openframeworks/video/ofDirectShowPlayer.h"><!----><span>ofDirectShowPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstUtils_cpp" title="/openframeworks/video/ofGstUtils.cpp"><!----><span>ofGstUtils.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstUtils_h" title="/openframeworks/video/ofGstUtils.h"><!----><span>ofGstUtils.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoGrabber_cpp" title="/openframeworks/video/ofGstVideoGrabber.cpp"><!----><span>ofGstVideoGrabber.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoGrabber_h" title="/openframeworks/video/ofGstVideoGrabber.h"><!----><span>ofGstVideoGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoPlayer_cpp" title="/openframeworks/video/ofGstVideoPlayer.cpp"><!----><span>ofGstVideoPlayer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoPlayer_h" title="/openframeworks/video/ofGstVideoPlayer.h"><!----><span>ofGstVideoPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQTKitGrabber_h" title="/openframeworks/video/ofQTKitGrabber.h"><!----><span>ofQTKitGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQTKitMovieRenderer_h" title="/openframeworks/video/ofQTKitMovieRenderer.h"><!----><span>ofQTKitMovieRenderer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQTKitPlayer_h" title="/openframeworks/video/ofQTKitPlayer.h"><!----><span>ofQTKitPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQtUtils_cpp" title="/openframeworks/video/ofQtUtils.cpp"><!----><span>ofQtUtils.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQtUtils_h" title="/openframeworks/video/ofQtUtils.h"><!----><span>ofQtUtils.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQuickTimeGrabber_cpp" title="/openframeworks/video/ofQuickTimeGrabber.cpp" class="nuxt-link-exact-active nuxt-link-active"><!----><span>ofQuickTimeGrabber.cpp</span></a><div class="list"></div></div><div class="item"><a href="/openframeworks/video/ofQuickTimeGrabber_h" title="/openframeworks/video/ofQuickTimeGrabber.h"><!----><span>ofQuickTimeGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQuickTimePlayer_cpp" title="/openframeworks/video/ofQuickTimePlayer.cpp"><!----><span>ofQuickTimePlayer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQuickTimePlayer_h" title="/openframeworks/video/ofQuickTimePlayer.h"><!----><span>ofQuickTimePlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoBaseTypes_h" title="/openframeworks/video/ofVideoBaseTypes.h"><!----><span>ofVideoBaseTypes.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoGrabber_cpp" title="/openframeworks/video/ofVideoGrabber.cpp"><!----><span>ofVideoGrabber.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoGrabber_h" title="/openframeworks/video/ofVideoGrabber.h"><!----><span>ofVideoGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoPlayer_cpp" title="/openframeworks/video/ofVideoPlayer.cpp"><!----><span>ofVideoPlayer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoPlayer_h" title="/openframeworks/video/ofVideoPlayer.h"><!----><span>ofVideoPlayer.h</span></a><!----></div></div></div></div></div><div class="item"><a href="/addons/" title="/addons/"><!----><span>addons</span></a><!----></div><div class="item"><a href="/guides/" title="/guides/"><!----><span>guides</span></a><!----></div></div></div></div><div id="document"><div id="renderer" class="main"><div absolute="/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/video/ofQuickTimeGrabber.cpp" route="/openframeworks/video/ofQuickTimeGrabber.cpp" dir="../libs/openFrameworks/video" ext="cpp" type="source" id="373" parent="354" siblings="" translations="[object Object]" class="doc-header"><div class="doc-header-inner"><div class="inner"><div class="mt2 mb2"><span class="breadcrumbs"><span class="crumb"><a href="/" class="pink nuxt-link-active">ofDocs</a><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/" class="pink nuxt-link-active">openframeworks </a><!----><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/video/" class="pink nuxt-link-active">video </a><!----><span class="chevron right"></span></span><span class="crumb"><!----><span class="link">ofQuickTimeGrabber.cpp </span><!----></span></span></div></div></div></div><div id="code-page" class="markdown"><div id="side-menu"><!----><div id="see-also" filename="video" absolute="/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/video" dir="../libs/openFrameworks" route="/openframeworks/video/" ext="" type="folder" children="355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381" icon="videocam" parent="195" breadcrumbs="195" class="see-also"><h4>See also</h4><div class="also"><a href="/documentation/video/"><span class="origin">documentation</span><span class="name">video</span></a></div><div class="also"><a href="/examples/video/videoPlayerExample/"><span class="origin">examples</span><span class="name">videoPlayerExample</span></a></div><div class="also"><a href="/examples/video/videoGrabberExample/"><span class="origin">examples</span><span class="name">videoGrabberExample</span></a></div><div class="also"><a href="/examples/video/"><span class="origin">examples</span><span class="name">video</span></a></div><div class="also"><a href="/examples/ios/videoGrabberExample/"><span class="origin">examples</span><span class="name">videoGrabberExample</span></a></div></div></div><div id="code-render" id="code-inner"><div class="inner"><pre><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofQuickTimeGrabber.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofUtils.h"</span></span>


<span class="token macro property">#<span class="token directive keyword">if</span> !defined(TARGET_LINUX) && !defined(MAC_OS_X_VERSION_10_7) && (!defined(MAC_OS_X_VERSION_10_12) || MAC_OS_X_VERSION_MAX_ALLOWED &lt; MAC_OS_X_VERSION_10_12)</span>

<span class="token comment" spellcheck="true">//---------------------------------</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
<span class="token comment" spellcheck="true">//---------------------------------</span>
<span class="token comment" spellcheck="true">//--------------------------------------------------------------</span>

<span class="token keyword">static</span> ComponentResult 	<span class="token function">frameIsGrabbedProc</span><span class="token punctuation">(</span>SGChannel sgChan<span class="token punctuation">,</span> <span class="token keyword">short</span> nBufferNum<span class="token punctuation">,</span> Boolean <span class="token operator">*</span>pbDone<span class="token punctuation">,</span> <span class="token keyword">long</span> lRefCon<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> ComponentResult  <span class="token function">frameIsGrabbedProc</span><span class="token punctuation">(</span>SGChannel sgChan<span class="token punctuation">,</span> <span class="token keyword">short</span> nBufferNum<span class="token punctuation">,</span> Boolean <span class="token operator">*</span>pbDone<span class="token punctuation">,</span> <span class="token keyword">long</span> lRefCon<span class="token punctuation">)</span><span class="token punctuation">{</span>

 	ComponentResult err <span class="token operator">=</span> <span class="token function">SGGrabFrameComplete</span><span class="token punctuation">(</span> sgChan<span class="token punctuation">,</span> nBufferNum<span class="token punctuation">,</span> pbDone <span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">bool</span> <span class="token operator">*</span> havePixChanged <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span> <span class="token operator">*</span><span class="token punctuation">)</span>lRefCon<span class="token punctuation">;</span>
	<span class="token operator">*</span>havePixChanged <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> err<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token comment" spellcheck="true">//---------------------------------</span>


<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">ofQuickTimeGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

		<span class="token function">initializeQuicktime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bSgInited				<span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		gSeqGrabber				<span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		offscreenGWorldPixels	<span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

	<span class="token comment" spellcheck="true">// common</span>
	bIsFrameNew				<span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	bVerbose 				<span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	bGrabberInited 			<span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	bChooseDevice			<span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	deviceID				<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">//width 					= 320;	// default setting</span>
	<span class="token comment" spellcheck="true">//height 					= 240;	// default setting</span>
	<span class="token comment" spellcheck="true">//pixels					= nullptr;</span>
	attemptFramerate		<span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
ofQuickTimeGrabber<span class="token operator">::</span><span class="token operator">~</span><span class="token function">ofQuickTimeGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>offscreenGWorldPixels <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> offscreenGWorldPixels<span class="token punctuation">;</span>
			offscreenGWorldPixels <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">void</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">setVerbose</span><span class="token punctuation">(</span><span class="token keyword">bool</span> bTalkToMe<span class="token punctuation">)</span><span class="token punctuation">{</span>
	bVerbose <span class="token operator">=</span> bTalkToMe<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">void</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">setDeviceID</span><span class="token punctuation">(</span><span class="token keyword">int</span> _deviceID<span class="token punctuation">)</span><span class="token punctuation">{</span>
	deviceID		<span class="token operator">=</span> _deviceID<span class="token punctuation">;</span>
	bChooseDevice	<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">void</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">setDesiredFrameRate</span><span class="token punctuation">(</span><span class="token keyword">int</span> framerate<span class="token punctuation">)</span><span class="token punctuation">{</span>
	attemptFramerate <span class="token operator">=</span> framerate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">setPixelFormat</span><span class="token punctuation">(</span>ofPixelFormat pixelFormat<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">//note as we only support RGB we are just confirming that this pixel format is supported</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> pixelFormat <span class="token operator">==</span> OF_PIXELS_RGB <span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setPixelFormat(): requested pixel format "</span> <span class="token operator">&lt;&lt;</span> pixelFormat <span class="token operator">&lt;&lt;</span> <span class="token string">" not supported"</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------------------------------------------------</span>
ofPixelFormat ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">//note if you support more than one pixel format you will need to return a ofPixelFormat variable. </span>
	<span class="token keyword">return</span> OF_PIXELS_RGB<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

		<span class="token comment" spellcheck="true">//---------------------------------- 1 - open the sequence grabber</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">qtInitSeqGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"initGrabber(): unable to initialize the seq grabber"</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">//---------------------------------- 2 - set the dimensions</span>
		<span class="token comment" spellcheck="true">//width 		= w;</span>
		<span class="token comment" spellcheck="true">//height 		= h;</span>

		<span class="token function">MacSetRect</span><span class="token punctuation">(</span><span class="token operator">&</span>videoRect<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//---------------------------------- 3 - buffer allocation</span>
		<span class="token comment" spellcheck="true">// Create a buffer big enough to hold the video data,</span>
		<span class="token comment" spellcheck="true">// make sure the pointer is 32-byte aligned.</span>
		<span class="token comment" spellcheck="true">// also the rgb image that people will grab</span>

		offscreenGWorldPixels 	<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> w <span class="token operator">*</span> h <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pixels<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> OF_IMAGE_COLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_OSX) && defined(__BIG_ENDIAN__)</span>
			<span class="token function">QTNewGWorldFromPtr</span> <span class="token punctuation">(</span><span class="token operator">&</span><span class="token punctuation">(</span>videogworld<span class="token punctuation">)</span><span class="token punctuation">,</span> k32ARGBPixelFormat<span class="token punctuation">,</span> <span class="token operator">&</span><span class="token punctuation">(</span>videoRect<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>offscreenGWorldPixels<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token macro property">#<span class="token directive keyword">else</span></span>
			<span class="token function">QTNewGWorldFromPtr</span> <span class="token punctuation">(</span><span class="token operator">&</span><span class="token punctuation">(</span>videogworld<span class="token punctuation">)</span><span class="token punctuation">,</span> k24RGBPixelFormat<span class="token punctuation">,</span> <span class="token operator">&</span><span class="token punctuation">(</span>videoRect<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pixels<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token macro property">#<span class="token directive keyword">endif</span>		</span>
		
		<span class="token function">LockPixels</span><span class="token punctuation">(</span><span class="token function">GetGWorldPixMap</span><span class="token punctuation">(</span>videogworld<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">SetGWorld</span> <span class="token punctuation">(</span>videogworld<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">SGSetGWorld</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> videogworld<span class="token punctuation">,</span> nil<span class="token punctuation">)</span><span class="token punctuation">;</span>

		
		<span class="token comment" spellcheck="true">//---------------------------------- 4 - device selection</span>
		<span class="token keyword">bool</span> didWeChooseADevice <span class="token operator">=</span> bChooseDevice<span class="token punctuation">;</span>
		<span class="token keyword">bool</span> deviceIsSelected	<span class="token operator">=</span>  <span class="token boolean">false</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//if we have a device selected then try first to setup</span>
		<span class="token comment" spellcheck="true">//that device</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>didWeChooseADevice<span class="token punctuation">)</span><span class="token punctuation">{</span>
			deviceIsSelected <span class="token operator">=</span> <span class="token function">qtSelectDevice</span><span class="token punctuation">(</span>deviceID<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>deviceIsSelected <span class="token operator">&&</span> bVerbose<span class="token punctuation">)</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"initGrabber(): unable to open device["</span> <span class="token operator">&lt;&lt;</span> deviceID <span class="token operator">&lt;&lt;</span> <span class="token string">"], will attempt other devices"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">//if we couldn't select our required device</span>
		<span class="token comment" spellcheck="true">//or we aren't specifiying a device to setup</span>
		<span class="token comment" spellcheck="true">//then lets try to setup ANY device!</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>deviceIsSelected <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment" spellcheck="true">//lets list available devices</span>
			<span class="token function">listDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">setDeviceID</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			deviceIsSelected <span class="token operator">=</span> <span class="token function">qtSelectDevice</span><span class="token punctuation">(</span>deviceID<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">//if we still haven't been able to setup a device</span>
		<span class="token comment" spellcheck="true">//we should error and stop!</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> deviceIsSelected <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">goto</span> bail<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">//---------------------------------- 5 - final initialization steps</span>
		OSStatus err<span class="token punctuation">;</span>

	 	err <span class="token operator">=</span> <span class="token function">SGSetChannelUsage</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span>seqGrabPreview<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token operator">!=</span> noErr <span class="token punctuation">)</span> <span class="token keyword">goto</span> bail<span class="token punctuation">;</span>

	
		<span class="token comment" spellcheck="true">//----------------- callback method for notifying new frame</span>
		err <span class="token operator">=</span> <span class="token function">SGSetChannelRefCon</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token operator">&</span>bHavePixelsChanged <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>

			VideoBottles vb<span class="token punctuation">;</span> 
			<span class="token comment" spellcheck="true">/* get the current bottlenecks */</span> 
			vb<span class="token punctuation">.</span>procCount <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> 
			err <span class="token operator">=</span> <span class="token function">SGGetVideoBottlenecks</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>vb<span class="token punctuation">)</span><span class="token punctuation">;</span> 
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> 			
				myGrabCompleteProc <span class="token operator">=</span> <span class="token function">NewSGGrabCompleteBottleUPP</span><span class="token punctuation">(</span>frameIsGrabbedProc<span class="token punctuation">)</span><span class="token punctuation">;</span>
				vb<span class="token punctuation">.</span>grabCompleteProc <span class="token operator">=</span> myGrabCompleteProc<span class="token punctuation">;</span>
			
				<span class="token comment" spellcheck="true">/* add our GrabFrameComplete function */</span> 
				err <span class="token operator">=</span> <span class="token function">SGSetVideoBottlenecks</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>vb<span class="token punctuation">)</span><span class="token punctuation">;</span> 	
			<span class="token punctuation">}</span>
		
		<span class="token punctuation">}</span>
				
		err <span class="token operator">=</span> <span class="token function">SGSetChannelBounds</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>videoRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token operator">!=</span> noErr <span class="token punctuation">)</span> <span class="token keyword">goto</span> bail<span class="token punctuation">;</span>

		err <span class="token operator">=</span> <span class="token function">SGPrepare</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span>  <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//theo swapped so preview is true and capture is false</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token operator">!=</span> noErr <span class="token punctuation">)</span> <span class="token keyword">goto</span> bail<span class="token punctuation">;</span>

		err <span class="token operator">=</span> <span class="token function">SGStartPreview</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token operator">!=</span> noErr <span class="token punctuation">)</span> <span class="token keyword">goto</span> bail<span class="token punctuation">;</span>

		bGrabberInited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token function">loadSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span> attemptFramerate <span class="token operator">>=</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
			err <span class="token operator">=</span> <span class="token function">SGSetFrameRate</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token function">IntToFixed</span><span class="token punctuation">(</span>attemptFramerate<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token operator">!=</span> noErr <span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"initGrabber: couldn't setting framerate to "</span> <span class="token operator">&lt;&lt;</span> attemptFramerate <span class="token operator">&lt;&lt;</span> <span class="token string">": OSStatus "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>		
		<span class="token punctuation">}</span>
		
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"           inited grabbed            "</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"-------------------------------------"</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">// we are done</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>


		<span class="token comment" spellcheck="true">//--------------------- (bail) something's wrong -----</span>
		bail<span class="token operator">:</span>

			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"***** ofQuickTimeGrabber error *****"</span><span class="token punctuation">;</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"------------------------------------"</span><span class="token punctuation">;</span>

			<span class="token comment" spellcheck="true">//if we don't close this - it messes up the next device!</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>bSgInited<span class="token punctuation">)</span> <span class="token function">qtCloseSeqGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			bGrabberInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			
	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">else</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">isInitialized</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> bGrabberInited<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
vector<span class="token operator">&lt;</span>ofVideoDevice<span class="token operator">></span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">listDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>

    vector <span class="token operator">&lt;</span>ofVideoDevice<span class="token operator">></span> devices<span class="token punctuation">;</span> 
    
	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

		<span class="token keyword">bool</span> bNeedToInitGrabberFirst <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bSgInited<span class="token punctuation">)</span> bNeedToInitGrabberFirst <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//if we need to initialize the grabbing component then do it</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> bNeedToInitGrabberFirst <span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">qtInitSeqGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> devices<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"-------------------------------------"</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">/*
			//input selection stuff (ie multiple webcams)
			//from http://developer.apple.com/samplecode/SGDevices/listing13.html
			//and originally http://lists.apple.com/archives/QuickTime-API/2008/Jan/msg00178.html
		*/</span>

		SGDeviceList deviceList<span class="token punctuation">;</span>
		<span class="token function">SGGetChannelDeviceList</span> <span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> sgDeviceListIncludeInputs<span class="token punctuation">,</span> <span class="token operator">&</span>deviceList<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pascalName<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pascalNameInput<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//this is our new way of enumerating devices</span>
		<span class="token comment" spellcheck="true">//quicktime can have multiple capture 'inputs' on the same capture 'device'</span>
		<span class="token comment" spellcheck="true">//ie the USB Video Class Video 'device' - can have multiple usb webcams attached on what QT calls 'inputs'</span>
		<span class="token comment" spellcheck="true">//The isight for example will show up as:</span>
		<span class="token comment" spellcheck="true">//USB Video Class Video - Built-in iSight ('input' 1 of the USB Video Class Video 'device')</span>
		<span class="token comment" spellcheck="true">//Where as another webcam also plugged whill show up as</span>
		<span class="token comment" spellcheck="true">//USB Video Class Video - Philips SPC 1000NC Webcam ('input' 2 of the USB Video Class Video 'device')</span>

		<span class="token comment" spellcheck="true">//this means our the device ID we use for selection has to count both capture 'devices' and their 'inputs'</span>
		<span class="token comment" spellcheck="true">//this needs to be the same in our init grabber method so that we select the device we ask for</span>
		<span class="token keyword">int</span> deviceCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"listing available capture devices"</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>count <span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			SGDeviceName nameRec<span class="token punctuation">;</span>
			nameRec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>entry<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			SGDeviceInputList deviceInputList <span class="token operator">=</span> nameRec<span class="token punctuation">.</span>inputs<span class="token punctuation">;</span>

			<span class="token keyword">int</span> numInputs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span> deviceInputList <span class="token punctuation">)</span> numInputs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>deviceInputList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">memcpy</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>entry<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment" spellcheck="true">//this means we can use the capture method</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>nameRec<span class="token punctuation">.</span>flags <span class="token operator">!=</span> sgDeviceNameFlagDeviceUnavailable<span class="token punctuation">)</span><span class="token punctuation">{</span>

				<span class="token comment" spellcheck="true">//if we have a capture 'device' (qt's word not mine - I would prefer 'system' ) that is ready to be used</span>
				<span class="token comment" spellcheck="true">//we go through its inputs to list all physical devices - as there could be more than one!</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> numInputs<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>


					<span class="token comment" spellcheck="true">//if our 'device' has inputs we get their names here</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span> deviceInputList <span class="token punctuation">)</span><span class="token punctuation">{</span>
						SGDeviceInputName inputNameRec  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceInputList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>entry<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
						<span class="token function">memcpy</span><span class="token punctuation">(</span>pascalNameInput<span class="token punctuation">,</span> inputNameRec<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"device ["</span> <span class="token operator">&lt;&lt;</span> deviceCount <span class="token operator">&lt;&lt;</span> <span class="token string">"] "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalNameInput<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    ofVideoDevice vd<span class="token punctuation">;</span> 
                    vd<span class="token punctuation">.</span>id           <span class="token operator">=</span> deviceCount<span class="token punctuation">;</span> 
                    vd<span class="token punctuation">.</span>deviceName   <span class="token operator">=</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    vd<span class="token punctuation">.</span>bAvailable   <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
                    devices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>vd<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
					<span class="token comment" spellcheck="true">//we count this way as we need to be able to distinguish multiple inputs as devices</span>
					deviceCount<span class="token operator">++</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"(unavailable) device ["</span> <span class="token operator">&lt;&lt;</span> deviceCount <span class="token operator">&lt;&lt;</span> <span class="token string">"] "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                ofVideoDevice vd<span class="token punctuation">;</span>
                vd<span class="token punctuation">.</span>id           <span class="token operator">=</span> deviceCount<span class="token punctuation">;</span> 
                vd<span class="token punctuation">.</span>deviceName   <span class="token operator">=</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                vd<span class="token punctuation">.</span>bAvailable   <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
                devices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>vd<span class="token punctuation">)</span><span class="token punctuation">;</span>

				deviceCount<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"-------------------------------------"</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//if we initialized the grabbing component then close it</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> bNeedToInitGrabberFirst <span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">qtCloseSeqGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

    <span class="token keyword">return</span> devices<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">void</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bGrabberInited <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">SGIdle</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment" spellcheck="true">// set the top pixel alpha = 0, so we can know if it</span>
			<span class="token comment" spellcheck="true">// was a new frame or not..</span>
			<span class="token comment" spellcheck="true">// or else we will process way more than necessary</span>
			<span class="token comment" spellcheck="true">// (ie opengl is running at 60fps +, capture at 30fps)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>bHavePixelsChanged<span class="token punctuation">)</span><span class="token punctuation">{</span>
				
				<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_OSX) && defined(__BIG_ENDIAN__)</span>
					<span class="token function">convertPixels</span><span class="token punctuation">(</span>offscreenGWorldPixels<span class="token punctuation">,</span> pixels<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token macro property">#<span class="token directive keyword">endif</span></span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">// newness test for quicktime:</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>bGrabberInited <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			bIsFrameNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>bHavePixelsChanged <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				bIsFrameNew <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				bHavePixelsChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>


	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------------------------------------------------</span>
ofPixels<span class="token operator">&</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------------------------------------------------</span>
<span class="token keyword">const</span> ofPixels<span class="token operator">&</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------------------------------------------------</span>
<span class="token keyword">bool</span>  ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">isFrameNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> bIsFrameNew<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">float</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>	

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">float</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">void</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">clearMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	pixels<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">void</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

		<span class="token function">qtCloseSeqGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">DisposeSGGrabCompleteBottleUPP</span><span class="token punctuation">(</span>myGrabCompleteProc<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

	<span class="token function">clearMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">void</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">videoSettings</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> OF_VIDEO_CAPTURE_QUICKTIME</span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

		Rect curBounds<span class="token punctuation">,</span> curVideoRect<span class="token punctuation">;</span>
		ComponentResult	err<span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">// Get our current state</span>
		err <span class="token operator">=</span> <span class="token function">SGGetChannelBounds</span> <span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>curBounds<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"videoSettings(): couldn't get get channel bounds: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		err <span class="token operator">=</span> <span class="token function">SGGetVideoRect</span> <span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>curVideoRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"videoSettings(): couldn't get video rect: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">// Pause</span>
		err <span class="token operator">=</span> <span class="token function">SGPause</span> <span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"videoSettings(): couldn't set pause: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_OSX</span>
			<span class="token comment" spellcheck="true">//load any saved camera settings from file</span>
			<span class="token function">loadSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">static</span> SGModalFilterUPP gSeqGrabberModalFilterUPP <span class="token operator">=</span> <span class="token function">NewSGModalFilterUPP</span><span class="token punctuation">(</span>SeqGrabberModalFilterUPP<span class="token punctuation">)</span><span class="token punctuation">;</span>
			ComponentResult result <span class="token operator">=</span> <span class="token function">SGSettingsDialog</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span>  gVideoChannel<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nil<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gSeqGrabberModalFilterUPP<span class="token punctuation">,</span> nil<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"videoSettings(): settings dialog error: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment" spellcheck="true">//save any changed settings to file</span>
			<span class="token function">saveSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token macro property">#<span class="token directive keyword">else</span></span>
			<span class="token function">SGSettingsDialog</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> gVideoChannel<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nil<span class="token punctuation">,</span> seqGrabSettingsPreviewOnly<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token macro property">#<span class="token directive keyword">endif</span></span>

		<span class="token function">SGSetChannelBounds</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>videoRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">SGPause</span> <span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//---------------------------------</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">//---------------------------------</span>

<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_OSX</span>
<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>

<span class="token comment" spellcheck="true">//---------------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">saveSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bGrabberInited <span class="token operator">!=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		ComponentResult	err<span class="token punctuation">;</span>

		UserData mySGVideoSettings <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// get the SGChannel settings cofigured by the user</span>
		err <span class="token operator">=</span> <span class="token function">SGGetChannelSettings</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>mySGVideoSettings<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token operator">!=</span> noErr <span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"saveSettings(): couldn't get camera settings: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		string pref <span class="token operator">=</span> <span class="token string">"ofVideoSettings-"</span><span class="token operator">+</span>deviceName<span class="token punctuation">;</span>
		CFStringRef cameraString <span class="token operator">=</span> <span class="token function">CFStringCreateWithCString</span><span class="token punctuation">(</span>kCFAllocatorDefault<span class="token punctuation">,</span>pref<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>kCFStringEncodingMacRoman<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//get the settings using the key "ofVideoSettings-the name of the device"</span>
		<span class="token function">SaveSettingsPreference</span><span class="token punctuation">(</span> cameraString<span class="token punctuation">,</span> mySGVideoSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">DisposeUserData</span><span class="token punctuation">(</span>mySGVideoSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">loadSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>bGrabberInited <span class="token operator">!=</span> <span class="token boolean">true</span> <span class="token operator">||</span> deviceName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

   ComponentResult   err<span class="token punctuation">;</span>
   UserData mySGVideoSettings <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">// get the settings using the key "ofVideoSettings-the name of the device"</span>
   string pref <span class="token operator">=</span> <span class="token string">"ofVideoSettings-"</span><span class="token operator">+</span>deviceName<span class="token punctuation">;</span>
   CFStringRef cameraString <span class="token operator">=</span> <span class="token function">CFStringCreateWithCString</span><span class="token punctuation">(</span>kCFAllocatorDefault<span class="token punctuation">,</span>pref<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>kCFStringEncodingMacRoman<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token function">GetSettingsPreference</span><span class="token punctuation">(</span>cameraString<span class="token punctuation">,</span> <span class="token operator">&</span>mySGVideoSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>mySGVideoSettings<span class="token punctuation">)</span><span class="token punctuation">{</span>

      Rect   curBounds<span class="token punctuation">,</span> curVideoRect<span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">//we need to make sure the dimensions don't get effected</span>
      <span class="token comment" spellcheck="true">//by our preferences</span>

      <span class="token comment" spellcheck="true">// Get our current state</span>
      err <span class="token operator">=</span> <span class="token function">SGGetChannelBounds</span> <span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>curBounds<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadSettings(): couldn't set channel bounds: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      err <span class="token operator">=</span> <span class="token function">SGGetVideoRect</span> <span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>curVideoRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadSettings(): couldn't set video rect: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment" spellcheck="true">// use the saved settings preference to configure the SGChannel</span>
      err <span class="token operator">=</span> <span class="token function">SGSetChannelSettings</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> gVideoChannel<span class="token punctuation">,</span> mySGVideoSettings<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token operator">!=</span> noErr <span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadSettings(): couldn't set channel settings: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">DisposeUserData</span><span class="token punctuation">(</span>mySGVideoSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Pause</span>
      err <span class="token operator">=</span> <span class="token function">SGPause</span> <span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadSettings(): couldn't set pause: ComponentResult "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">SGSetChannelBounds</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> <span class="token operator">&</span>videoRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">SGPause</span> <span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadSettings(): no camera settings to load"</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">qtInitSeqGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bSgInited <span class="token operator">!=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

			OSErr err <span class="token operator">=</span> noErr<span class="token punctuation">;</span>

			ComponentDescription	theDesc<span class="token punctuation">;</span>
			Component				sgCompID<span class="token punctuation">;</span>

			<span class="token comment" spellcheck="true">// this crashes when we get to</span>
			<span class="token comment" spellcheck="true">// SGNewChannel</span>
			<span class="token comment" spellcheck="true">// we get -9405 as error code for the channel</span>
			<span class="token comment" spellcheck="true">// -----------------------------------------</span>
			<span class="token comment" spellcheck="true">// gSeqGrabber = OpenDefaultComponent(SeqGrabComponentType, 0);</span>

			<span class="token comment" spellcheck="true">// this seems to work instead (got it from hackTV)</span>
			<span class="token comment" spellcheck="true">// -----------------------------------------</span>
			theDesc<span class="token punctuation">.</span>componentType <span class="token operator">=</span> SeqGrabComponentType<span class="token punctuation">;</span>
			theDesc<span class="token punctuation">.</span>componentSubType <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
			theDesc<span class="token punctuation">.</span>componentManufacturer <span class="token operator">=</span> <span class="token string">'appl'</span><span class="token punctuation">;</span>
			theDesc<span class="token punctuation">.</span>componentFlags <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
			theDesc<span class="token punctuation">.</span>componentFlagsMask <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
			sgCompID <span class="token operator">=</span> <span class="token function">FindNextComponent</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token operator">&</span>theDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment" spellcheck="true">// -----------------------------------------</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>sgCompID <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"qtInitSeqGrabber(): findNextComponent did not return a valid component"</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			gSeqGrabber <span class="token operator">=</span> <span class="token function">OpenComponent</span><span class="token punctuation">(</span>sgCompID<span class="token punctuation">)</span><span class="token punctuation">;</span>

			err <span class="token operator">=</span> <span class="token function">GetMoviesError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>gSeqGrabber <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"qtInitSeqGrabber(): couldn't get default sequence grabber component: OSErr "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			err <span class="token operator">=</span> <span class="token function">SGInitialize</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"qtInitSeqGrabber(): can't initialize sequence grabber component: OSErr "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			err <span class="token operator">=</span> <span class="token function">SGSetDataRef</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> seqGrabDontMakeMovie<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"qtInitSeqGrabber(): can't set the destination data reference: OSErr "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment" spellcheck="true">// windows crashes w/ out gworld, make a dummy for now...</span>
			<span class="token comment" spellcheck="true">// this took a long time to figure out.</span>
			err <span class="token operator">=</span> <span class="token function">SGSetGWorld</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"qtInitSeqGrabber(): setting up the gworld: OSErr "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			err <span class="token operator">=</span> <span class="token function">SGNewChannel</span><span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">,</span> VideoMediaType<span class="token punctuation">,</span> <span class="token operator">&</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> noErr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"qtInitSeqGrabber(): couldn't create a new channel: OSErr "</span> <span class="token operator">&lt;&lt;</span> err<span class="token punctuation">;</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"qtInitSeqGrabber(): check if you have any qt capable cameras attached"</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			bSgInited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">qtCloseSeqGrabber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>gSeqGrabber <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">SGStop</span> <span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">CloseComponent</span> <span class="token punctuation">(</span>gSeqGrabber<span class="token punctuation">)</span><span class="token punctuation">;</span>
		gSeqGrabber <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		bSgInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofQuickTimeGrabber<span class="token operator">::</span><span class="token function">qtSelectDevice</span><span class="token punctuation">(</span><span class="token keyword">int</span> deviceNumber<span class="token punctuation">,</span> <span class="token keyword">bool</span> didWeChooseADevice<span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">//note - check for memory freeing possibly needed for the all SGGetChannelDeviceList mac stuff</span>
	<span class="token comment" spellcheck="true">// also see notes in listDevices() regarding new enunemeration method.</span>

	<span class="token comment" spellcheck="true">//Generate a device list and enumerate</span>
	<span class="token comment" spellcheck="true">//all devices availble to the channel</span>
	SGDeviceList deviceList<span class="token punctuation">;</span>
	<span class="token function">SGGetChannelDeviceList</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> sgDeviceListIncludeInputs<span class="token punctuation">,</span> <span class="token operator">&</span>deviceList<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pascalName<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pascalNameInput<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> numDevices <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>count<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>numDevices <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"no capture devices found"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> deviceCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numDevices<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		SGDeviceName nameRec<span class="token punctuation">;</span>
		nameRec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>entry<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		SGDeviceInputList deviceInputList <span class="token operator">=</span> nameRec<span class="token punctuation">.</span>inputs<span class="token punctuation">;</span>

		<span class="token keyword">int</span> numInputs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> deviceInputList <span class="token punctuation">)</span> numInputs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>deviceInputList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">memcpy</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>entry<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>pascalNameInput<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//this means we can use the capture method</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>nameRec<span class="token punctuation">.</span>flags <span class="token operator">!=</span> sgDeviceNameFlagDeviceUnavailable<span class="token punctuation">)</span><span class="token punctuation">{</span>

			<span class="token comment" spellcheck="true">//if we have a capture 'device' (qt's word not mine - I would prefer 'system' ) that is ready to be used</span>
			<span class="token comment" spellcheck="true">//we go through its inputs to list all physical devices - as there could be more than one!</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> numInputs<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

				<span class="token comment" spellcheck="true">//if our 'device' has inputs we get their names here</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span> deviceInputList <span class="token punctuation">)</span><span class="token punctuation">{</span>
					SGDeviceInputName inputNameRec  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>deviceInputList<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>entry<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
					<span class="token function">memcpy</span><span class="token punctuation">(</span>pascalNameInput<span class="token punctuation">,</span> inputNameRec<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token comment" spellcheck="true">//if the device number matches we try and setup the device</span>
				<span class="token comment" spellcheck="true">//if we didn't specifiy a device then we will try all devices till one works!</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span> deviceCount <span class="token operator">==</span> deviceNumber <span class="token operator">||</span> <span class="token operator">!</span>didWeChooseADevice <span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"attempting to open device ["</span> <span class="token operator">&lt;&lt;</span> deviceCount <span class="token operator">&lt;&lt;</span> <span class="token string">"] "</span>
					<span class="token operator">&lt;&lt;</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalNameInput<span class="token punctuation">)</span><span class="token punctuation">;</span>

					OSErr err1 <span class="token operator">=</span> <span class="token function">SGSetChannelDevice</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> pascalName<span class="token punctuation">)</span><span class="token punctuation">;</span>
					OSErr err2 <span class="token operator">=</span> <span class="token function">SGSetChannelDeviceInput</span><span class="token punctuation">(</span>gVideoChannel<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token keyword">int</span> successLevel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

					<span class="token comment" spellcheck="true">//if there were no errors then we have opened the device without issue</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span> err1 <span class="token operator">==</span> noErr <span class="token operator">&&</span> err2 <span class="token operator">==</span> noErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
						successLevel <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
						<span class="token comment" spellcheck="true">//parameter errors are not fatal so we will try and open but will caution the user</span>
					<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>err1 <span class="token operator">==</span> paramErr <span class="token operator">||</span> err1 <span class="token operator">==</span> noErr<span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token punctuation">(</span>err2 <span class="token operator">==</span> noErr <span class="token operator">||</span> err2 <span class="token operator">==</span> paramErr<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
						successLevel <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment" spellcheck="true">//the device is opened!</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span> successLevel <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>

						deviceName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">)</span><span class="token punctuation">;</span>
						deviceName  <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">;</span>
						deviceName <span class="token operator">+</span><span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalNameInput<span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token keyword">if</span><span class="token punctuation">(</span>successLevel <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"device "</span> <span class="token operator">&lt;&lt;</span> deviceName <span class="token operator">&lt;&lt;</span> <span class="token string">" opened successfully"</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span><span class="token punctuation">{</span>
							<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"device "</span> <span class="token operator">&lt;&lt;</span> deviceName <span class="token operator">&lt;&lt;</span> <span class="token string">" opened with some paramater errors, should be fine though!"</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
						<span class="token comment" spellcheck="true">//no need to keep searching - return that we have opened a device!</span>
						<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

					<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
						<span class="token comment" spellcheck="true">//if we selected a device in particular but failed we want to go through the whole list again - starting from 0 and try any device.</span>
						<span class="token comment" spellcheck="true">//so we return false - and try one more time without a preference</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span> didWeChooseADevice <span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"problems setting device ["</span> <span class="token operator">&lt;&lt;</span> deviceNumber <span class="token operator">&lt;&lt;</span> <span class="token string">"] "</span>
							<span class="token operator">&lt;&lt;</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalName<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">p2cstr</span><span class="token punctuation">(</span>pascalNameInput<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" *****"</span><span class="token punctuation">;</span>
							<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
							<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofQuickTimeGrabber"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"unable to open device, trying next device"</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>

				<span class="token punctuation">}</span>

				<span class="token comment" spellcheck="true">//we count this way as we need to be able to distinguish multiple inputs as devices</span>
				deviceCount<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token comment" spellcheck="true">//ofLogError("ofQuickTimeGrabber") &lt;&lt;  "(unavailable) device [" &lt;&lt; deviceCount &lt;&lt; "] " &lt;&lt; p2cstr(pascalName);</span>
			deviceCount<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//---------------------------------</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token comment" spellcheck="true">//---------------------------------</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre></div></div></div></div></div></div></div></div><script defer src="/_nuxt/payloads/1583508725549/openframeworks/video/ofQuickTimeGrabber_cpp/payload.js"></script><script src="/_nuxt/76844c096ee4b2a8e8b3.js" defer></script><script src="/_nuxt/0128aba013e56fe5f14b.js" defer></script><script src="/_nuxt/561e36663ec83bdcd2ac.js" defer></script><script src="/_nuxt/26c5a70906ce7aaac460.js" defer></script><script src="/_nuxt/426713a49089294b64e8.js" defer></script>
  </body>
</html>
