<!doctype html>
<html data-n-head-ssr>
  <head>
    <meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" data-hid="keyword" name="keyword" content=""><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><link rel="preload" href="/_nuxt/76844c096ee4b2a8e8b3.js" as="script"><link rel="preload" href="/_nuxt/561e36663ec83bdcd2ac.js" as="script"><link rel="preload" href="/_nuxt/fe12c0cb7395fa1032f4.css" as="style"><link rel="preload" href="/_nuxt/26c5a70906ce7aaac460.js" as="script"><link rel="preload" href="/_nuxt/75259d9b56378e7dbe47.css" as="style"><link rel="preload" href="/_nuxt/af3debaf278e0e1fd9de.js" as="script"><link rel="preload" href="/_nuxt/74971516fa343f955f83.css" as="style"><link rel="preload" href="/_nuxt/0128aba013e56fe5f14b.js" as="script"><link rel="stylesheet" href="/_nuxt/fe12c0cb7395fa1032f4.css"><link rel="stylesheet" href="/_nuxt/75259d9b56378e7dbe47.css"><link rel="stylesheet" href="/_nuxt/74971516fa343f955f83.css">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="app" class="unknown"><div id="menu"><h1 class="of"><div class="inner"><span><a href="/" class="nuxt-link-active"><div class="txt"><span class="docs f7 questrial">ofDocs </span><span class="version">0.11.0</span></div></a></span></div></h1><div id="search"><div class="inner"><div class="field text"><div class="field-inner"><svg viewbox="0 0 36 36" x="0px" y="0px" enable-background="new 0 0 36 36" xml:space="preserve"><path d="M35.525,31.228l-8.88-8.882c1.444-2.238,2.298-4.895,2.298-7.752c0-7.909-6.438-14.343-14.346-14.343						c-7.911,0-14.343,6.434-14.343,14.343c0,7.911,6.433,14.344,14.343,14.344c2.856,0,5.513-0.849,7.752-2.294l8.88,8.88						c0.295,0.297,0.782,0.297,1.076,0l3.22-3.221C35.824,32.008,35.824,31.523,35.525,31.228z M4.81,14.593						c0-5.396,4.391-9.788,9.788-9.788c5.398,0,9.787,4.392,9.787,9.788c0,5.398-4.389,9.789-9.787,9.789						C9.2,24.382,4.81,19.991,4.81,14.593z"></path></svg><!----><div class="text-wrapper"><input id="search_field" name="search_field" placeholder="Search (Alt+F)" autocomplete="off" tabindex="0"></div><!----><!----></div></div></div><div id="results" class="mt1"></div></div><div id="lists" class="menu-inner mt1"><div class="inner"><div class="item"><a href="/documentation/" title="/documentation/"><!----><span>documentation</span></a><!----></div><div class="item"><a href="/examples/" title="/examples/"><!----><span>examples</span></a><!----></div><div class="item"><a href="/openframeworks/" title="/openframeworks/" class="nuxt-link-active"><!----><span>openFrameworks</span></a><div class="list"><div class="item"><a href="/openframeworks/3d/" title="/openframeworks/3d/"><!----><span>3d</span></a><!----></div><div class="item"><a href="/openframeworks/app/" title="/openframeworks/app/"><!----><span>app</span></a><!----></div><div class="item"><a href="/openframeworks/communication/" title="/openframeworks/communication/"><!----><span>communication</span></a><!----></div><div class="item"><a href="/openframeworks/events/" title="/openframeworks/events/"><!----><span>events</span></a><!----></div><div class="item"><a href="/openframeworks/gl/" title="/openframeworks/gl/"><!----><span>gl</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/" title="/openframeworks/graphics/"><!----><span>graphics</span></a><!----></div><div class="item"><a href="/openframeworks/math/" title="/openframeworks/math/"><!----><span>math</span></a><!----></div><div class="item"><a href="/openframeworks/sound/" title="/openframeworks/sound/"><!----><span>sound</span></a><!----></div><div class="item"><a href="/openframeworks/types/" title="/openframeworks/types/"><!----><span>types</span></a><!----></div><div class="item"><a href="/openframeworks/utils/" title="/openframeworks/utils/"><!----><span>utils</span></a><!----></div><div class="item"><a href="/openframeworks/video/" title="/openframeworks/video/" class="nuxt-link-active"><!----><span>video</span></a><div class="list"><div class="item"><a href="/openframeworks/video/ofAVFoundationGrabber_h" title="/openframeworks/video/ofAVFoundationGrabber.h"><!----><span>ofAVFoundationGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofAVFoundationPlayer_h" title="/openframeworks/video/ofAVFoundationPlayer.h"><!----><span>ofAVFoundationPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofAVFoundationVideoPlayer_h" title="/openframeworks/video/ofAVFoundationVideoPlayer.h"><!----><span>ofAVFoundationVideoPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofDirectShowGrabber_cpp" title="/openframeworks/video/ofDirectShowGrabber.cpp"><!----><span>ofDirectShowGrabber.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofDirectShowGrabber_h" title="/openframeworks/video/ofDirectShowGrabber.h"><!----><span>ofDirectShowGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofDirectShowPlayer_cpp" title="/openframeworks/video/ofDirectShowPlayer.cpp" class="nuxt-link-exact-active nuxt-link-active"><!----><span>ofDirectShowPlayer.cpp</span></a><div class="list"></div></div><div class="item"><a href="/openframeworks/video/ofDirectShowPlayer_h" title="/openframeworks/video/ofDirectShowPlayer.h"><!----><span>ofDirectShowPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstUtils_cpp" title="/openframeworks/video/ofGstUtils.cpp"><!----><span>ofGstUtils.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstUtils_h" title="/openframeworks/video/ofGstUtils.h"><!----><span>ofGstUtils.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoGrabber_cpp" title="/openframeworks/video/ofGstVideoGrabber.cpp"><!----><span>ofGstVideoGrabber.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoGrabber_h" title="/openframeworks/video/ofGstVideoGrabber.h"><!----><span>ofGstVideoGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoPlayer_cpp" title="/openframeworks/video/ofGstVideoPlayer.cpp"><!----><span>ofGstVideoPlayer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofGstVideoPlayer_h" title="/openframeworks/video/ofGstVideoPlayer.h"><!----><span>ofGstVideoPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQTKitGrabber_h" title="/openframeworks/video/ofQTKitGrabber.h"><!----><span>ofQTKitGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQTKitMovieRenderer_h" title="/openframeworks/video/ofQTKitMovieRenderer.h"><!----><span>ofQTKitMovieRenderer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQTKitPlayer_h" title="/openframeworks/video/ofQTKitPlayer.h"><!----><span>ofQTKitPlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQtUtils_cpp" title="/openframeworks/video/ofQtUtils.cpp"><!----><span>ofQtUtils.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQtUtils_h" title="/openframeworks/video/ofQtUtils.h"><!----><span>ofQtUtils.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQuickTimeGrabber_cpp" title="/openframeworks/video/ofQuickTimeGrabber.cpp"><!----><span>ofQuickTimeGrabber.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQuickTimeGrabber_h" title="/openframeworks/video/ofQuickTimeGrabber.h"><!----><span>ofQuickTimeGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQuickTimePlayer_cpp" title="/openframeworks/video/ofQuickTimePlayer.cpp"><!----><span>ofQuickTimePlayer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofQuickTimePlayer_h" title="/openframeworks/video/ofQuickTimePlayer.h"><!----><span>ofQuickTimePlayer.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoBaseTypes_h" title="/openframeworks/video/ofVideoBaseTypes.h"><!----><span>ofVideoBaseTypes.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoGrabber_cpp" title="/openframeworks/video/ofVideoGrabber.cpp"><!----><span>ofVideoGrabber.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoGrabber_h" title="/openframeworks/video/ofVideoGrabber.h"><!----><span>ofVideoGrabber.h</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoPlayer_cpp" title="/openframeworks/video/ofVideoPlayer.cpp"><!----><span>ofVideoPlayer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/video/ofVideoPlayer_h" title="/openframeworks/video/ofVideoPlayer.h"><!----><span>ofVideoPlayer.h</span></a><!----></div></div></div></div></div><div class="item"><a href="/addons/" title="/addons/"><!----><span>addons</span></a><!----></div><div class="item"><a href="/guides/" title="/guides/"><!----><span>guides</span></a><!----></div></div></div></div><div id="document"><div id="renderer" class="main"><div absolute="/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/video/ofDirectShowPlayer.cpp" route="/openframeworks/video/ofDirectShowPlayer.cpp" dir="../libs/openFrameworks/video" ext="cpp" type="source" id="360" parent="354" siblings="" translations="[object Object]" class="doc-header"><div class="doc-header-inner"><div class="inner"><div class="mt2 mb2"><span class="breadcrumbs"><span class="crumb"><a href="/" class="pink nuxt-link-active">ofDocs</a><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/" class="pink nuxt-link-active">openframeworks </a><!----><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/video/" class="pink nuxt-link-active">video </a><!----><span class="chevron right"></span></span><span class="crumb"><!----><span class="link">ofDirectShowPlayer.cpp </span><!----></span></span></div></div></div></div><div id="code-page" class="markdown"><div id="side-menu"><!----><div id="see-also" filename="video" absolute="/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/video" dir="../libs/openFrameworks" route="/openframeworks/video/" ext="" type="folder" children="355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381" icon="videocam" parent="195" breadcrumbs="195" class="see-also"><h4>See also</h4><div class="also"><a href="/documentation/video/"><span class="origin">documentation</span><span class="name">video</span></a></div><div class="also"><a href="/examples/video/videoPlayerExample/"><span class="origin">examples</span><span class="name">videoPlayerExample</span></a></div><div class="also"><a href="/examples/video/videoGrabberExample/"><span class="origin">examples</span><span class="name">videoGrabberExample</span></a></div><div class="also"><a href="/examples/video/"><span class="origin">examples</span><span class="name">video</span></a></div><div class="also"><a href="/examples/ios/videoGrabberExample/"><span class="origin">examples</span><span class="name">videoGrabberExample</span></a></div></div></div><div id="code-render" id="code-inner"><div class="inner"><pre><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofDirectShowPlayer.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofPixels.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofMath.h"</span></span>

<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// DirectShow includes and helper methods </span>
<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>


<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;dshow.h></span></span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> include_alias( "dxtrans.h", "qedit.h" )</span>
<span class="token macro property">#<span class="token directive keyword">define</span> __IDxtCompositor_INTERFACE_DEFINED__</span>
<span class="token macro property">#<span class="token directive keyword">define</span> __IDxtAlphaSetter_INTERFACE_DEFINED__</span>
<span class="token macro property">#<span class="token directive keyword">define</span> __IDxtJpeg_INTERFACE_DEFINED__</span>
<span class="token macro property">#<span class="token directive keyword">define</span> __IDxtKey_INTERFACE_DEFINED__</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;aviriff.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>

<span class="token comment" spellcheck="true">//for threading</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;process.h></span></span>

<span class="token comment" spellcheck="true">// Due to a missing qedit.h in recent Platform SDKs, we've replicated the relevant contents here</span>
<span class="token comment" spellcheck="true">// #include &lt;qedit.h></span>
<span class="token function">MIDL_INTERFACE</span><span class="token punctuation">(</span><span class="token string">"0579154A-2B53-4994-B0D0-E773148EFF85"</span><span class="token punctuation">)</span>
ISampleGrabberCB <span class="token operator">:</span> <span class="token keyword">public</span> IUnknown
<span class="token punctuation">{</span>
  <span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">SampleCB</span><span class="token punctuation">(</span> 
        <span class="token keyword">double</span> SampleTime<span class="token punctuation">,</span>
        IMediaSample <span class="token operator">*</span>pSample<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">BufferCB</span><span class="token punctuation">(</span> 
        <span class="token keyword">double</span> SampleTime<span class="token punctuation">,</span>
        BYTE <span class="token operator">*</span>pBuffer<span class="token punctuation">,</span>
        <span class="token keyword">long</span> BufferLen<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">MIDL_INTERFACE</span><span class="token punctuation">(</span><span class="token string">"6B652FFF-11FE-4fce-92AD-0266B5D7C78F"</span><span class="token punctuation">)</span>
ISampleGrabber <span class="token operator">:</span> <span class="token keyword">public</span> IUnknown
<span class="token punctuation">{</span>
  <span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">SetOneShot</span><span class="token punctuation">(</span> 
        BOOL OneShot<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">SetMediaType</span><span class="token punctuation">(</span> 
        <span class="token keyword">const</span> AM_MEDIA_TYPE <span class="token operator">*</span>pType<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">GetConnectedMediaType</span><span class="token punctuation">(</span> 
        AM_MEDIA_TYPE <span class="token operator">*</span>pType<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">SetBufferSamples</span><span class="token punctuation">(</span> 
        BOOL BufferThem<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">GetCurrentBuffer</span><span class="token punctuation">(</span> 
        <span class="token comment" spellcheck="true">/* [out][in] */</span> <span class="token keyword">long</span> <span class="token operator">*</span>pBufferSize<span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">/* [out] */</span> <span class="token keyword">long</span> <span class="token operator">*</span>pBuffer<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">GetCurrentSample</span><span class="token punctuation">(</span> 
        <span class="token comment" spellcheck="true">/* [retval][out] */</span> IMediaSample <span class="token operator">*</span><span class="token operator">*</span>ppSample<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">virtual</span> HRESULT STDMETHODCALLTYPE <span class="token function">SetCallback</span><span class="token punctuation">(</span> 
        ISampleGrabberCB <span class="token operator">*</span>pCallback<span class="token punctuation">,</span>
        <span class="token keyword">long</span> WhichMethodToCallback<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span><span class="token punctuation">;</span>
EXTERN_C <span class="token keyword">const</span> CLSID CLSID_SampleGrabber<span class="token punctuation">;</span>
EXTERN_C <span class="token keyword">const</span> IID IID_ISampleGrabber<span class="token punctuation">;</span>
EXTERN_C <span class="token keyword">const</span> CLSID CLSID_NullRenderer<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// GetUnconnectedPin   </span>
<span class="token comment" spellcheck="true">//    Finds an unconnected pin on a filter in the desired direction   </span>
HRESULT <span class="token function">GetUnconnectedPin</span><span class="token punctuation">(</span>   
                          IBaseFilter <span class="token operator">*</span>pFilter<span class="token punctuation">,</span>   <span class="token comment" spellcheck="true">// Pointer to the filter.   </span>
                          PIN_DIRECTION PinDir<span class="token punctuation">,</span>   <span class="token comment" spellcheck="true">// Direction of the pin to find.   </span>
                          IPin <span class="token operator">*</span><span class="token operator">*</span>ppPin<span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// Receives a pointer to the pin.   </span>
<span class="token punctuation">{</span>   
    <span class="token operator">*</span>ppPin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
    IEnumPins <span class="token operator">*</span>pEnum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
    IPin <span class="token operator">*</span>pPin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
    HRESULT hr <span class="token operator">=</span> pFilter<span class="token operator">-</span><span class="token operator">></span><span class="token function">EnumPins</span><span class="token punctuation">(</span><span class="token operator">&</span>pEnum<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token keyword">return</span> hr<span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    <span class="token keyword">while</span> <span class="token punctuation">(</span>pEnum<span class="token operator">-</span><span class="token operator">></span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&</span>pPin<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> S_OK<span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        PIN_DIRECTION ThisPinDir<span class="token punctuation">;</span>   
        pPin<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryDirection</span><span class="token punctuation">(</span><span class="token operator">&</span>ThisPinDir<span class="token punctuation">)</span><span class="token punctuation">;</span>   
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ThisPinDir <span class="token operator">==</span> PinDir<span class="token punctuation">)</span>   
        <span class="token punctuation">{</span>   
            IPin <span class="token operator">*</span>pTmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
            hr <span class="token operator">=</span> pPin<span class="token operator">-</span><span class="token operator">></span><span class="token function">ConnectedTo</span><span class="token punctuation">(</span><span class="token operator">&</span>pTmp<span class="token punctuation">)</span><span class="token punctuation">;</span>   
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">SUCCEEDED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// Already connected, not the pin we want.   </span>
            <span class="token punctuation">{</span>   
                pTmp<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
            <span class="token punctuation">}</span>   
            <span class="token keyword">else</span>  <span class="token comment" spellcheck="true">// Unconnected, this is the pin we want.   </span>
            <span class="token punctuation">{</span>   
                pEnum<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
                <span class="token operator">*</span>ppPin <span class="token operator">=</span> pPin<span class="token punctuation">;</span>   
                <span class="token keyword">return</span> S_OK<span class="token punctuation">;</span>   
            <span class="token punctuation">}</span>   
        <span class="token punctuation">}</span>   
        pPin<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    pEnum<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token comment" spellcheck="true">// Did not find a matching pin.   </span>
    <span class="token keyword">return</span> E_FAIL<span class="token punctuation">;</span>   
<span class="token punctuation">}</span>   
 
<span class="token comment" spellcheck="true">// Disconnect any connections to the filter.   </span>
HRESULT <span class="token function">DisconnectPins</span><span class="token punctuation">(</span>IBaseFilter <span class="token operator">*</span>pFilter<span class="token punctuation">)</span>   
<span class="token punctuation">{</span>   
    IEnumPins <span class="token operator">*</span>pEnum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
    IPin <span class="token operator">*</span>pPin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
    HRESULT hr <span class="token operator">=</span> pFilter<span class="token operator">-</span><span class="token operator">></span><span class="token function">EnumPins</span><span class="token punctuation">(</span><span class="token operator">&</span>pEnum<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token keyword">return</span> hr<span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
 
    <span class="token keyword">while</span> <span class="token punctuation">(</span>pEnum<span class="token operator">-</span><span class="token operator">></span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&</span>pPin<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> S_OK<span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        pPin<span class="token operator">-</span><span class="token operator">></span><span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
        pPin<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    pEnum<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
 
    <span class="token comment" spellcheck="true">// Did not find a matching pin.   </span>
    <span class="token keyword">return</span> S_OK<span class="token punctuation">;</span>   
<span class="token punctuation">}</span>   
 
<span class="token comment" spellcheck="true">// ConnectFilters   </span>
<span class="token comment" spellcheck="true">//    Connects a pin of an upstream filter to the pDest downstream filter   </span>
HRESULT <span class="token function">ConnectFilters</span><span class="token punctuation">(</span>   
                       IGraphBuilder <span class="token operator">*</span>pGraph<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Filter Graph Manager.   </span>
                       IPin <span class="token operator">*</span>pOut<span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// Output pin on the upstream filter.   </span>
                       IBaseFilter <span class="token operator">*</span>pDest<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// Downstream filter.   </span>
<span class="token punctuation">{</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pGraph <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>pOut <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>pDest <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token keyword">return</span> E_POINTER<span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
<span class="token macro property">#<span class="token directive keyword">ifdef</span> debug   </span>
    PIN_DIRECTION PinDir<span class="token punctuation">;</span>   
    pOut<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryDirection</span><span class="token punctuation">(</span><span class="token operator">&</span>PinDir<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">_ASSERTE</span><span class="token punctuation">(</span>PinDir <span class="token operator">==</span> PINDIR_OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token macro property">#<span class="token directive keyword">endif</span>   </span>
 
    <span class="token comment" spellcheck="true">// Find an input pin on the downstream filter.   </span>
    IPin <span class="token operator">*</span>pIn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
    HRESULT hr <span class="token operator">=</span> <span class="token function">GetUnconnectedPin</span><span class="token punctuation">(</span>pDest<span class="token punctuation">,</span> PINDIR_INPUT<span class="token punctuation">,</span> <span class="token operator">&</span>pIn<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token keyword">return</span> hr<span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    <span class="token comment" spellcheck="true">// Try to connect them.   </span>
    hr <span class="token operator">=</span> pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">Connect</span><span class="token punctuation">(</span>pOut<span class="token punctuation">,</span> pIn<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    pIn<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">return</span> hr<span class="token punctuation">;</span>   
<span class="token punctuation">}</span>   
 
 
 
<span class="token comment" spellcheck="true">// ConnectFilters   </span>
<span class="token comment" spellcheck="true">//    Connects two filters   </span>
HRESULT <span class="token function">ConnectFilters</span><span class="token punctuation">(</span>   
                       IGraphBuilder <span class="token operator">*</span>pGraph<span class="token punctuation">,</span>    
                       IBaseFilter <span class="token operator">*</span>pSrc<span class="token punctuation">,</span>    
                       IBaseFilter <span class="token operator">*</span>pDest<span class="token punctuation">)</span>   
<span class="token punctuation">{</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pGraph <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>pSrc <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>pDest <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token keyword">return</span> E_POINTER<span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
 
    <span class="token comment" spellcheck="true">// Find an output pin on the first filter.   </span>
    IPin <span class="token operator">*</span>pOut <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
    HRESULT hr <span class="token operator">=</span> <span class="token function">GetUnconnectedPin</span><span class="token punctuation">(</span>pSrc<span class="token punctuation">,</span> PINDIR_OUTPUT<span class="token punctuation">,</span> <span class="token operator">&</span>pOut<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span>    
    <span class="token punctuation">{</span>   
        <span class="token keyword">return</span> hr<span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    hr <span class="token operator">=</span> <span class="token function">ConnectFilters</span><span class="token punctuation">(</span>pGraph<span class="token punctuation">,</span> pOut<span class="token punctuation">,</span> pDest<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    pOut<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">return</span> hr<span class="token punctuation">;</span>   
<span class="token punctuation">}</span>   
 
<span class="token comment" spellcheck="true">// LocalFreeMediaType   </span>
<span class="token comment" spellcheck="true">//    Free the format buffer in the media type   </span>
<span class="token keyword">void</span> <span class="token function">LocalFreeMediaType</span><span class="token punctuation">(</span>AM_MEDIA_TYPE<span class="token operator">&</span> mt<span class="token punctuation">)</span>   
<span class="token punctuation">{</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mt<span class="token punctuation">.</span>cbFormat <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token function">CoTaskMemFree</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span>mt<span class="token punctuation">.</span>pbFormat<span class="token punctuation">)</span><span class="token punctuation">;</span>   
        mt<span class="token punctuation">.</span>cbFormat <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   
        mt<span class="token punctuation">.</span>pbFormat <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mt<span class="token punctuation">.</span>pUnk <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token comment" spellcheck="true">// Unecessary because pUnk should not be used, but safest.   </span>
        mt<span class="token punctuation">.</span>pUnk<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
        mt<span class="token punctuation">.</span>pUnk <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>   
 
<span class="token comment" spellcheck="true">// LocalDeleteMediaType   </span>
<span class="token comment" spellcheck="true">//    Free the format buffer in the media type,    </span>
<span class="token comment" spellcheck="true">//    then delete the MediaType ptr itself   </span>
<span class="token keyword">void</span> <span class="token function">LocalDeleteMediaType</span><span class="token punctuation">(</span>AM_MEDIA_TYPE <span class="token operator">*</span>pmt<span class="token punctuation">)</span>   
<span class="token punctuation">{</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pmt <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>   
    <span class="token punctuation">{</span>   
        <span class="token function">LocalFreeMediaType</span><span class="token punctuation">(</span><span class="token operator">*</span>pmt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// See FreeMediaType for the implementation.   </span>
        <span class="token function">CoTaskMemFree</span><span class="token punctuation">(</span>pmt<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>


HRESULT <span class="token function">SaveGraphFile</span><span class="token punctuation">(</span>IGraphBuilder <span class="token operator">*</span>pGraph<span class="token punctuation">,</span> WCHAR <span class="token operator">*</span>wszPath<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> WCHAR wszStreamName<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token string">"ActiveMovieGraph"</span><span class="token punctuation">;</span> 
    HRESULT hr<span class="token punctuation">;</span>
    
    IStorage <span class="token operator">*</span>pStorage <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    hr <span class="token operator">=</span> <span class="token function">StgCreateDocfile</span><span class="token punctuation">(</span>
        wszPath<span class="token punctuation">,</span>
        STGM_CREATE <span class="token operator">|</span> STGM_TRANSACTED <span class="token operator">|</span> STGM_READWRITE <span class="token operator">|</span> STGM_SHARE_EXCLUSIVE<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&</span>pStorage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> hr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    IStream <span class="token operator">*</span>pStream<span class="token punctuation">;</span>
    hr <span class="token operator">=</span> pStorage<span class="token operator">-</span><span class="token operator">></span><span class="token function">CreateStream</span><span class="token punctuation">(</span>
        wszStreamName<span class="token punctuation">,</span>
        STGM_WRITE <span class="token operator">|</span> STGM_CREATE <span class="token operator">|</span> STGM_SHARE_EXCLUSIVE<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&</span>pStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        pStorage<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> hr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    IPersistStream <span class="token operator">*</span>pPersist <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>IID_IPersistStream<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>pPersist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    hr <span class="token operator">=</span> pPersist<span class="token operator">-</span><span class="token operator">></span><span class="token function">Save</span><span class="token punctuation">(</span>pStream<span class="token punctuation">,</span> TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pStream<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pPersist<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">SUCCEEDED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        hr <span class="token operator">=</span> pStorage<span class="token operator">-</span><span class="token operator">></span><span class="token function">Commit</span><span class="token punctuation">(</span>STGC_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    pStorage<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> hr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// DirectShowVideo - contains a simple directshow video player implementation</span>
<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>

<span class="token keyword">namespace</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> comRefCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">retainCom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> comRefCount <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//printf("com is initialized!\n");</span>
            <span class="token function">CoInitializeEx</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> COINIT_APARTMENTTHREADED<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        comRefCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">releaseCom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        comRefCount<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> comRefCount <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//printf("com is uninitialized!\n");</span>
            <span class="token function">CoUninitialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">releaseSample</span><span class="token punctuation">(</span>IMediaSample <span class="token operator">*</span> sample<span class="token punctuation">)</span><span class="token punctuation">{</span>
        sample<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">DirectShowVideo</span> <span class="token operator">:</span> <span class="token keyword">public</span> ISampleGrabberCB<span class="token punctuation">{</span>
    <span class="token keyword">public</span><span class="token operator">:</span>

    <span class="token function">DirectShowVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">retainCom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">InitializeCriticalSection</span><span class="token punctuation">(</span><span class="token operator">&</span>critSection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">DirectShowVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		middleSample<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		backSample<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">releaseCom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">DeleteCriticalSection</span><span class="token punctuation">(</span><span class="token operator">&</span>critSection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//printf("tearDown\n"); </span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pControl<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pEvent<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pEvent<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pSeek<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pSeek<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pAudio<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pAudio<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pBasicVideo<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pBasicVideo<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pGrabber<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pGrabber<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pGrabberF<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pGrabberF<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pGraph<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_pNullRenderer<span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pNullRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> m_pSourceFile <span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pSourceFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> m_pPosition <span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pPosition<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">clearValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">clearValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        hr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        m_pGraph <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        m_pControl <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> 
        m_pEvent <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> 
        m_pSeek <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> 
        m_pAudio <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> 
        m_pGrabber <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        m_pGrabberF <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        m_pBasicVideo <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        m_pNullRenderer <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        m_pSourceFile <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        m_pPosition <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

        timeNow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        lPositionInSecs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        lDurationInNanoSecs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        lTotalDuration <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        rtNew <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        lPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        lvolume <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">;</span>
        evCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        width <span class="token operator">=</span> height <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        bVideoOpened <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    
        bLoop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        bPaused <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        bPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        bEndReached <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
        bNewPixels <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        bFrameNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        curMovieFrame <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
        frameCount <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

        movieRate <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> 
        averageTimePerFrame <span class="token operator">=</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">30.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//------------------------------------------------</span>
    <span class="token function">STDMETHODIMP_</span><span class="token punctuation">(</span>ULONG<span class="token punctuation">)</span> <span class="token function">AddRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token function">STDMETHODIMP_</span><span class="token punctuation">(</span>ULONG<span class="token punctuation">)</span> <span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">//------------------------------------------------</span>
    STDMETHODIMP <span class="token function">QueryInterface</span><span class="token punctuation">(</span>REFIID riid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>ppvObject<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">*</span>ppvObject <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>ISampleGrabberCB<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> S_OK<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">//------------------------------------------------</span>
    STDMETHODIMP <span class="token function">SampleCB</span><span class="token punctuation">(</span><span class="token keyword">double</span> Time<span class="token punctuation">,</span> IMediaSample <span class="token operator">*</span>pSample<span class="token punctuation">)</span><span class="token punctuation">{</span>

        BYTE <span class="token operator">*</span> ptrBuffer <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> 
        HRESULT hr <span class="token operator">=</span> pSample<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetPointer</span><span class="token punctuation">(</span><span class="token operator">&</span>ptrBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>hr <span class="token operator">==</span> S_OK<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">long</span> latestBufferLength <span class="token operator">=</span> pSample<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetActualDataLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>latestBufferLength <span class="token operator">==</span> pixels<span class="token punctuation">.</span><span class="token function">getTotalBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">EnterCriticalSection</span><span class="token punctuation">(</span><span class="token operator">&</span>critSection<span class="token punctuation">)</span><span class="token punctuation">;</span>
				pSample<span class="token operator">-</span><span class="token operator">></span><span class="token function">AddRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                backSample <span class="token operator">=</span> std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>IMediaSample<span class="token punctuation">,</span> std<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span>IMediaSample<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token punctuation">(</span>pSample<span class="token punctuation">,</span> releaseSample<span class="token punctuation">)</span><span class="token punctuation">;</span>
                bNewPixels <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">//this is just so we know if there is a new frame</span>
                frameCount<span class="token operator">++</span><span class="token punctuation">;</span>

                <span class="token function">LeaveCriticalSection</span><span class="token punctuation">(</span><span class="token operator">&</span>critSection<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR: SampleCB() - buffer sizes do not match %d %d\n"</span><span class="token punctuation">,</span> latestBufferLength<span class="token punctuation">,</span> pixels<span class="token punctuation">.</span><span class="token function">getTotalBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> S_OK<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//This method is meant to have more overhead</span>
    STDMETHODIMP <span class="token function">BufferCB</span><span class="token punctuation">(</span><span class="token keyword">double</span> Time<span class="token punctuation">,</span> BYTE <span class="token operator">*</span>pBuffer<span class="token punctuation">,</span> <span class="token keyword">long</span> BufferLen<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> E_NOTIMPL<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">loadMovie</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string path<span class="token punctuation">,</span> ofPixelFormat format<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>pixelFormat <span class="token operator">=</span> format<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Create the Filter Graph Manager and query for interfaces.</span>

        <span class="token comment" spellcheck="true">//printf("step 1\n"); </span>
        hr <span class="token operator">=</span> <span class="token function">CoCreateInstance</span><span class="token punctuation">(</span>CLSID_FilterGraph<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CLSCTX_INPROC_SERVER<span class="token punctuation">,</span>IID_IGraphBuilder<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pGraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">//printf("step 2\n"); </span>
        hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>IID_IMediaSeeking<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pSeek<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>IID_IMediaPosition<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>IID_IBasicAudio<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pAudio<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Use IGraphBuilder::QueryInterface (inherited from IUnknown) to get the IMediaControl interface.</span>
        <span class="token comment" spellcheck="true">//printf("step 4\n"); </span>
        hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>IID_IMediaControl<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pControl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>  
    
        <span class="token comment" spellcheck="true">// And get the Media Event interface, too.</span>
        <span class="token comment" spellcheck="true">//printf("step 5\n"); </span>
        hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>IID_IMediaEvent<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 

        <span class="token comment" spellcheck="true">//SAMPLE GRABBER (ALLOWS US TO GRAB THE BUFFER)//</span>
        <span class="token comment" spellcheck="true">// Create the Sample Grabber.</span>
        hr <span class="token operator">=</span> <span class="token function">CoCreateInstance</span><span class="token punctuation">(</span>CLSID_SampleGrabber<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CLSCTX_INPROC_SERVER<span class="token punctuation">,</span>IID_IBaseFilter<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pGrabberF<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 

        hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">AddFilter</span><span class="token punctuation">(</span>m_pGrabberF<span class="token punctuation">,</span> L<span class="token string">"Sample Grabber"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        hr <span class="token operator">=</span> m_pGrabberF<span class="token operator">-</span><span class="token operator">></span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>IID_ISampleGrabber<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>m_pGrabber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        hr <span class="token operator">=</span> m_pGrabber<span class="token operator">-</span><span class="token operator">></span><span class="token function">SetCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">//MEDIA CONVERSION</span>
        <span class="token comment" spellcheck="true">//Get video properties from the stream's mediatype and apply to the grabber (otherwise we don't get an RGB image)</span>
        AM_MEDIA_TYPE mt<span class="token punctuation">;</span>
        <span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&</span>mt<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>AM_MEDIA_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        mt<span class="token punctuation">.</span>majortype    <span class="token operator">=</span> MEDIATYPE_Video<span class="token punctuation">;</span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span>format<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> OF_PIXELS_RGB<span class="token operator">:</span>
		<span class="token keyword">case</span> OF_PIXELS_BGR<span class="token operator">:</span>
			mt<span class="token punctuation">.</span>subtype <span class="token operator">=</span> MEDIASUBTYPE_RGB24<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> OF_PIXELS_BGRA<span class="token operator">:</span>
		<span class="token keyword">case</span> OF_PIXELS_RGBA<span class="token operator">:</span>
			mt<span class="token punctuation">.</span>subtype <span class="token operator">=</span> MEDIASUBTYPE_RGB32<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"DirectShowPlayer"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Trying to set unsupported format this is an internal bug, using default RGB"</span><span class="token punctuation">;</span>
			mt<span class="token punctuation">.</span>subtype <span class="token operator">=</span> MEDIASUBTYPE_RGB24<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

        mt<span class="token punctuation">.</span>formattype   <span class="token operator">=</span> FORMAT_VideoInfo<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//printf("step 5.5\n"); </span>
        hr <span class="token operator">=</span> m_pGrabber<span class="token operator">-</span><span class="token operator">></span><span class="token function">SetMediaType</span><span class="token punctuation">(</span><span class="token operator">&</span>mt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">//printf("step 6\n"); </span>
        std<span class="token operator">::</span>wstring filePathW <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">wstring</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//this is the easier way to connect the graph, but we have to remove the video window manually</span>
        hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">RenderFile</span><span class="token punctuation">(</span>filePathW<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//this is the more manual way to do it - its a pain though because the audio won't be connected by default</span>
        <span class="token comment" spellcheck="true">/*hr = m_pGraph->AddSourceFilter(filePathW.c_str(), L"Source", &m_pSourceFile); 
        if (FAILED(hr)){
            printf("unable to AddSourceFilter\n");
            tearDown(); 
            return false;
        }*/</span>
        <span class="token comment" spellcheck="true">//hr = ConnectFilters(m_pGraph, m_pSourceFile, m_pGrabberF);</span>
        <span class="token comment" spellcheck="true">//if (FAILED(hr)){</span>
        <span class="token comment" spellcheck="true">//  printf("unable to ConnectFilters(m_pGraph, m_pSourceFile, m_pGrabberF)\n");</span>
        <span class="token comment" spellcheck="true">//  tearDown(); </span>
        <span class="token comment" spellcheck="true">//  return false;</span>
        <span class="token comment" spellcheck="true">//}</span>

        <span class="token comment" spellcheck="true">//printf("step 7\n"); </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">SUCCEEDED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

            <span class="token comment" spellcheck="true">//Set Params - One Shot should be false unless you want to capture just one buffer</span>
            hr <span class="token operator">=</span> m_pGrabber<span class="token operator">-</span><span class="token operator">></span><span class="token function">SetOneShot</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"unable to set one shot\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment" spellcheck="true">//apparently setting to TRUE causes a small memory leak</span>
            hr <span class="token operator">=</span> m_pGrabber<span class="token operator">-</span><span class="token operator">></span><span class="token function">SetBufferSamples</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"unable to set buffer samples\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">//NULL RENDERER//</span>
            <span class="token comment" spellcheck="true">//used to give the video stream somewhere to go to.</span>
            hr <span class="token operator">=</span> <span class="token function">CoCreateInstance</span><span class="token punctuation">(</span>CLSID_NullRenderer<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CLSCTX_INPROC_SERVER<span class="token punctuation">,</span> IID_IBaseFilter<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&</span>m_pNullRenderer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"null renderer error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>       

            hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">AddFilter</span><span class="token punctuation">(</span>m_pNullRenderer<span class="token punctuation">,</span> L<span class="token string">"Render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"unable to add null renderer\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment" spellcheck="true">//hr = ConnectFilters(m_pGraph, m_pGrabberF, m_pNullRenderer);</span>
            <span class="token comment" spellcheck="true">//if (FAILED(hr)){</span>
            <span class="token comment" spellcheck="true">//  printf("unable to ConnectFilters(m_pGraph, m_pGrabberF, m_pNullRenderer)\n");</span>
            <span class="token comment" spellcheck="true">//  tearDown(); </span>
            <span class="token comment" spellcheck="true">//  return false;</span>
            <span class="token comment" spellcheck="true">//}</span>
    
            AM_MEDIA_TYPE mt<span class="token punctuation">;</span>
            <span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&</span>mt<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>AM_MEDIA_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
            hr <span class="token operator">=</span> m_pGrabber<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetConnectedMediaType</span><span class="token punctuation">(</span><span class="token operator">&</span>mt<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"unable to call GetConnectedMediaType\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            VIDEOINFOHEADER <span class="token operator">*</span> infoheader <span class="token operator">=</span> <span class="token punctuation">(</span>VIDEOINFOHEADER<span class="token operator">*</span><span class="token punctuation">)</span>mt<span class="token punctuation">.</span>pbFormat<span class="token punctuation">;</span>
            width <span class="token operator">=</span> infoheader<span class="token operator">-</span><span class="token operator">></span>bmiHeader<span class="token punctuation">.</span>biWidth<span class="token punctuation">;</span>
            height <span class="token operator">=</span> infoheader<span class="token operator">-</span><span class="token operator">></span>bmiHeader<span class="token punctuation">.</span>biHeight<span class="token punctuation">;</span>
            averageTimePerFrame <span class="token operator">=</span> infoheader<span class="token operator">-</span><span class="token operator">></span>AvgTimePerFrame <span class="token operator">/</span> <span class="token number">10000000.0</span><span class="token punctuation">;</span>
			pixels<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> pixelFormat<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">//printf("video dimensions are %i %i\n", width, height); </span>

            <span class="token comment" spellcheck="true">//we need to manually change the output from the renderer window to the null renderer</span>
            IBaseFilter <span class="token operator">*</span> m_pVideoRenderer<span class="token punctuation">;</span>
            IPin<span class="token operator">*</span> pinIn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            IPin<span class="token operator">*</span> pinOut <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">FindFilterByName</span><span class="token punctuation">(</span>L<span class="token string">"Video Renderer"</span><span class="token punctuation">,</span> <span class="token operator">&</span>m_pVideoRenderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to find the video renderer\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">//we disconnect the video renderer window by finding the output pin of the sample grabber</span>
            hr <span class="token operator">=</span> m_pGrabberF<span class="token operator">-</span><span class="token operator">></span><span class="token function">FindPin</span><span class="token punctuation">(</span>L<span class="token string">"Out"</span><span class="token punctuation">,</span> <span class="token operator">&</span>pinOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to find the sample grabber output pin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            hr <span class="token operator">=</span> pinOut<span class="token operator">-</span><span class="token operator">></span><span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to disconnect grabber output pin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">//SaveGraphFile(m_pGraph, L"test1.grf");</span>

            <span class="token comment" spellcheck="true">//we have to remove it as well otherwise the graph builder will reconnect it</span>
            hr <span class="token operator">=</span> m_pGraph<span class="token operator">-</span><span class="token operator">></span><span class="token function">RemoveFilter</span><span class="token punctuation">(</span>m_pVideoRenderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to remove the default renderer\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                m_pVideoRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">//now connect the null renderer to the grabber output, if we don't do this not frames will be captured</span>
            hr <span class="token operator">=</span> m_pNullRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">FindPin</span><span class="token punctuation">(</span>L<span class="token string">"In"</span><span class="token punctuation">,</span> <span class="token operator">&</span>pinIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to find the input pin of the null renderer\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            hr <span class="token operator">=</span> pinOut<span class="token operator">-</span><span class="token operator">></span><span class="token function">Connect</span><span class="token punctuation">(</span>pinIn<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to connect the null renderer\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">//printf("step 8\n"); </span>
            <span class="token comment" spellcheck="true">// Run the graph.</span>
        
            <span class="token comment" spellcheck="true">//SaveGraphFile(m_pGraph, L"test2.grf");</span>
            hr <span class="token operator">=</span> m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment" spellcheck="true">//SaveGraphFile(m_pGraph, L"test3.grf");</span>

            <span class="token comment" spellcheck="true">// Now pause the graph.</span>
            hr <span class="token operator">=</span> m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">updatePlayState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">FAILED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span> <span class="token operator">||</span> width <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> height <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error occured while playing or pausing or opening the file\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error occured while playing or pausing or opening the file\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>

        bVideoOpened <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>

            <span class="token keyword">long</span> eventCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> _WIN64</span>
            <span class="token keyword">long</span> <span class="token keyword">long</span> ptrParam1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> <span class="token keyword">long</span> ptrParam2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
            <span class="token keyword">long</span> ptrParam1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> ptrParam2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
            <span class="token keyword">long</span> timeoutMs <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span> curMovieFrame <span class="token operator">!=</span> frameCount <span class="token punctuation">)</span><span class="token punctuation">{</span>
                bFrameNew <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                bFrameNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
            curMovieFrame <span class="token operator">=</span> frameCount<span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>S_OK <span class="token operator">==</span> m_pEvent<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetEvent</span><span class="token punctuation">(</span><span class="token operator">&</span>eventCode<span class="token punctuation">,</span> <span class="token operator">&</span>ptrParam1<span class="token punctuation">,</span> <span class="token operator">&</span>ptrParam2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>eventCode <span class="token operator">==</span> EC_COMPLETE <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>bLoop<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">//printf("Restarting!\n");</span>
                        <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        bEndReached <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
                        <span class="token comment" spellcheck="true">//printf("movie end reached!\n");</span>
                        <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">updatePlayState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment" spellcheck="true">//printf("Event code: %#04x\n Params: %d, %d\n", eventCode, ptrParam1, ptrParam2);</span>
                m_pEvent<span class="token operator">-</span><span class="token operator">></span><span class="token function">FreeEventParams</span><span class="token punctuation">(</span>eventCode<span class="token punctuation">,</span> ptrParam1<span class="token punctuation">,</span> ptrParam2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> bVideoOpened<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//volume has to be log corrected/converted</span>
    <span class="token keyword">void</span> <span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token keyword">float</span> volPct<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>   
            <span class="token keyword">if</span><span class="token punctuation">(</span> volPct <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> volPct <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> volPct <span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">)</span> volPct <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> 

            <span class="token keyword">long</span> vol <span class="token operator">=</span> <span class="token function">log10</span><span class="token punctuation">(</span>volPct<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4000.0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vol <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                vol <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            m_pAudio<span class="token operator">-</span><span class="token operator">></span><span class="token function">put_Volume</span><span class="token punctuation">(</span>vol<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">float</span> <span class="token function">getVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">float</span> volPct <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">long</span> vol <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            m_pAudio<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_Volume</span><span class="token punctuation">(</span><span class="token operator">&</span>vol<span class="token punctuation">)</span><span class="token punctuation">;</span>
            volPct <span class="token operator">=</span> <span class="token function">powf</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>vol<span class="token operator">/</span><span class="token number">4000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> volPct<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> <span class="token function">getDurationInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">long</span> <span class="token keyword">long</span> lDurationInNanoSecs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            m_pSeek<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetDuration</span><span class="token punctuation">(</span><span class="token operator">&</span>lDurationInNanoSecs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">double</span> timeInSeconds <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>lDurationInNanoSecs<span class="token operator">/</span><span class="token number">10000000.0</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> timeInSeconds<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> <span class="token function">getCurrentTimeInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">long</span> <span class="token keyword">long</span> lCurrentTimeInNanoSecs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            m_pSeek<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetCurrentPosition</span><span class="token punctuation">(</span><span class="token operator">&</span>lCurrentTimeInNanoSecs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">double</span> timeInSeconds <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>lCurrentTimeInNanoSecs<span class="token operator">/</span><span class="token number">10000000.0</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> timeInSeconds<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token keyword">float</span> pct<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> pct <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> pct <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span> pct <span class="token operator">></span> <span class="token number">1.0</span> <span class="token punctuation">)</span> pct <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> 
            
            <span class="token keyword">long</span> <span class="token keyword">long</span> lDurationInNanoSecs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            m_pSeek<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetDuration</span><span class="token punctuation">(</span><span class="token operator">&</span>lDurationInNanoSecs<span class="token punctuation">)</span><span class="token punctuation">;</span>

            rtNew <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>lDurationInNanoSecs <span class="token operator">*</span> pct<span class="token punctuation">)</span><span class="token punctuation">;</span>             
            hr <span class="token operator">=</span> m_pSeek<span class="token operator">-</span><span class="token operator">></span><span class="token function">SetPositions</span><span class="token punctuation">(</span><span class="token operator">&</span>rtNew<span class="token punctuation">,</span> AM_SEEKING_AbsolutePositioning<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>AM_SEEKING_NoPositioning<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">float</span> <span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">float</span> timeDur <span class="token operator">=</span> <span class="token function">getDurationInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span> timeDur <span class="token operator">></span> <span class="token number">0.0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">getCurrentTimeInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> timeDur<span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token keyword">float</span> speed<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pPosition<span class="token operator">-</span><span class="token operator">></span><span class="token function">put_Rate</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_pPosition<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_Rate</span><span class="token punctuation">(</span><span class="token operator">&</span>movieRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> <span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> movieRate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">needsRBSwap</span><span class="token punctuation">(</span>ofPixelFormat srcFormat<span class="token punctuation">,</span> ofPixelFormat dstFormat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
			<span class="token punctuation">(</span>srcFormat <span class="token operator">==</span> OF_PIXELS_BGR <span class="token operator">||</span> srcFormat <span class="token operator">==</span> OF_PIXELS_BGRA<span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token punctuation">(</span>dstFormat <span class="token operator">==</span> OF_PIXELS_RGB <span class="token operator">||</span> dstFormat <span class="token operator">==</span> OF_PIXELS_RGBA<span class="token punctuation">)</span> <span class="token operator">||</span>
			<span class="token punctuation">(</span>srcFormat <span class="token operator">==</span> OF_PIXELS_RGB <span class="token operator">||</span> srcFormat <span class="token operator">==</span> OF_PIXELS_RGBA<span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token punctuation">(</span>dstFormat <span class="token operator">==</span> OF_PIXELS_BGR <span class="token operator">||</span> dstFormat <span class="token operator">==</span> OF_PIXELS_BGRA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">processPixels</span><span class="token punctuation">(</span>ofPixels <span class="token operator">&</span> src<span class="token punctuation">,</span> ofPixels <span class="token operator">&</span> dst<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">auto</span> format <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">needsRBSwap</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dst<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> OF_PIXELS_BGR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				dst<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OF_PIXELS_RGB<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">auto</span> dstLine <span class="token operator">=</span> dst<span class="token punctuation">.</span><span class="token function">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">auto</span> srcLine <span class="token operator">=</span> <span class="token operator">--</span>src<span class="token punctuation">.</span><span class="token function">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">auto</span> endLine <span class="token operator">=</span> dst<span class="token punctuation">.</span><span class="token function">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> dstLine <span class="token operator">!=</span> endLine<span class="token punctuation">;</span> dstLine<span class="token operator">++</span><span class="token punctuation">,</span> srcLine<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">auto</span> dstPixel <span class="token operator">=</span> dstLine<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">auto</span> srcPixel <span class="token operator">=</span> srcLine<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">auto</span> endPixel <span class="token operator">=</span> dstLine<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> dstPixel <span class="token operator">!=</span> endPixel<span class="token punctuation">;</span> dstPixel<span class="token operator">++</span><span class="token punctuation">,</span> srcPixel<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						dstPixel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> srcPixel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						dstPixel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> srcPixel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						dstPixel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> srcPixel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> OF_PIXELS_BGRA<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				dst<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OF_PIXELS_RGBA<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">auto</span> dstLine <span class="token operator">=</span> dst<span class="token punctuation">.</span><span class="token function">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">auto</span> srcLine <span class="token operator">=</span> <span class="token operator">--</span>src<span class="token punctuation">.</span><span class="token function">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">auto</span> endLine <span class="token operator">=</span> dst<span class="token punctuation">.</span><span class="token function">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> dstLine <span class="token operator">!=</span> endLine<span class="token punctuation">;</span> dstLine<span class="token operator">++</span><span class="token punctuation">,</span> srcLine<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">auto</span> dstPixel <span class="token operator">=</span> dstLine<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">auto</span> srcPixel <span class="token operator">=</span> srcLine<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">auto</span> endPixel <span class="token operator">=</span> dstLine<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> dstPixel <span class="token operator">!=</span> endPixel<span class="token punctuation">;</span> dstPixel<span class="token operator">++</span><span class="token punctuation">,</span> srcPixel<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						dstPixel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> srcPixel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						dstPixel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> srcPixel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						dstPixel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> srcPixel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			src<span class="token punctuation">.</span><span class="token function">mirrorTo</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            bEndReached <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
            <span class="token function">updatePlayState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
            m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">updatePlayState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setPaused</span><span class="token punctuation">(</span><span class="token keyword">bool</span> bPaused<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> bPaused <span class="token punctuation">)</span><span class="token punctuation">{</span>
                m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">Pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
            <span class="token function">updatePlayState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">updatePlayState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            FILTER_STATE fs<span class="token punctuation">;</span>
            hr <span class="token operator">=</span> m_pControl<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetState</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>OAFilterState<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>hr<span class="token operator">==</span>S_OK<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span> fs <span class="token operator">==</span> State_Running <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    bPlaying <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
                    bPaused <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> fs <span class="token operator">==</span> State_Paused <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    bPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    bPaused <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> fs <span class="token operator">==</span> State_Stopped <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    bPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    bPaused <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> bPlaying<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> bPaused<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">isLooping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> bLoop<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setLoop</span><span class="token punctuation">(</span><span class="token keyword">bool</span> loop<span class="token punctuation">)</span><span class="token punctuation">{</span>
        bLoop <span class="token operator">=</span> loop<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">isMovieDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> bEndReached<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">float</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> width<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">float</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">isFrameNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> bFrameNew<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">nextFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//we have to do it like this as the frame based approach is not very accurate</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token operator">&&</span> <span class="token punctuation">(</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">int</span> curFrame <span class="token operator">=</span> <span class="token function">getCurrentFrameNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> curFrameF <span class="token operator">=</span> curFrame<span class="token punctuation">;</span> 
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">setAproximateFrameF</span><span class="token punctuation">(</span> curFrameF <span class="token operator">+</span> <span class="token number">0.3</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>i <span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">getCurrentFrameNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> curFrame <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">preFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//we have to do it like this as the frame based approach is not very accurate</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token operator">&&</span> <span class="token punctuation">(</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">int</span> curFrame <span class="token operator">=</span> <span class="token function">getCurrentFrameNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> curFrameF <span class="token operator">=</span> curFrame<span class="token punctuation">;</span> 
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">setAproximateFrameF</span><span class="token punctuation">(</span> curFrameF <span class="token operator">-</span> <span class="token number">0.3</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>i <span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">getCurrentFrameNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> curFrame <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setAproximateFrameF</span><span class="token punctuation">(</span><span class="token keyword">float</span> frameF<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">float</span> pct <span class="token operator">=</span> frameF <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token function">getAproximateNoFrames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> pct <span class="token operator">></span> <span class="token number">1.0</span> <span class="token punctuation">)</span> pct <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span> pct <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> pct <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> 
            <span class="token function">setPosition</span><span class="token punctuation">(</span>pct<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setAproximateFrame</span><span class="token punctuation">(</span><span class="token keyword">int</span> frame<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">float</span> pct <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>frame <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token function">getAproximateNoFrames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> pct <span class="token operator">></span> <span class="token number">1.0</span> <span class="token punctuation">)</span> pct <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span> pct <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> pct <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> 
            <span class="token function">setPosition</span><span class="token punctuation">(</span>pct<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">getCurrentFrameNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token function">getAproximateNoFrames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">getAproximateNoFrames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> bVideoOpened <span class="token operator">&&</span> averageTimePerFrame <span class="token operator">></span> <span class="token number">0.0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">getDurationInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> averageTimePerFrame<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    ofPixels <span class="token operator">&</span> <span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>bVideoOpened <span class="token operator">&&</span> bNewPixels<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">EnterCriticalSection</span><span class="token punctuation">(</span><span class="token operator">&</span>critSection<span class="token punctuation">)</span><span class="token punctuation">;</span>
			std<span class="token operator">::</span><span class="token function">swap</span><span class="token punctuation">(</span>backSample<span class="token punctuation">,</span> middleSample<span class="token punctuation">)</span><span class="token punctuation">;</span>
			bNewPixels <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token function">LeaveCriticalSection</span><span class="token punctuation">(</span><span class="token operator">&</span>critSection<span class="token punctuation">)</span><span class="token punctuation">;</span>
			BYTE <span class="token operator">*</span> ptrBuffer <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
			HRESULT hr <span class="token operator">=</span> middleSample<span class="token operator">-</span><span class="token operator">></span><span class="token function">GetPointer</span><span class="token punctuation">(</span><span class="token operator">&</span>ptrBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
			ofPixels srcBuffer<span class="token punctuation">;</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span>pixelFormat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> OF_PIXELS_RGB<span class="token operator">:</span>
			<span class="token keyword">case</span> OF_PIXELS_BGR<span class="token operator">:</span>
				srcBuffer<span class="token punctuation">.</span><span class="token function">setFromExternalPixels</span><span class="token punctuation">(</span>ptrBuffer<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> OF_PIXELS_BGR<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> OF_PIXELS_RGBA<span class="token operator">:</span>
			<span class="token keyword">case</span> OF_PIXELS_BGRA<span class="token operator">:</span>
				srcBuffer<span class="token punctuation">.</span><span class="token function">setFromExternalPixels</span><span class="token punctuation">(</span>ptrBuffer<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> OF_PIXELS_BGRA<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

            <span class="token function">processPixels</span><span class="token punctuation">(</span>srcBuffer<span class="token punctuation">,</span> pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//this is the non-callback approach</span>
    <span class="token comment" spellcheck="true">//void getPixels(unsigned char * dstBuffer){</span>
    <span class="token comment" spellcheck="true">//      </span>
    <span class="token comment" spellcheck="true">//  if(bVideoOpened && isFrameNew()){</span>
    <span class="token comment" spellcheck="true">//      long bufferSize = videoSize; </span>
    <span class="token comment" spellcheck="true">//      HRESULT hr = m_pGrabber->GetCurrentBuffer(&bufferSize, (long *)rawBuffer);</span>
    <span class="token comment" spellcheck="true">//      </span>
    <span class="token comment" spellcheck="true">//      if(hr==S_OK){</span>
    <span class="token comment" spellcheck="true">//          if (videoSize == bufferSize){</span>
    <span class="token comment" spellcheck="true">//              processPixels(rawBuffer, dstBuffer, width, height, true, true);</span>
    <span class="token comment" spellcheck="true">//          }else{</span>
    <span class="token comment" spellcheck="true">//              printf("ERROR: GetPixels() - bufferSizes do not match!\n");</span>
    <span class="token comment" spellcheck="true">//          }</span>
    <span class="token comment" spellcheck="true">//      }else{</span>
    <span class="token comment" spellcheck="true">//          printf("ERROR: GetPixels() - Unable to get pixels for device  bufferSize = %i \n", bufferSize);</span>
    <span class="token comment" spellcheck="true">//      }</span>
    <span class="token comment" spellcheck="true">//  }</span>
    <span class="token comment" spellcheck="true">//}</span>

    <span class="token keyword">protected</span><span class="token operator">:</span>

    HRESULT hr<span class="token punctuation">;</span>                         <span class="token comment" spellcheck="true">// COM return value</span>
    IGraphBuilder <span class="token operator">*</span>m_pGraph<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Graph Builder interface</span>
    IMediaControl <span class="token operator">*</span>m_pControl<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Media Control interface</span>
    IMediaEvent   <span class="token operator">*</span>m_pEvent<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Media Event interface</span>
    IMediaSeeking <span class="token operator">*</span>m_pSeek<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// Media Seeking interface</span>
    IMediaPosition <span class="token operator">*</span> m_pPosition<span class="token punctuation">;</span> 
    IBasicAudio   <span class="token operator">*</span>m_pAudio<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Audio Settings interface </span>
    ISampleGrabber <span class="token operator">*</span> m_pGrabber<span class="token punctuation">;</span>
    IBaseFilter <span class="token operator">*</span> m_pSourceFile<span class="token punctuation">;</span>
    IBaseFilter <span class="token operator">*</span> m_pGrabberF<span class="token punctuation">;</span> 
    IBasicVideo <span class="token operator">*</span> m_pBasicVideo<span class="token punctuation">;</span>
    IBaseFilter <span class="token operator">*</span> m_pNullRenderer<span class="token punctuation">;</span>

    REFERENCE_TIME timeNow<span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">// Used for FF & REW of movie, current time</span>
    LONGLONG lPositionInSecs<span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// Time in  seconds</span>
    LONGLONG lDurationInNanoSecs<span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// Duration in nanoseconds</span>
    LONGLONG lTotalDuration<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Total duration</span>
    REFERENCE_TIME rtNew<span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">// Reference time of movie </span>
    <span class="token keyword">long</span> lPosition<span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// Desired position of movie used in FF & REW</span>
    <span class="token keyword">long</span> lvolume<span class="token punctuation">;</span>                   <span class="token comment" spellcheck="true">// The volume level in 1/100ths dB Valid values range from -10,000 (silence) to 0 (full volume), 0 = 0 dB -10000 = -100 dB </span>
    <span class="token keyword">long</span> evCode<span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// event variable, used to in file to complete wait.</span>

    <span class="token keyword">long</span> width<span class="token punctuation">,</span> height<span class="token punctuation">;</span>

    <span class="token keyword">double</span> averageTimePerFrame<span class="token punctuation">;</span> 

    <span class="token keyword">bool</span> bFrameNew<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> bNewPixels<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> bVideoOpened<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> bPlaying<span class="token punctuation">;</span> 
    <span class="token keyword">bool</span> bPaused<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> bLoop<span class="token punctuation">;</span> 
    <span class="token keyword">bool</span> bEndReached<span class="token punctuation">;</span>
    <span class="token keyword">double</span> movieRate<span class="token punctuation">;</span>
    <span class="token keyword">int</span> curMovieFrame<span class="token punctuation">;</span>
    <span class="token keyword">int</span> frameCount<span class="token punctuation">;</span>

    CRITICAL_SECTION critSection<span class="token punctuation">;</span>
	std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>IMediaSample<span class="token punctuation">,</span> std<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span>IMediaSample<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">>></span> backSample<span class="token punctuation">;</span>
	std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>IMediaSample<span class="token punctuation">,</span> std<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span>IMediaSample<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">>></span> middleSample<span class="token punctuation">;</span>
	ofPixels pixels<span class="token punctuation">;</span>
	ofPixelFormat pixelFormat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>




<span class="token comment" spellcheck="true">//----------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//----------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// OF SPECIFIC IMPLEMENTATION BELOW </span>
<span class="token comment" spellcheck="true">//----------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//----------------------------------------------------------------------------------------------------------------------------------------------------------------</span>

ofDirectShowPlayer<span class="token operator">::</span><span class="token function">ofDirectShowPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">:</span><span class="token function">pixelFormat</span><span class="token punctuation">(</span>OF_PIXELS_RGB<span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

ofDirectShowPlayer<span class="token operator">::</span><span class="token function">ofDirectShowPlayer</span><span class="token punctuation">(</span>ofDirectShowPlayer <span class="token operator">&&</span> other<span class="token punctuation">)</span>
<span class="token operator">:</span><span class="token function">player</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>player<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span><span class="token function">pixelFormat</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>pixelFormat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

ofDirectShowPlayer <span class="token operator">&</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>ofDirectShowPlayer<span class="token operator">&&</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&</span>other <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	player <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pixelFormat <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>pixelFormat<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">load</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string path<span class="token punctuation">)</span><span class="token punctuation">{</span>
    path <span class="token operator">=</span> <span class="token function">ofToDataPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    player<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">DirectShowVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> loadOk <span class="token operator">=</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">loadMovie</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> pixelFormat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>loadOk <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofDirectShowPlayer"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" Cannot load video of this file type.  Make sure you have codecs installed on your system.  OF recommends the free K-Lite Codec pack. "</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> loadOk<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	player<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>       
    
<span class="token keyword">bool</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">isFrameNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isFrameNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ofPixels <span class="token operator">&</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ofPixels <span class="token operator">&</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">float</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">float</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    
<span class="token keyword">bool</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>   

<span class="token keyword">bool</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">setPixelFormat</span><span class="token punctuation">(</span>ofPixelFormat pixelFormat<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>pixelFormat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> OF_PIXELS_RGB<span class="token operator">:</span>
	<span class="token keyword">case</span> OF_PIXELS_BGR<span class="token operator">:</span>
	<span class="token keyword">case</span> OF_PIXELS_BGRA<span class="token operator">:</span>
	<span class="token keyword">case</span> OF_PIXELS_RGBA<span class="token operator">:</span>
		<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>pixelFormat <span class="token operator">=</span> pixelFormat<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ofPixelFormat ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>pixelFormat<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
        
<span class="token comment" spellcheck="true">//should implement!</span>
<span class="token keyword">float</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">float</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">float</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getDurationInSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">bool</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getIsMovieDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isMovieDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
    
<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">setPaused</span><span class="token punctuation">(</span><span class="token keyword">bool</span> bPause<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">setPaused</span><span class="token punctuation">(</span>bPause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token keyword">float</span> pct<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">setPosition</span><span class="token punctuation">(</span>pct<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token keyword">float</span> volume<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">setVolume</span><span class="token punctuation">(</span>volume<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">setLoopState</span><span class="token punctuation">(</span>ofLoopType state<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> state <span class="token operator">==</span> OF_LOOP_NONE <span class="token punctuation">)</span><span class="token punctuation">{</span>
            player<span class="token operator">-</span><span class="token operator">></span><span class="token function">setLoop</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> state <span class="token operator">==</span> OF_LOOP_NORMAL <span class="token punctuation">)</span><span class="token punctuation">{</span>
            player<span class="token operator">-</span><span class="token operator">></span><span class="token function">setLoop</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofDirectShowPlayer"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" cannot set loop of type palindrome "</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">setSpeed</span><span class="token punctuation">(</span><span class="token keyword">float</span> speed<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">setSpeed</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
    
<span class="token keyword">int</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getCurrentFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getCurrentFrameNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">int</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getTotalNumFrames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">getAproximateNoFrames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

ofLoopType ofDirectShowPlayer<span class="token operator">::</span><span class="token function">getLoopState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLooping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> OF_LOOP_NORMAL<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> OF_LOOP_NONE<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">setFrame</span><span class="token punctuation">(</span><span class="token keyword">int</span> frame<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        frame <span class="token operator">=</span> <span class="token function">ofClamp</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getTotalNumFrames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">return</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">setAproximateFrame</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// frame 0 = first frame...</span>
    
<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">firstFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">nextFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">nextFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofDirectShowPlayer<span class="token operator">::</span><span class="token function">previousFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> player <span class="token operator">&&</span> player<span class="token operator">-</span><span class="token operator">></span><span class="token function">isLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        player<span class="token operator">-</span><span class="token operator">></span><span class="token function">preFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div></div></div></div></div></div><script defer src="/_nuxt/payloads/1583511283766/openframeworks/video/ofDirectShowPlayer_cpp/payload.js"></script><script src="/_nuxt/76844c096ee4b2a8e8b3.js" defer></script><script src="/_nuxt/0128aba013e56fe5f14b.js" defer></script><script src="/_nuxt/561e36663ec83bdcd2ac.js" defer></script><script src="/_nuxt/26c5a70906ce7aaac460.js" defer></script><script src="/_nuxt/af3debaf278e0e1fd9de.js" defer></script>
  </body>
</html>
