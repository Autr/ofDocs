<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>ofQuaternion.cpp | openframeworks | ofDocs</title><meta data-n-head="ssr" data-hid="description" name="description" content="openFrameworks documentation and examples browser"><meta data-n-head="ssr" data-hid="keyword" name="keyword" content=""><meta data-n-head="ssr" property="og:description" content="openFrameworks documentation and examples browser" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="ofQuaternion.cpp | openframeworks | ofDocs" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="/files/images/ofw-logo.png" vmid="og:image"><link rel="preload" href="/_nuxt/3213b67383225fc2f59b.js" as="script"><link rel="preload" href="/_nuxt/5fe5bba000836bc4a25f.js" as="script"><link rel="preload" href="/_nuxt/fe12c0cb7395fa1032f4.css" as="style"><link rel="preload" href="/_nuxt/f8d94d1c92ade1d8a6da.js" as="script"><link rel="preload" href="/_nuxt/a24b354526a25539cceb.css" as="style"><link rel="preload" href="/_nuxt/9a7e20c23e9625feab77.js" as="script"><link rel="preload" href="/_nuxt/21c4d0f9583096394838.css" as="style"><link rel="preload" href="/_nuxt/d1291586b31fa28ca9d5.js" as="script"><link rel="stylesheet" href="/_nuxt/fe12c0cb7395fa1032f4.css"><link rel="stylesheet" href="/_nuxt/a24b354526a25539cceb.css"><link rel="stylesheet" href="/_nuxt/21c4d0f9583096394838.css">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="app" class="unknown"><div id="menu"><h1 class="of"><div class="inner"><span><a href="/" class="nuxt-link-active"><div class="txt"><span class="docs f7 questrial">ofDocs </span><span class="version">0.11.0</span></div></a></span></div></h1><div id="search"><div class="inner"><div class="field text"><div class="field-inner"><svg viewbox="0 0 36 36" x="0px" y="0px" enable-background="new 0 0 36 36" xml:space="preserve"><path d="M35.525,31.228l-8.88-8.882c1.444-2.238,2.298-4.895,2.298-7.752c0-7.909-6.438-14.343-14.346-14.343						c-7.911,0-14.343,6.434-14.343,14.343c0,7.911,6.433,14.344,14.343,14.344c2.856,0,5.513-0.849,7.752-2.294l8.88,8.88						c0.295,0.297,0.782,0.297,1.076,0l3.22-3.221C35.824,32.008,35.824,31.523,35.525,31.228z M4.81,14.593						c0-5.396,4.391-9.788,9.788-9.788c5.398,0,9.787,4.392,9.787,9.788c0,5.398-4.389,9.789-9.787,9.789						C9.2,24.382,4.81,19.991,4.81,14.593z"></path></svg><!----><div class="text-wrapper"><input id="search_field" name="search_field" placeholder="Search (Alt+F)" autocomplete="off" tabindex="0"></div><!----><!----></div></div></div><div id="results" class="mt1"></div></div><div id="lists" class="menu-inner mt1"><div class="inner"><div class="item documentation"><a href="/documentation/" title="/documentation/"><i class="ico" style="display:none"></i><span>documentation</span><span style="display:none">documentation</span></a><!----></div><div class="item examples"><a href="/examples/" title="/examples/"><i class="ico" style="display:none"></i><span>examples</span><span style="display:none">examples</span></a><!----></div><div class="item openframeworks"><a href="/openframeworks/" title="/openframeworks/" class="nuxt-link-active"><i class="ico" style="display:none"></i><span>openFrameworks</span><span style="display:none">openframeworks</span></a><div class="list"><div class="item 3d"><a href="/openframeworks/3d/" title="/openframeworks/3d/"><i class="ico" style="display:none"></i><span style="display:none"></span><span>3d</span></a><!----></div><div class="item app"><a href="/openframeworks/app/" title="/openframeworks/app/"><i class="ico" style="display:none">web</i><span style="display:none"></span><span>app</span></a><!----></div><div class="item communication"><a href="/openframeworks/communication/" title="/openframeworks/communication/"><i class="ico" style="display:none">language</i><span style="display:none"></span><span>communication</span></a><!----></div><div class="item events"><a href="/openframeworks/events/" title="/openframeworks/events/"><i class="ico" style="display:none">question_answer</i><span style="display:none"></span><span>events</span></a><!----></div><div class="item gl"><a href="/openframeworks/gl/" title="/openframeworks/gl/"><i class="ico" style="display:none"></i><span style="display:none"></span><span>gl</span></a><!----></div><div class="item graphics"><a href="/openframeworks/graphics/" title="/openframeworks/graphics/"><i class="ico" style="display:none">category</i><span style="display:none"></span><span>graphics</span></a><!----></div><div class="item math"><a href="/openframeworks/math/" title="/openframeworks/math/" class="nuxt-link-active"><i class="ico" style="display:none">border_clear</i><span style="display:none"></span><span>math</span></a><div class="list"><div class="item ofMath.cpp"><a href="/openframeworks/math/ofMath_cpp" title="/openframeworks/math/ofMath.cpp"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofMath.cpp</span></a><!----></div><div class="item ofMath.h"><a href="/openframeworks/math/ofMath_h" title="/openframeworks/math/ofMath.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofMath.h</span></a><!----></div><div class="item ofMathConstants.h"><a href="/openframeworks/math/ofMathConstants_h" title="/openframeworks/math/ofMathConstants.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofMathConstants.h</span></a><!----></div><div class="item ofMatrix3x3.cpp"><a href="/openframeworks/math/ofMatrix3x3_cpp" title="/openframeworks/math/ofMatrix3x3.cpp"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofMatrix3x3.cpp</span></a><!----></div><div class="item ofMatrix3x3.h"><a href="/openframeworks/math/ofMatrix3x3_h" title="/openframeworks/math/ofMatrix3x3.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofMatrix3x3.h</span></a><!----></div><div class="item ofMatrix4x4.cpp"><a href="/openframeworks/math/ofMatrix4x4_cpp" title="/openframeworks/math/ofMatrix4x4.cpp"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofMatrix4x4.cpp</span></a><!----></div><div class="item ofMatrix4x4.h"><a href="/openframeworks/math/ofMatrix4x4_h" title="/openframeworks/math/ofMatrix4x4.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofMatrix4x4.h</span></a><!----></div><div class="item ofQuaternion.cpp"><a href="/openframeworks/math/ofQuaternion_cpp" title="/openframeworks/math/ofQuaternion.cpp" class="nuxt-link-exact-active nuxt-link-active"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofQuaternion.cpp</span></a><div class="list"></div></div><div class="item ofQuaternion.h"><a href="/openframeworks/math/ofQuaternion_h" title="/openframeworks/math/ofQuaternion.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofQuaternion.h</span></a><!----></div><div class="item ofVec2f.cpp"><a href="/openframeworks/math/ofVec2f_cpp" title="/openframeworks/math/ofVec2f.cpp"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofVec2f.cpp</span></a><!----></div><div class="item ofVec2f.h"><a href="/openframeworks/math/ofVec2f_h" title="/openframeworks/math/ofVec2f.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofVec2f.h</span></a><!----></div><div class="item ofVec3f.h"><a href="/openframeworks/math/ofVec3f_h" title="/openframeworks/math/ofVec3f.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofVec3f.h</span></a><!----></div><div class="item ofVec4f.cpp"><a href="/openframeworks/math/ofVec4f_cpp" title="/openframeworks/math/ofVec4f.cpp"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofVec4f.cpp</span></a><!----></div><div class="item ofVec4f.h"><a href="/openframeworks/math/ofVec4f_h" title="/openframeworks/math/ofVec4f.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofVec4f.h</span></a><!----></div><div class="item ofVectorMath.h"><a href="/openframeworks/math/ofVectorMath_h" title="/openframeworks/math/ofVectorMath.h"><i class="ico" style="display:none"></i><span style="display:none"></span><span>ofVectorMath.h</span></a><!----></div></div></div><div class="item sound"><a href="/openframeworks/sound/" title="/openframeworks/sound/"><i class="ico" style="display:none">volume_up</i><span style="display:none"></span><span>sound</span></a><!----></div><div class="item types"><a href="/openframeworks/types/" title="/openframeworks/types/"><i class="ico" style="display:none">ring_volume</i><span style="display:none"></span><span>types</span></a><!----></div><div class="item utils"><a href="/openframeworks/utils/" title="/openframeworks/utils/"><i class="ico" style="display:none">build</i><span style="display:none"></span><span>utils</span></a><!----></div><div class="item video"><a href="/openframeworks/video/" title="/openframeworks/video/"><i class="ico" style="display:none">videocam</i><span style="display:none"></span><span>video</span></a><!----></div></div></div><div class="item addons"><a href="/addons/" title="/addons/"><i class="ico" style="display:none">extension</i><span>addons</span><span style="display:none">addons</span></a><!----></div><div class="item guides"><a href="/guides/" title="/guides/"><i class="ico" style="display:none"></i><span>guides</span><span style="display:none">guides</span></a><!----></div></div></div></div><div id="document"><div id="renderer" class="main"><div absolute="/Users/gilbertsinnott/Code/openFrameworks/libs/openFrameworks/math/ofQuaternion.cpp" route="/openframeworks/math/ofQuaternion.cpp" dir="../libs/openFrameworks/math" ext="cpp" type="source" id="292" parent="284" siblings="" translations="[object Object]" class="doc-header"><div class="doc-header-inner"><div class="inner"><div class="mt2 mb2"><span class="breadcrumbs"><span class="crumb"><a href="/" class="pink nuxt-link-active">ofDocs</a><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/" class="pink nuxt-link-active">openframeworks </a><!----><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/math/" class="pink nuxt-link-active">math </a><!----><span class="chevron right"></span></span><span class="crumb"><!----><span class="link selector"><span>ofQuaternion.cpp </span><span class="chevron bottom"></span><select><option value="/openframeworks/math/ofMath_cpp">ofMath.cpp</option><option value="/openframeworks/math/ofMath_h">ofMath.h</option><option value="/openframeworks/math/ofMathConstants_h">ofMathConstants.h</option><option value="/openframeworks/math/ofMatrix3x3_cpp">ofMatrix3x3.cpp</option><option value="/openframeworks/math/ofMatrix3x3_h">ofMatrix3x3.h</option><option value="/openframeworks/math/ofMatrix4x4_cpp">ofMatrix4x4.cpp</option><option value="/openframeworks/math/ofMatrix4x4_h">ofMatrix4x4.h</option><option value="/openframeworks/math/ofQuaternion_cpp">ofQuaternion.cpp</option><option value="/openframeworks/math/ofQuaternion_h">ofQuaternion.h</option><option value="/openframeworks/math/ofVec2f_cpp">ofVec2f.cpp</option><option value="/openframeworks/math/ofVec2f_h">ofVec2f.h</option><option value="/openframeworks/math/ofVec3f_h">ofVec3f.h</option><option value="/openframeworks/math/ofVec4f_cpp">ofVec4f.cpp</option><option value="/openframeworks/math/ofVec4f_h">ofVec4f.h</option><option value="/openframeworks/math/ofVectorMath_h">ofVectorMath.h</option></select></span><!----></span></span></div></div></div></div><div id="code-page" static="true" class="markdown"><div id="side-menu"><!----><div id="see-also" filename="math" absolute="/Users/gilbertsinnott/Code/openFrameworks/libs/openFrameworks/math" dir="../libs/openFrameworks" route="/openframeworks/math/" ext="" type="folder" children="285,286,287,288,289,290,291,292,293,294,295,296,297,298,299" icon="border_clear" parent="195" breadcrumbs="195" class="see-also"><h4>See also</h4><div class="also"><a href="/documentation/math/"><span class="origin">documentation</span><span class="name">math</span></a></div><div class="also"><a href="/examples/math/"><span class="origin">examples</span><span class="name">math</span></a></div></div></div><div id="code-render"><div class="inner"><pre><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofQuaternion.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofMatrix4x4.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofMath.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofMathConstants.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"glm/gtc/quaternion.hpp"</span></span>

<span class="token comment" spellcheck="true">//----------------------------------------</span>
ofQuaternion<span class="token operator">::</span><span class="token function">ofQuaternion</span><span class="token punctuation">(</span><span class="token keyword">const</span> glm<span class="token operator">::</span>quat <span class="token operator">&</span> q<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">_v</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>x<span class="token punctuation">,</span> q<span class="token punctuation">.</span>y<span class="token punctuation">,</span> q<span class="token punctuation">.</span>z<span class="token punctuation">,</span> q<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------</span>
ofQuaternion<span class="token operator">::</span><span class="token keyword">operator</span> glm<span class="token operator">::</span><span class="token function">quat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> glm<span class="token operator">::</span><span class="token function">quat</span><span class="token punctuation">(</span>_v<span class="token punctuation">.</span>w<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>_v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> _v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> _v<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofMatrix4x4<span class="token operator">&</span> matrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">=</span> matrix<span class="token punctuation">.</span><span class="token function">getRotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span>ofMatrix4x4<span class="token operator">&</span> matrix<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	matrix<span class="token punctuation">.</span><span class="token function">makeRotationMatrix</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">/// Set the elements of the Quat to represent a rotation of angle</span>
<span class="token comment" spellcheck="true">/// (degrees) around the axis (x,y,z)</span>
<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">makeRotate</span><span class="token punctuation">(</span> <span class="token keyword">float</span> angle<span class="token punctuation">,</span> <span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> z <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	angle <span class="token operator">=</span> <span class="token function">ofDegToRad</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">const</span> <span class="token keyword">float</span> epsilon <span class="token operator">=</span> <span class="token number">0.0000001f</span><span class="token punctuation">;</span>

	<span class="token keyword">float</span> length <span class="token operator">=</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span> x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y <span class="token operator">+</span> z <span class="token operator">*</span> z <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">&lt;</span> epsilon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// ~zero length axis, so reset rotation to zero.</span>
		<span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">=</span> <span class="token function">ofQuaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">float</span> inversenorm  <span class="token operator">=</span> <span class="token number">1.0f</span> <span class="token operator">/</span> length<span class="token punctuation">;</span>
	<span class="token keyword">float</span> coshalfangle <span class="token operator">=</span> <span class="token function">cosf</span><span class="token punctuation">(</span> <span class="token number">0.5f</span> <span class="token operator">*</span> angle <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> sinhalfangle <span class="token operator">=</span> <span class="token function">sinf</span><span class="token punctuation">(</span> <span class="token number">0.5f</span> <span class="token operator">*</span> angle <span class="token punctuation">)</span><span class="token punctuation">;</span>

	_v<span class="token punctuation">.</span>x <span class="token operator">=</span> x <span class="token operator">*</span> sinhalfangle <span class="token operator">*</span> inversenorm<span class="token punctuation">;</span>
	_v<span class="token punctuation">.</span>y <span class="token operator">=</span> y <span class="token operator">*</span> sinhalfangle <span class="token operator">*</span> inversenorm<span class="token punctuation">;</span>
	_v<span class="token punctuation">.</span>z <span class="token operator">=</span> z <span class="token operator">*</span> sinhalfangle <span class="token operator">*</span> inversenorm<span class="token punctuation">;</span>
	_v<span class="token punctuation">.</span>w <span class="token operator">=</span> coshalfangle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">makeRotate</span><span class="token punctuation">(</span> <span class="token keyword">float</span> angle<span class="token punctuation">,</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> vec <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">makeRotate</span><span class="token punctuation">(</span> angle<span class="token punctuation">,</span> vec<span class="token punctuation">.</span>x<span class="token punctuation">,</span> vec<span class="token punctuation">.</span>y<span class="token punctuation">,</span> vec<span class="token punctuation">.</span>z <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">makeRotate</span> <span class="token punctuation">(</span> <span class="token keyword">float</span> angle1<span class="token punctuation">,</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> axis1<span class="token punctuation">,</span>
                          <span class="token keyword">float</span> angle2<span class="token punctuation">,</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> axis2<span class="token punctuation">,</span>
                          <span class="token keyword">float</span> angle3<span class="token punctuation">,</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> axis3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       ofQuaternion q1<span class="token punctuation">;</span> q1<span class="token punctuation">.</span><span class="token function">makeRotate</span><span class="token punctuation">(</span>angle1<span class="token punctuation">,</span>axis1<span class="token punctuation">)</span><span class="token punctuation">;</span>
       ofQuaternion q2<span class="token punctuation">;</span> q2<span class="token punctuation">.</span><span class="token function">makeRotate</span><span class="token punctuation">(</span>angle2<span class="token punctuation">,</span>axis2<span class="token punctuation">)</span><span class="token punctuation">;</span>
       ofQuaternion q3<span class="token punctuation">;</span> q3<span class="token punctuation">.</span><span class="token function">makeRotate</span><span class="token punctuation">(</span>angle3<span class="token punctuation">,</span>axis3<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">=</span> q1<span class="token operator">*</span>q2<span class="token operator">*</span>q3<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/** Make a rotation Quat which will rotate vec1 to vec2

 This routine uses only fast geometric transforms, without costly acos/sin computations.
 It's exact, fast, and with less degenerate cases than the acos/sin method.

 For an explanation of the math used, you may see for example:
 http://logiciels.cnes.fr/MARMOTTES/marmottes-mathematique.pdf

 @note This is the rotation with shortest angle, which is the one equivalent to the
 acos/sin transform method. Other rotations exists, for example to additionally keep
 a local horizontal attitude.

 @author Nicolas Brodu
 */</span>
<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">makeRotate</span><span class="token punctuation">(</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> from<span class="token punctuation">,</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> to <span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">// This routine takes any vector as argument but normalized</span>
	<span class="token comment" spellcheck="true">// vectors are necessary, if only for computing the dot product.</span>
	<span class="token comment" spellcheck="true">// Too bad the API is that generic, it leads to performance loss.</span>
	<span class="token comment" spellcheck="true">// Even in the case the 2 vectors are not normalized but same length,</span>
	<span class="token comment" spellcheck="true">// the sqrt could be shared, but we have no way to know beforehand</span>
	<span class="token comment" spellcheck="true">// at this point, while the caller may know.</span>
	<span class="token comment" spellcheck="true">// So, we have to test... in the hope of saving at least a sqrt</span>
	ofVec3f sourceVector <span class="token operator">=</span> from<span class="token punctuation">;</span>
	ofVec3f targetVector <span class="token operator">=</span> to<span class="token punctuation">;</span>

	<span class="token keyword">float</span> fromLen2 <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">lengthSquared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> fromLen<span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">// normalize only when necessary, epsilon test</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fromLen2 <span class="token operator">&lt;</span> <span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">1e-7</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>fromLen2 <span class="token operator">></span> <span class="token number">1.0</span> <span class="token operator">+</span> <span class="token number">1e-7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fromLen <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>fromLen2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		sourceVector <span class="token operator">/</span><span class="token operator">=</span> fromLen<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> fromLen <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>

	<span class="token keyword">float</span> toLen2 <span class="token operator">=</span> to<span class="token punctuation">.</span><span class="token function">lengthSquared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">// normalize only when necessary, epsilon test</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>toLen2 <span class="token operator">&lt;</span> <span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">1e-7</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>toLen2 <span class="token operator">></span> <span class="token number">1.0</span> <span class="token operator">+</span> <span class="token number">1e-7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">float</span> toLen<span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// re-use fromLen for case of mapping 2 vectors of the same length</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>toLen2 <span class="token operator">></span> fromLen2 <span class="token operator">-</span> <span class="token number">1e-7</span><span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token punctuation">(</span>toLen2 <span class="token operator">&lt;</span> fromLen2 <span class="token operator">+</span> <span class="token number">1e-7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			toLen <span class="token operator">=</span> fromLen<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> toLen <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>toLen2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		targetVector <span class="token operator">/</span><span class="token operator">=</span> toLen<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment" spellcheck="true">// Now let's get into the real stuff</span>
	<span class="token comment" spellcheck="true">// Use "dot product plus one" as test as it can be re-used later on</span>
	<span class="token keyword">double</span> dotProdPlus1 <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> sourceVector<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>targetVector<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// Check for degenerate case of full u-turn. Use epsilon for detection</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>dotProdPlus1 <span class="token operator">&lt;</span> <span class="token number">1e-7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token comment" spellcheck="true">// Get an orthogonal vector of the given vector</span>
		<span class="token comment" spellcheck="true">// in a plane with maximum vector coordinates.</span>
		<span class="token comment" spellcheck="true">// Then use it as quaternion axis with pi angle</span>
		<span class="token comment" spellcheck="true">// Trick is to realize one value at least is >0.6 for a normalized vector.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>sourceVector<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> <span class="token keyword">double</span> norm <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> sourceVector<span class="token punctuation">.</span>x <span class="token operator">*</span> sourceVector<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>y <span class="token operator">=</span> sourceVector<span class="token punctuation">.</span>z <span class="token operator">/</span> norm<span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token operator">-</span>sourceVector<span class="token punctuation">.</span>y <span class="token operator">/</span> norm<span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>sourceVector<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> <span class="token keyword">double</span> norm <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> sourceVector<span class="token punctuation">.</span>y <span class="token operator">*</span> sourceVector<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span>sourceVector<span class="token punctuation">.</span>z <span class="token operator">/</span> norm<span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>z <span class="token operator">=</span> sourceVector<span class="token punctuation">.</span>x <span class="token operator">/</span> norm<span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> <span class="token keyword">double</span> norm <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> sourceVector<span class="token punctuation">.</span>z <span class="token operator">*</span> sourceVector<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>x <span class="token operator">=</span> sourceVector<span class="token punctuation">.</span>y <span class="token operator">/</span> norm<span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span>sourceVector<span class="token punctuation">.</span>x <span class="token operator">/</span> norm<span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
			_v<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// Find the shortest angle quaternion that transforms normalized vectors</span>
		<span class="token comment" spellcheck="true">// into one other. Formula is still valid when vectors are colinear</span>
		<span class="token keyword">const</span> <span class="token keyword">double</span> s <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">*</span> dotProdPlus1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> ofVec3f tmp <span class="token operator">=</span> sourceVector<span class="token punctuation">.</span><span class="token function">getCrossed</span><span class="token punctuation">(</span>targetVector<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_v<span class="token punctuation">.</span>x <span class="token operator">=</span> tmp<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
		_v<span class="token punctuation">.</span>y <span class="token operator">=</span> tmp<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
		_v<span class="token punctuation">.</span>z <span class="token operator">=</span> tmp<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
		_v<span class="token punctuation">.</span>w <span class="token operator">=</span> s<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">// Make a rotation Quat which will rotate vec1 to vec2</span>
<span class="token comment" spellcheck="true">// Generally take adot product to get the angle between these</span>
<span class="token comment" spellcheck="true">// and then use a cross product to get the rotation axis</span>
<span class="token comment" spellcheck="true">// Watch out for the two special cases of when the vectors</span>
<span class="token comment" spellcheck="true">// are co-incident or opposite in direction.</span>
<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">makeRotate_original</span><span class="token punctuation">(</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> from<span class="token punctuation">,</span> <span class="token keyword">const</span> ofVec3f<span class="token operator">&</span> to <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token keyword">float</span> epsilon <span class="token operator">=</span> <span class="token number">0.0000001f</span><span class="token punctuation">;</span>

	<span class="token keyword">float</span> length1  <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> length2  <span class="token operator">=</span> to<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// dot product vec1*vec2</span>
	<span class="token keyword">float</span> cosangle <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>length1 <span class="token operator">*</span> length2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">fabs</span><span class="token punctuation">(</span>cosangle <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> epsilon <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">//osg::notify(osg::INFO)&lt;&lt;"*** Quat::makeRotate(from,to) with near co-linear vectors, epsilon= "&lt;&lt;fabs(cosangle-1)&lt;&lt;std::endl;</span>

		<span class="token comment" spellcheck="true">// cosangle is close to 1, so the vectors are close to being coincident</span>
		<span class="token comment" spellcheck="true">// Need to generate an angle of zero with any vector we like</span>
		<span class="token comment" spellcheck="true">// We'll choose (1,0,0)</span>
		<span class="token function">makeRotate</span><span class="token punctuation">(</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">fabs</span><span class="token punctuation">(</span>cosangle <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> epsilon <span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment" spellcheck="true">// vectors are close to being opposite, so will need to find a</span>
			<span class="token comment" spellcheck="true">// vector orthongonal to from to rotate about.</span>
			ofVec3f tmp<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">fabs</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">fabs</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span> tmp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// use x axis.</span>
				<span class="token keyword">else</span> tmp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">fabs</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span> tmp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> tmp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			ofVec3f <span class="token function">fromd</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span>x<span class="token punctuation">,</span> from<span class="token punctuation">.</span>y<span class="token punctuation">,</span> from<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment" spellcheck="true">// find orthogonal axis.</span>
			ofVec3f <span class="token function">axis</span><span class="token punctuation">(</span>fromd<span class="token punctuation">.</span><span class="token function">getCrossed</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			axis<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			_v<span class="token punctuation">.</span>x <span class="token operator">=</span> axis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// sine of half angle of PI is 1.0.</span>
			_v<span class="token punctuation">.</span>y <span class="token operator">=</span> axis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// sine of half angle of PI is 1.0.</span>
			_v<span class="token punctuation">.</span>z <span class="token operator">=</span> axis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// sine of half angle of PI is 1.0.</span>
			_v<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// cosine of half angle of PI is zero.</span>

		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment" spellcheck="true">// This is the usual situation - take a cross-product of vec1 and vec2</span>
			<span class="token comment" spellcheck="true">// and that is the axis around which to rotate.</span>
			ofVec3f <span class="token function">axis</span><span class="token punctuation">(</span>from<span class="token punctuation">.</span><span class="token function">getCrossed</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">float</span> angle <span class="token operator">=</span> <span class="token function">acos</span><span class="token punctuation">(</span> cosangle <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">makeRotate</span><span class="token punctuation">(</span> angle<span class="token punctuation">,</span> axis <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">getRotate</span><span class="token punctuation">(</span> <span class="token keyword">float</span><span class="token operator">&</span> angle<span class="token punctuation">,</span> ofVec3f<span class="token operator">&</span> vec <span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">float</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
	<span class="token function">getRotate</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
	vec<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
	vec<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
	vec<span class="token punctuation">.</span>z <span class="token operator">=</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// Get the angle of rotation and axis of this Quat object.</span>
<span class="token comment" spellcheck="true">// Won't give very meaningful results if the Quat is not associated</span>
<span class="token comment" spellcheck="true">// with a rotation!</span>
<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">getRotate</span><span class="token punctuation">(</span> <span class="token keyword">float</span><span class="token operator">&</span> angle<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">&</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">&</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">&</span> z <span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">float</span> sinhalfangle <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span> _v<span class="token punctuation">.</span>x <span class="token operator">*</span> _v<span class="token punctuation">.</span>x <span class="token operator">+</span> _v<span class="token punctuation">.</span>y <span class="token operator">*</span> _v<span class="token punctuation">.</span>y <span class="token operator">+</span> _v<span class="token punctuation">.</span>z <span class="token operator">*</span> _v<span class="token punctuation">.</span>z <span class="token punctuation">)</span><span class="token punctuation">;</span>

	angle <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token function">atan2</span><span class="token punctuation">(</span> sinhalfangle<span class="token punctuation">,</span> _v<span class="token punctuation">.</span>w <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>sinhalfangle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		x <span class="token operator">=</span> _v<span class="token punctuation">.</span>x <span class="token operator">/</span> sinhalfangle<span class="token punctuation">;</span>
		y <span class="token operator">=</span> _v<span class="token punctuation">.</span>y <span class="token operator">/</span> sinhalfangle<span class="token punctuation">;</span>
		z <span class="token operator">=</span> _v<span class="token punctuation">.</span>z <span class="token operator">/</span> sinhalfangle<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		x <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
		y <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
		z <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	angle <span class="token operator">=</span> <span class="token function">ofRadToDeg</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">/// Spherical Linear Interpolation</span>
<span class="token comment" spellcheck="true">/// As t goes from 0 to 1, the Quat object goes from "from" to "to"</span>
<span class="token comment" spellcheck="true">/// Reference: Shoemake at SIGGRAPH 89</span>
<span class="token comment" spellcheck="true">/// See also</span>
<span class="token comment" spellcheck="true">/// http://www.gamasutra.com/features/programming/19980703/quaternions_01.htm</span>
<span class="token keyword">void</span> ofQuaternion<span class="token operator">::</span><span class="token function">slerp</span><span class="token punctuation">(</span> <span class="token keyword">float</span> t<span class="token punctuation">,</span> <span class="token keyword">const</span> ofQuaternion<span class="token operator">&</span> from<span class="token punctuation">,</span> <span class="token keyword">const</span> ofQuaternion<span class="token operator">&</span> to <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token keyword">double</span> epsilon <span class="token operator">=</span> <span class="token number">0.00001</span><span class="token punctuation">;</span>
	<span class="token keyword">double</span> omega<span class="token punctuation">,</span> cosomega<span class="token punctuation">,</span> sinomega<span class="token punctuation">,</span> scale_from<span class="token punctuation">,</span> scale_to <span class="token punctuation">;</span>

	ofQuaternion <span class="token function">quatTo</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">// this is a dot product</span>

	cosomega <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">asVec4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span><span class="token function">asVec4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span> cosomega <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cosomega <span class="token operator">=</span> <span class="token operator">-</span>cosomega<span class="token punctuation">;</span>
		quatTo <span class="token operator">=</span> <span class="token operator">-</span>to<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> cosomega<span class="token punctuation">)</span> <span class="token operator">></span> epsilon <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		omega <span class="token operator">=</span> <span class="token function">acos</span><span class="token punctuation">(</span>cosomega<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 0 &lt;= omega &lt;= Pi (see man acos)</span>
		sinomega <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>omega<span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// this sinomega should always be +ve so</span>
		<span class="token comment" spellcheck="true">// could try sinomega=sqrt(1-cosomega*cosomega) to avoid a sin()?</span>
		scale_from <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">*</span> omega<span class="token punctuation">)</span> <span class="token operator">/</span> sinomega <span class="token punctuation">;</span>
		scale_to <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>t <span class="token operator">*</span> omega<span class="token punctuation">)</span> <span class="token operator">/</span> sinomega <span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">/* --------------------------------------------------
		The ends of the vectors are very close
		we can use simple linear interpolation - no need
		to worry about the "spherical" interpolation
		-------------------------------------------------- */</span>
		scale_from <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">-</span> t <span class="token punctuation">;</span>
		scale_to <span class="token operator">=</span> t <span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">=</span> <span class="token punctuation">(</span>from <span class="token operator">*</span> scale_from<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>quatTo <span class="token operator">*</span> scale_to<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// so that we get a Vec4</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">// ref at http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToEuler/index.htm</span>
ofVec3f ofQuaternion<span class="token operator">::</span><span class="token function">getEuler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">float</span> test <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> heading<span class="token punctuation">;</span>
	<span class="token keyword">float</span> attitude<span class="token punctuation">;</span>
	<span class="token keyword">float</span> bank<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>test <span class="token operator">></span> <span class="token number">0.499</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// singularity at north pole</span>
		heading <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">atan2</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		attitude <span class="token operator">=</span> PI<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
		bank <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>test <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">0.499</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// singularity at south pole</span>
		heading <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token function">atan2</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		attitude <span class="token operator">=</span> <span class="token operator">-</span> PI<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
		bank <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">float</span> sqx <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> sqy <span class="token operator">=</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> sqz <span class="token operator">=</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		heading <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span><span class="token number">2.0f</span> <span class="token operator">*</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2.0f</span> <span class="token operator">*</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span> <span class="token operator">-</span> <span class="token number">2.0f</span><span class="token operator">*</span>sqy <span class="token operator">-</span> <span class="token number">2.0f</span><span class="token operator">*</span>sqz<span class="token punctuation">)</span><span class="token punctuation">;</span>
		attitude <span class="token operator">=</span> <span class="token function">asin</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bank <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span><span class="token number">2.0f</span><span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2.0f</span> <span class="token operator">*</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span> <span class="token operator">-</span> <span class="token number">2.0f</span><span class="token operator">*</span>sqx <span class="token operator">-</span> <span class="token number">2.0f</span><span class="token operator">*</span>sqz<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> <span class="token function">ofVec3f</span><span class="token punctuation">(</span><span class="token function">ofRadToDeg</span><span class="token punctuation">(</span>bank<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ofRadToDeg</span><span class="token punctuation">(</span>heading<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ofRadToDeg</span><span class="token punctuation">(</span>attitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">define</span> QX  _v.x</span>
<span class="token macro property">#<span class="token directive keyword">define</span> QY  _v.y</span>
<span class="token macro property">#<span class="token directive keyword">define</span> QZ  _v.z</span>
<span class="token macro property">#<span class="token directive keyword">define</span> QW  _v.w</span>

<span class="token comment" spellcheck="true">//----------------------------------------</span>
std<span class="token operator">::</span>ostream<span class="token operator">&</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token operator">::</span>ostream<span class="token operator">&</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> ofQuaternion <span class="token operator">&</span>q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    os <span class="token operator">&lt;&lt;</span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>z <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
    <span class="token keyword">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//----------------------------------------</span>
std<span class="token operator">::</span>istream<span class="token operator">&</span> <span class="token keyword">operator</span><span class="token operator">>></span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream<span class="token operator">&</span> is<span class="token punctuation">,</span> ofQuaternion <span class="token operator">&</span>q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    is <span class="token operator">>></span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    is<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    is <span class="token operator">>></span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    is<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    is <span class="token operator">>></span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    is<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    is <span class="token operator">>></span> q<span class="token punctuation">.</span>_v<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
    <span class="token keyword">return</span> is<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div></div></div></div></div></div><script defer src="/_nuxt/payloads/1584626286009/openframeworks/math/ofQuaternion_cpp/payload.js"></script><script src="/_nuxt/3213b67383225fc2f59b.js" defer></script><script src="/_nuxt/d1291586b31fa28ca9d5.js" defer></script><script src="/_nuxt/5fe5bba000836bc4a25f.js" defer></script><script src="/_nuxt/f8d94d1c92ade1d8a6da.js" defer></script><script src="/_nuxt/9a7e20c23e9625feab77.js" defer></script>
  </body>
</html>
