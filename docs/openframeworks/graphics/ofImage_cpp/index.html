<!doctype html>
<html data-n-head-ssr>
  <head>
    <meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" data-hid="keyword" name="keyword" content=""><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><link rel="preload" href="/_nuxt/cede893bee7aedd34019.js" as="script"><link rel="preload" href="/_nuxt/561e36663ec83bdcd2ac.js" as="script"><link rel="preload" href="/_nuxt/fe12c0cb7395fa1032f4.css" as="style"><link rel="preload" href="/_nuxt/26c5a70906ce7aaac460.js" as="script"><link rel="preload" href="/_nuxt/75259d9b56378e7dbe47.css" as="style"><link rel="preload" href="/_nuxt/2c5d9034468f7212e81b.js" as="script"><link rel="preload" href="/_nuxt/74971516fa343f955f83.css" as="style"><link rel="preload" href="/_nuxt/3517dc6c150c1f5be417.js" as="script"><link rel="stylesheet" href="/_nuxt/fe12c0cb7395fa1032f4.css"><link rel="stylesheet" href="/_nuxt/75259d9b56378e7dbe47.css"><link rel="stylesheet" href="/_nuxt/74971516fa343f955f83.css">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="app" class="unknown"><div id="menu"><h1 class="of"><div class="inner"><span><a href="/" class="nuxt-link-active"><div class="txt"><span class="docs f7 questrial">ofDocs </span><span class="version">0.11.0</span></div></a></span></div></h1><div id="search"><div class="inner"><div class="field text"><div class="field-inner"><svg viewbox="0 0 36 36" x="0px" y="0px" enable-background="new 0 0 36 36" xml:space="preserve"><path d="M35.525,31.228l-8.88-8.882c1.444-2.238,2.298-4.895,2.298-7.752c0-7.909-6.438-14.343-14.346-14.343						c-7.911,0-14.343,6.434-14.343,14.343c0,7.911,6.433,14.344,14.343,14.344c2.856,0,5.513-0.849,7.752-2.294l8.88,8.88						c0.295,0.297,0.782,0.297,1.076,0l3.22-3.221C35.824,32.008,35.824,31.523,35.525,31.228z M4.81,14.593						c0-5.396,4.391-9.788,9.788-9.788c5.398,0,9.787,4.392,9.787,9.788c0,5.398-4.389,9.789-9.787,9.789						C9.2,24.382,4.81,19.991,4.81,14.593z"></path></svg><!----><div class="text-wrapper"><input id="search_field" name="search_field" placeholder="Search (Alt+F)" autocomplete="off" tabindex="0"></div><!----><!----></div></div></div><div id="results" class="mt1"></div></div><div id="lists" class="menu-inner mt1"><div class="inner"><div class="item"><a href="/documentation/" title="/documentation/"><!----><span>documentation</span></a><!----></div><div class="item"><a href="/examples/" title="/examples/"><!----><span>examples</span></a><!----></div><div class="item"><a href="/openframeworks/" title="/openframeworks/" class="nuxt-link-active"><!----><span>openFrameworks</span></a><div class="list"><div class="item"><a href="/openframeworks/3d/" title="/openframeworks/3d/"><!----><span>3d</span></a><!----></div><div class="item"><a href="/openframeworks/app/" title="/openframeworks/app/"><!----><span>app</span></a><!----></div><div class="item"><a href="/openframeworks/communication/" title="/openframeworks/communication/"><!----><span>communication</span></a><!----></div><div class="item"><a href="/openframeworks/events/" title="/openframeworks/events/"><!----><span>events</span></a><!----></div><div class="item"><a href="/openframeworks/gl/" title="/openframeworks/gl/"><!----><span>gl</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/" title="/openframeworks/graphics/" class="nuxt-link-active"><!----><span>graphics</span></a><div class="list"><div class="item"><a href="/openframeworks/graphics/of3dGraphics_cpp" title="/openframeworks/graphics/of3dGraphics.cpp"><!----><span>of3dGraphics.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/of3dGraphics_h" title="/openframeworks/graphics/of3dGraphics.h"><!----><span>of3dGraphics.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofBitmapFont_cpp" title="/openframeworks/graphics/ofBitmapFont.cpp"><!----><span>ofBitmapFont.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofBitmapFont_h" title="/openframeworks/graphics/ofBitmapFont.h"><!----><span>ofBitmapFont.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofCairoRenderer_cpp" title="/openframeworks/graphics/ofCairoRenderer.cpp"><!----><span>ofCairoRenderer.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofCairoRenderer_h" title="/openframeworks/graphics/ofCairoRenderer.h"><!----><span>ofCairoRenderer.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofGraphics_cpp" title="/openframeworks/graphics/ofGraphics.cpp"><!----><span>ofGraphics.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofGraphics_h" title="/openframeworks/graphics/ofGraphics.h"><!----><span>ofGraphics.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofGraphicsBaseTypes_cpp" title="/openframeworks/graphics/ofGraphicsBaseTypes.cpp"><!----><span>ofGraphicsBaseTypes.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofGraphicsBaseTypes_h" title="/openframeworks/graphics/ofGraphicsBaseTypes.h"><!----><span>ofGraphicsBaseTypes.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofGraphicsConstants_h" title="/openframeworks/graphics/ofGraphicsConstants.h"><!----><span>ofGraphicsConstants.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofImage_cpp" title="/openframeworks/graphics/ofImage.cpp" class="nuxt-link-exact-active nuxt-link-active"><!----><span>ofImage.cpp</span></a><div class="list"></div></div><div class="item"><a href="/openframeworks/graphics/ofImage_h" title="/openframeworks/graphics/ofImage.h"><!----><span>ofImage.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofPath_cpp" title="/openframeworks/graphics/ofPath.cpp"><!----><span>ofPath.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofPath_h" title="/openframeworks/graphics/ofPath.h"><!----><span>ofPath.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofPixels_cpp" title="/openframeworks/graphics/ofPixels.cpp"><!----><span>ofPixels.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofPixels_h" title="/openframeworks/graphics/ofPixels.h"><!----><span>ofPixels.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofPolyline_h" title="/openframeworks/graphics/ofPolyline.h"><!----><span>ofPolyline.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofRendererCollection_cpp" title="/openframeworks/graphics/ofRendererCollection.cpp"><!----><span>ofRendererCollection.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofRendererCollection_h" title="/openframeworks/graphics/ofRendererCollection.h"><!----><span>ofRendererCollection.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofTessellator_cpp" title="/openframeworks/graphics/ofTessellator.cpp"><!----><span>ofTessellator.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofTessellator_h" title="/openframeworks/graphics/ofTessellator.h"><!----><span>ofTessellator.h</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofTrueTypeFont_cpp" title="/openframeworks/graphics/ofTrueTypeFont.cpp"><!----><span>ofTrueTypeFont.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/ofTrueTypeFont_h" title="/openframeworks/graphics/ofTrueTypeFont.h"><!----><span>ofTrueTypeFont.h</span></a><!----></div></div></div><div class="item"><a href="/openframeworks/math/" title="/openframeworks/math/"><!----><span>math</span></a><!----></div><div class="item"><a href="/openframeworks/sound/" title="/openframeworks/sound/"><!----><span>sound</span></a><!----></div><div class="item"><a href="/openframeworks/types/" title="/openframeworks/types/"><!----><span>types</span></a><!----></div><div class="item"><a href="/openframeworks/utils/" title="/openframeworks/utils/"><!----><span>utils</span></a><!----></div><div class="item"><a href="/openframeworks/video/" title="/openframeworks/video/"><!----><span>video</span></a><!----></div></div></div><div class="item"><a href="/addons/" title="/addons/"><!----><span>addons</span></a><!----></div><div class="item"><a href="/guides/" title="/guides/"><!----><span>guides</span></a><!----></div></div></div></div><div id="document"><div id="renderer" class="main"><div absolute="/Users/gilbertsinnott/Code/openFrameworks/libs/openFrameworks/graphics/ofImage.cpp" route="/openframeworks/graphics/ofImage.cpp" dir="../libs/openFrameworks/graphics" ext="cpp" type="source" id="271" parent="259" siblings="" translations="[object Object]" class="doc-header"><div class="doc-header-inner"><div class="inner"><div class="mt2 mb2"><span class="breadcrumbs"><span class="crumb"><a href="/" class="pink nuxt-link-active">ofDocs</a><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/" class="pink nuxt-link-active">openframeworks </a><!----><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/graphics/" class="pink nuxt-link-active">graphics </a><!----><span class="chevron right"></span></span><span class="crumb"><!----><span class="link">ofImage.cpp </span><!----></span></span></div></div></div></div><div id="code-page" class="markdown"><div id="side-menu"><!----><div id="see-also" filename="graphics" absolute="/Users/gilbertsinnott/Code/openFrameworks/libs/openFrameworks/graphics" dir="../libs/openFrameworks" route="/openframeworks/graphics/" ext="" type="folder" children="260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283" icon="category" parent="195" breadcrumbs="195" class="see-also"><h4>See also</h4><div class="also"><a href="/documentation/graphics/"><span class="origin">documentation</span><span class="name">graphics</span></a></div><div class="also"><a href="/examples/ios/graphicsExample/"><span class="origin">examples</span><span class="name">graphicsExample</span></a></div><div class="also"><a href="/examples/graphics/graphicsExample/"><span class="origin">examples</span><span class="name">graphicsExample</span></a></div><div class="also"><a href="/examples/graphics/"><span class="origin">examples</span><span class="name">graphics</span></a></div></div></div><div id="code-render" id="code-inner"><div class="inner"><pre><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofImage.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofConstants.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofAppRunner.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"FreeImage.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofURLFileLoader.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"uriparser/Uri.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofxAndroidUtils.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>


<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// static variable for freeImage initialization:</span>
<span class="token keyword">void</span> <span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token keyword">bool</span> deinit<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">// need a new bool to avoid c++ "deinitialization order fiasco":</span>
	<span class="token comment" spellcheck="true">// http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.15</span>
	<span class="token keyword">static</span> <span class="token keyword">bool</span>	<span class="token operator">*</span> bFreeImageInited <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">bool</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">*</span>bFreeImageInited <span class="token operator">&&</span> <span class="token operator">!</span>deinit<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">FreeImage_Initialise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>bFreeImageInited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>bFreeImageInited <span class="token operator">&&</span> deinit<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">FreeImage_DeInitialise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>bFreeImageInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">></span>
FREE_IMAGE_TYPE <span class="token function">getFreeImageType</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&</span> pix<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token operator">></span>
FREE_IMAGE_TYPE <span class="token function">getFreeImageType</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels<span class="token operator">&</span> pix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> FIT_BITMAP<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token operator">></span>
FREE_IMAGE_TYPE <span class="token function">getFreeImageType</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofShortPixels<span class="token operator">&</span> pix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>pix<span class="token punctuation">.</span><span class="token function">getNumChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token keyword">return</span> FIT_UINT16<span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token keyword">return</span> FIT_RGB16<span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">return</span> FIT_RGBA16<span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getFreeImageType(): unknown FreeImage type for number of channels:"</span> <span class="token operator">&lt;&lt;</span> pix<span class="token punctuation">.</span><span class="token function">getNumChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> FIT_UNKNOWN<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token operator">></span>
FREE_IMAGE_TYPE <span class="token function">getFreeImageType</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofFloatPixels<span class="token operator">&</span> pix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>pix<span class="token punctuation">.</span><span class="token function">getNumChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token keyword">return</span> FIT_FLOAT<span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token keyword">return</span> FIT_RGBF<span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">return</span> FIT_RGBAF<span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getFreeImageType(): unknown FreeImage type for number of channels:"</span> <span class="token operator">&lt;&lt;</span> pix<span class="token punctuation">.</span><span class="token function">getNumChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> FIT_UNKNOWN<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
FIBITMAP<span class="token operator">*</span> <span class="token function">getBmpFromPixels</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span>pix<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> PixelType<span class="token operator">*</span> pixels <span class="token operator">=</span> pix<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> width <span class="token operator">=</span> pix<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> height <span class="token operator">=</span> pix<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> bpp <span class="token operator">=</span> pix<span class="token punctuation">.</span><span class="token function">getBitsPerPixel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	FREE_IMAGE_TYPE freeImageType <span class="token operator">=</span> <span class="token function">getFreeImageType</span><span class="token punctuation">(</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	FIBITMAP<span class="token operator">*</span> bmp <span class="token operator">=</span> <span class="token function">FreeImage_AllocateT</span><span class="token punctuation">(</span>freeImageType<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> bpp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> bmpBits <span class="token operator">=</span> <span class="token function">FreeImage_GetBits</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bmpBits <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> srcStride <span class="token operator">=</span> width <span class="token operator">*</span> pix<span class="token punctuation">.</span><span class="token function">getBytesPerPixel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> dstStride <span class="token operator">=</span> <span class="token function">FreeImage_GetPitch</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> src <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span> pixels<span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> dst <span class="token operator">=</span> bmpBits<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>srcStride <span class="token operator">!=</span> dstStride<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>height<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">memcpy</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> src<span class="token punctuation">,</span> srcStride<span class="token punctuation">)</span><span class="token punctuation">;</span>
				src <span class="token operator">+</span><span class="token operator">=</span> srcStride<span class="token punctuation">;</span>
				dst <span class="token operator">+</span><span class="token operator">=</span> dstStride<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token function">memcpy</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span>src<span class="token punctuation">,</span>dstStride<span class="token operator">*</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getBmpFromPixels(): unable to get FIBITMAP from ofPixels"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// ofPixels are top left, FIBITMAP is bottom left</span>
	<span class="token function">FreeImage_FlipVertical</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> bmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">putBmpIntoPixels</span><span class="token punctuation">(</span>FIBITMAP <span class="token operator">*</span> bmp<span class="token punctuation">,</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">bool</span> swapOnLittleEndian <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">// convert to correct type depending on type of input bmp and PixelType</span>
	FIBITMAP<span class="token operator">*</span> bmpConverted <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	FREE_IMAGE_TYPE imgType <span class="token operator">=</span> <span class="token function">FreeImage_GetImageType</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PixelType<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&&</span>
		<span class="token punctuation">(</span><span class="token function">FreeImage_GetColorType</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span> <span class="token operator">==</span> FIC_PALETTE <span class="token operator">||</span> <span class="token function">FreeImage_GetBPP</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span>
		<span class="token operator">||</span>  imgType<span class="token operator">!=</span>FIT_BITMAP<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FreeImage_IsTransparent</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			bmpConverted <span class="token operator">=</span> <span class="token function">FreeImage_ConvertTo32Bits</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			bmpConverted <span class="token operator">=</span> <span class="token function">FreeImage_ConvertTo24Bits</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		bmp <span class="token operator">=</span> bmpConverted<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PixelType<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span> <span class="token operator">&&</span> imgType<span class="token operator">!=</span>FIT_UINT16 <span class="token operator">&&</span> imgType<span class="token operator">!=</span>FIT_RGB16 <span class="token operator">&&</span> imgType<span class="token operator">!=</span>FIT_RGBA16<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FreeImage_IsTransparent</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			bmpConverted <span class="token operator">=</span> <span class="token function">FreeImage_ConvertToType</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span>FIT_RGBA16<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			bmpConverted <span class="token operator">=</span> <span class="token function">FreeImage_ConvertToType</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span>FIT_RGB16<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		bmp <span class="token operator">=</span> bmpConverted<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PixelType<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span> <span class="token operator">&&</span> imgType<span class="token operator">!=</span>FIT_FLOAT <span class="token operator">&&</span> imgType<span class="token operator">!=</span>FIT_RGBF <span class="token operator">&&</span> imgType<span class="token operator">!=</span>FIT_RGBAF<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FreeImage_IsTransparent</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			bmpConverted <span class="token operator">=</span> <span class="token function">FreeImage_ConvertToType</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span>FIT_RGBAF<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			bmpConverted <span class="token operator">=</span> <span class="token function">FreeImage_ConvertToType</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span>FIT_RGBF<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		bmp <span class="token operator">=</span> bmpConverted<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">FreeImage_GetWidth</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">FreeImage_GetHeight</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> bpp <span class="token operator">=</span> <span class="token function">FreeImage_GetBPP</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> channels <span class="token operator">=</span> <span class="token punctuation">(</span>bpp <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PixelType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> pitch <span class="token operator">=</span> <span class="token function">FreeImage_GetPitch</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_LITTLE_ENDIAN</span>
    <span class="token keyword">bool</span> swapRG <span class="token operator">=</span> channels <span class="token operator">&&</span> swapOnLittleEndian <span class="token operator">&&</span> <span class="token punctuation">(</span>bpp<span class="token operator">/</span>channels <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
    <span class="token keyword">bool</span> swapRG <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>


	ofPixelFormat pixFormat<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>channels<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> pixFormat<span class="token operator">=</span>OF_PIXELS_GRAY<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>swapRG<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>channels<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span> pixFormat<span class="token operator">=</span>OF_PIXELS_BGR<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>channels<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span> pixFormat<span class="token operator">=</span>OF_PIXELS_BGRA<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>channels<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span> pixFormat<span class="token operator">=</span>OF_PIXELS_RGB<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>channels<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span> pixFormat<span class="token operator">=</span>OF_PIXELS_RGBA<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// ofPixels are top left, FIBITMAP is bottom left</span>
	<span class="token function">FreeImage_FlipVertical</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> bmpBits <span class="token operator">=</span> <span class="token function">FreeImage_GetBits</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bmpBits <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pix<span class="token punctuation">.</span><span class="token function">setFromAlignedPixels</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PixelType<span class="token operator">*</span><span class="token punctuation">)</span> bmpBits<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> pixFormat<span class="token punctuation">,</span> pitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"putBmpIntoPixels(): unable to set ofPixels from FIBITMAP"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>bmpConverted <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>bmpConverted<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>swapRG <span class="token operator">&&</span> channels <span class="token operator">>=</span><span class="token number">3</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pix<span class="token punctuation">.</span><span class="token function">swapRgb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/// internal</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getJpegOptionFromImageLoadSetting</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> option <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>accurate<span class="token punctuation">)</span>     option <span class="token operator">|</span><span class="token operator">=</span> JPEG_ACCURATE<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>exifRotate<span class="token punctuation">)</span>   option <span class="token operator">|</span><span class="token operator">=</span> JPEG_EXIFROTATE<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>grayscale<span class="token punctuation">)</span>    option <span class="token operator">|</span><span class="token operator">=</span> JPEG_GREYSCALE<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>separateCMYK<span class="token punctuation">)</span> option <span class="token operator">|</span><span class="token operator">=</span> JPEG_CMYK<span class="token punctuation">;</span>
	<span class="token keyword">return</span> option<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> _fileName<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings<span class="token operator">&</span> settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">auto</span> uriStr <span class="token operator">=</span> _fileName<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	UriUriA uri<span class="token punctuation">;</span>
	UriParserStateA state<span class="token punctuation">;</span>
	state<span class="token punctuation">.</span>uri <span class="token operator">=</span> <span class="token operator">&</span>uri<span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">uriParseUriA</span><span class="token punctuation">(</span><span class="token operator">&</span>state<span class="token punctuation">,</span> uriStr<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span>URI_SUCCESS<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token keyword">int</span> bytesNeeded <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token function">strlen</span><span class="token punctuation">(</span>uriStr<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span> <span class="token function">absUri</span><span class="token punctuation">(</span>bytesNeeded<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_WIN32</span>
		<span class="token function">uriWindowsFilenameToUriStringA</span><span class="token punctuation">(</span>uriStr<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> absUri<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">else</span></span>
		<span class="token function">uriUnixFilenameToUriStringA</span><span class="token punctuation">(</span>uriStr<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> absUri<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">uriParseUriA</span><span class="token punctuation">(</span><span class="token operator">&</span>state<span class="token punctuation">,</span> absUri<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span>URI_SUCCESS<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadImage(): malformed uri when loading image from uri "</span> <span class="token operator">&lt;&lt;</span> _fileName<span class="token punctuation">;</span>
			<span class="token function">uriFreeUriMembersA</span><span class="token punctuation">(</span><span class="token operator">&</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	std<span class="token operator">::</span>string <span class="token function">scheme</span><span class="token punctuation">(</span>uri<span class="token punctuation">.</span>scheme<span class="token punctuation">.</span>first<span class="token punctuation">,</span> uri<span class="token punctuation">.</span>scheme<span class="token punctuation">.</span>afterLast<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">uriFreeUriMembersA</span><span class="token punctuation">(</span><span class="token operator">&</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>scheme <span class="token operator">==</span> <span class="token string">"http"</span> <span class="token operator">||</span> scheme <span class="token operator">==</span> <span class="token string">"https"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span> <span class="token function">ofLoadURL</span><span class="token punctuation">(</span>_fileName<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	std<span class="token operator">::</span>string fileName <span class="token operator">=</span> <span class="token function">ofToDataPath</span><span class="token punctuation">(</span>_fileName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">bool</span> bLoaded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	FIBITMAP <span class="token operator">*</span> bmp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

	FREE_IMAGE_FORMAT fif <span class="token operator">=</span> FIF_UNKNOWN<span class="token punctuation">;</span>
	fif <span class="token operator">=</span> <span class="token function">FreeImage_GetFileType</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fif <span class="token operator">==</span> FIF_UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// or guess via filename</span>
		fif <span class="token operator">=</span> <span class="token function">FreeImage_GetFIFFromFilename</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fif <span class="token operator">!=</span> FIF_UNKNOWN<span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token function">FreeImage_FIFSupportsReading</span><span class="token punctuation">(</span>fif<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>fif <span class="token operator">==</span> FIF_JPEG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">int</span> option <span class="token operator">=</span> <span class="token function">getJpegOptionFromImageLoadSetting</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
			bmp <span class="token operator">=</span> <span class="token function">FreeImage_Load</span><span class="token punctuation">(</span>fif<span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			bmp <span class="token operator">=</span> <span class="token function">FreeImage_Load</span><span class="token punctuation">(</span>fif<span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			bLoaded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">//-----------------------------</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span> bLoaded <span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">putBmpIntoPixels</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> bLoaded<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">bool</span> bLoaded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	FIBITMAP<span class="token operator">*</span> bmp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	FIMEMORY<span class="token operator">*</span> hmem <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

	hmem <span class="token operator">=</span> <span class="token function">FreeImage_OpenMemory</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span> buffer<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>hmem <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadImage(): couldn't load image from ofBuffer, opening FreeImage memory failed"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">//get the file type!</span>
	FREE_IMAGE_FORMAT fif <span class="token operator">=</span> <span class="token function">FreeImage_GetFileTypeFromMemory</span><span class="token punctuation">(</span>hmem<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> fif <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadImage(): couldn't load image from ofBuffer, unable to guess image format from memory"</span><span class="token punctuation">;</span>
		<span class="token function">FreeImage_CloseMemory</span><span class="token punctuation">(</span>hmem<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment" spellcheck="true">//make the image!!</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fif <span class="token operator">==</span> FIF_JPEG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> option <span class="token operator">=</span> <span class="token function">getJpegOptionFromImageLoadSetting</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bmp <span class="token operator">=</span> <span class="token function">FreeImage_LoadFromMemory</span><span class="token punctuation">(</span>fif<span class="token punctuation">,</span> hmem<span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		bmp <span class="token operator">=</span> <span class="token function">FreeImage_LoadFromMemory</span><span class="token punctuation">(</span>fif<span class="token punctuation">,</span> hmem<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span> bmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
		bLoaded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">//-----------------------------</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bLoaded<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">putBmpIntoPixels</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span> hmem <span class="token operator">!=</span> <span class="token keyword">nullptr</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">FreeImage_CloseMemory</span><span class="token punctuation">(</span>hmem<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> bLoaded<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> path<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span> path<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofShortPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> path<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span> path<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofShortPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofFloatPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> path<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span> path<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofFloatPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofTexture <span class="token operator">&</span> tex<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> path<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	ofPixels pixels<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> loaded <span class="token operator">=</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> path<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>loaded<span class="token punctuation">)</span><span class="token punctuation">{</span>
		tex<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>pixels<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pixels<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ofGetGLInternalFormat</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		tex<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> loaded<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>ofTexture <span class="token operator">&</span> tex<span class="token punctuation">,</span> <span class="token keyword">const</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	ofPixels pixels<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> loaded <span class="token operator">=</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>loaded<span class="token punctuation">)</span><span class="token punctuation">{</span>
		tex<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>pixels<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pixels<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ofGetGLInternalFormat</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		tex<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> loaded<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">saveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> _pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> _fileName<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_pix<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"saveImage(): couldn't save \""</span> <span class="token operator">&lt;&lt;</span> _fileName <span class="token operator">&lt;&lt;</span> <span class="token string">"\", pixels are not allocated"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	ofFilePath<span class="token operator">::</span><span class="token function">createEnclosingDirectory</span><span class="token punctuation">(</span>_fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>string fileName <span class="token operator">=</span> <span class="token function">ofToDataPath</span><span class="token punctuation">(</span>_fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	FREE_IMAGE_FORMAT fif <span class="token operator">=</span> FIF_UNKNOWN<span class="token punctuation">;</span>
	fif <span class="token operator">=</span> <span class="token function">FreeImage_GetFileType</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fif <span class="token operator">==</span> FIF_UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// or guess via filename</span>
		fif <span class="token operator">=</span> <span class="token function">FreeImage_GetFIFFromFilename</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fif<span class="token operator">==</span>FIF_JPEG <span class="token operator">&&</span> <span class="token punctuation">(</span>_pix<span class="token punctuation">.</span><span class="token function">getNumChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span> <span class="token operator">||</span> _pix<span class="token punctuation">.</span><span class="token function">getBitsPerChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		ofPixels pix3 <span class="token operator">=</span> _pix<span class="token punctuation">;</span>
		pix3<span class="token punctuation">.</span><span class="token function">setNumChannels</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix3<span class="token punctuation">,</span>_fileName<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	FIBITMAP <span class="token operator">*</span> bmp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_LITTLE_ENDIAN</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PixelType<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&&</span> <span class="token punctuation">(</span>_pix<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>OF_PIXELS_RGB <span class="token operator">||</span> _pix<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>OF_PIXELS_RGBA<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment" spellcheck="true">// Make a local copy.</span>
		ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> pix <span class="token operator">=</span> _pix<span class="token punctuation">;</span>
		pix<span class="token punctuation">.</span><span class="token function">swapRgb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bmp	<span class="token operator">=</span> <span class="token function">getBmpFromPixels</span><span class="token punctuation">(</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>

		bmp	<span class="token operator">=</span> <span class="token function">getBmpFromPixels</span><span class="token punctuation">(</span>_pix<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_LITTLE_ENDIAN</span>
	<span class="token punctuation">}</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>

	<span class="token keyword">bool</span> retValue <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fif <span class="token operator">!=</span> FIF_UNKNOWN<span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token function">FreeImage_FIFSupportsReading</span><span class="token punctuation">(</span>fif<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>fif <span class="token operator">==</span> FIF_JPEG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">int</span> quality <span class="token operator">=</span> JPEG_QUALITYSUPERB<span class="token punctuation">;</span>
			<span class="token keyword">switch</span><span class="token punctuation">(</span>qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_WORST<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYBAD<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_LOW<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYAVERAGE<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_MEDIUM<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYNORMAL<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_HIGH<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYGOOD<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_BEST<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYSUPERB<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			retValue <span class="token operator">=</span> <span class="token function">FreeImage_Save</span><span class="token punctuation">(</span>fif<span class="token punctuation">,</span> bmp<span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>qualityLevel <span class="token operator">!=</span> OF_IMAGE_QUALITY_BEST<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"saveImage(): ofImageCompressionType only applies to JPEGs,"</span>
					<span class="token operator">&lt;&lt;</span> <span class="token string">" ignoring value for \" "</span><span class="token operator">&lt;&lt;</span> fileName <span class="token operator">&lt;&lt;</span> <span class="token string">"\""</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>fif <span class="token operator">==</span> FIF_GIF<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				FIBITMAP<span class="token operator">*</span> convertedBmp<span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>_pix<span class="token punctuation">.</span><span class="token function">getImageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> OF_IMAGE_COLOR_ALPHA<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// this just converts the image to grayscale so it can save something</span>
					convertedBmp <span class="token operator">=</span> <span class="token function">FreeImage_ConvertTo8Bits</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// this will create a 256-color palette from the image</span>
					convertedBmp <span class="token operator">=</span> <span class="token function">FreeImage_ColorQuantize</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span> FIQ_NNQUANT<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				retValue <span class="token operator">=</span> <span class="token function">FreeImage_Save</span><span class="token punctuation">(</span>fif<span class="token punctuation">,</span> convertedBmp<span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>convertedBmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>convertedBmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				retValue <span class="token operator">=</span> <span class="token function">FreeImage_Save</span><span class="token punctuation">(</span>fif<span class="token punctuation">,</span> bmp<span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> retValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> fileName<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span>fileName<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofFloatPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> fileName<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span>fileName<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofShortPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> fileName<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span>fileName<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">saveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> _pix<span class="token punctuation">,</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> ofImageFormat format<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">// thanks to alvaro casinelli for the implementation</span>

	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>_pix<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">,</span><span class="token string">"saveImage(): couldn't save to ofBuffer, pixels are not allocated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>format<span class="token operator">==</span>OF_IMAGE_FORMAT_JPEG <span class="token operator">&&</span> <span class="token punctuation">(</span>_pix<span class="token punctuation">.</span><span class="token function">getNumChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span> <span class="token operator">||</span> _pix<span class="token punctuation">.</span><span class="token function">getBitsPerChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		ofPixels pix3 <span class="token operator">=</span> _pix<span class="token punctuation">;</span>
		pix3<span class="token punctuation">.</span><span class="token function">setNumChannels</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix3<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span>format<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	FIBITMAP <span class="token operator">*</span> bmp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_LITTLE_ENDIAN</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>PixelType<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&&</span> <span class="token punctuation">(</span>_pix<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>OF_PIXELS_RGB <span class="token operator">||</span> _pix<span class="token punctuation">.</span><span class="token function">getPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>OF_PIXELS_RGBA<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment" spellcheck="true">// Make a local copy.</span>
		ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> pix <span class="token operator">=</span> _pix<span class="token punctuation">;</span>
		pix<span class="token punctuation">.</span><span class="token function">swapRgb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bmp	<span class="token operator">=</span> <span class="token function">getBmpFromPixels</span><span class="token punctuation">(</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>

		bmp	<span class="token operator">=</span> <span class="token function">getBmpFromPixels</span><span class="token punctuation">(</span>_pix<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_LITTLE_ENDIAN</span>
	<span class="token punctuation">}</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bmp<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// bitmap successfully created</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">bool</span> returnValue<span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// (b) open a memory stream to compress the image onto mem_buffer:</span>
		<span class="token comment" spellcheck="true">//</span>
		FIMEMORY <span class="token operator">*</span>hmem <span class="token operator">=</span> <span class="token function">FreeImage_OpenMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// (c) encode and save the image to the memory (on dib FIBITMAP image):</span>
		<span class="token comment" spellcheck="true">//</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FREE_IMAGE_FORMAT</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span> <span class="token operator">==</span> FIF_JPEG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">int</span> quality <span class="token operator">=</span> JPEG_QUALITYSUPERB<span class="token punctuation">;</span>
			<span class="token keyword">switch</span><span class="token punctuation">(</span>qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_WORST<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYBAD<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_LOW<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYAVERAGE<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_MEDIUM<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYNORMAL<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_HIGH<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYGOOD<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> OF_IMAGE_QUALITY_BEST<span class="token operator">:</span> quality <span class="token operator">=</span> JPEG_QUALITYSUPERB<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			returnValue <span class="token operator">=</span> <span class="token function">FreeImage_SaveToMemory</span><span class="token punctuation">(</span>FIF_JPEG<span class="token punctuation">,</span> bmp<span class="token punctuation">,</span> hmem<span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			returnValue <span class="token operator">=</span> <span class="token function">FreeImage_SaveToMemory</span><span class="token punctuation">(</span><span class="token punctuation">(</span>FREE_IMAGE_FORMAT<span class="token punctuation">)</span>format<span class="token punctuation">,</span> bmp<span class="token punctuation">,</span> hmem<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">/*

		NOTE: at this point, hmem contains the entire data in memory stored in fif format. the
		amount of space used by the memory is equal to file_size:
		long file_size = FreeImage_TellMemory(hmem);
		but can also be retrieved by FreeImage_AcquireMemory that retrieves both the
		length of the buffer, and the buffer memory address.
		*/</span>
		<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_WIN32</span>
		   DWORD size_in_bytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token macro property">#<span class="token directive keyword">else</span></span>
		   std<span class="token operator">::</span>uint32_t size_in_bytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token macro property">#<span class="token directive keyword">endif</span></span>
		<span class="token comment" spellcheck="true">// Save compressed data on mem_buffer</span>
		<span class="token comment" spellcheck="true">// note: FreeImage_AquireMemory allocates space for aux_mem_buffer):</span>
		<span class="token comment" spellcheck="true">//</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>mem_buffer <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FreeImage_AcquireMemory</span><span class="token punctuation">(</span>hmem<span class="token punctuation">,</span> <span class="token operator">&</span>mem_buffer<span class="token punctuation">,</span> <span class="token operator">&</span>size_in_bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"saveImage(): couldn't save to ofBuffer, aquiring compressed image from memory failed"</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">/*
		  Now, before closing the memory stream, copy the content of mem_buffer
		  to an auxiliary buffer
		*/</span>

		buffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>mem_buffer<span class="token punctuation">,</span>size_in_bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">// Finally, close the FIBITMAP object, or we will get a memory leak:</span>
		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">// Close the memory stream (otherwise we may get a memory leak).</span>
		<span class="token function">FreeImage_CloseMemory</span><span class="token punctuation">(</span>hmem<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> returnValue<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------------</span>
<span class="token keyword">bool</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> ofImageFormat format<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span>format<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofFloatPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> ofImageFormat format<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span>format<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofShortPixels <span class="token operator">&</span> pix<span class="token punctuation">,</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> ofImageFormat format<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">saveImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span>format<span class="token punctuation">,</span>qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//----------------------------------------------------</span>
<span class="token comment" spellcheck="true">// freeImage based stuff:</span>
<span class="token keyword">void</span> <span class="token function">ofCloseFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//-------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//  implementation</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">ofImage_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	width						<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	height						<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	bpp							<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	type						<span class="token operator">=</span> OF_IMAGE_UNDEFINED<span class="token punctuation">;</span>
	bUseTexture					<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>		<span class="token comment" spellcheck="true">// the default is, yes, use a texture</span>

	<span class="token comment" spellcheck="true">//----------------------- init free image if necessary</span>
	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">ofImage_</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> pix<span class="token punctuation">)</span><span class="token punctuation">{</span>
	width						<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	height						<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	bpp							<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	type						<span class="token operator">=</span> OF_IMAGE_UNDEFINED<span class="token punctuation">;</span>
	bUseTexture					<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>		<span class="token comment" spellcheck="true">// the default is, yes, use a texture</span>

	<span class="token comment" spellcheck="true">//----------------------- init free image if necessary</span>
	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token function">setFromPixels</span><span class="token punctuation">(</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">ofImage_</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path <span class="token operator">&</span> fileName<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	width						<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	height						<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	bpp							<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	type						<span class="token operator">=</span> OF_IMAGE_UNDEFINED<span class="token punctuation">;</span>
	bUseTexture					<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>		<span class="token comment" spellcheck="true">// the default is, yes, use a texture</span>

	<span class="token comment" spellcheck="true">//----------------------- init free image if necessary</span>
	<span class="token function">ofInitFreeImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token function">load</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> mom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">&</span>mom<span class="token operator">==</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token function">clone</span><span class="token punctuation">(</span>mom<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">ofImage_</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> mom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">clone</span><span class="token punctuation">(</span>mom<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">ofImage_</span><span class="token punctuation">(</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&&</span> mom<span class="token punctuation">)</span><span class="token punctuation">{</span>
    pixels      <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>mom<span class="token punctuation">.</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tex         <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>mom<span class="token punctuation">.</span>tex<span class="token punctuation">)</span><span class="token punctuation">;</span>

    bUseTexture <span class="token operator">=</span> mom<span class="token punctuation">.</span>bUseTexture<span class="token punctuation">;</span>
    width       <span class="token operator">=</span> mom<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    height      <span class="token operator">=</span> mom<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    bpp         <span class="token operator">=</span> mom<span class="token punctuation">.</span>bpp<span class="token punctuation">;</span>
    type        <span class="token operator">=</span> mom<span class="token punctuation">.</span>type<span class="token punctuation">;</span>

    mom<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//clear remaining flags and sizes from the mom</span>

    <span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
    <span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&&</span> mom<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">&</span>mom<span class="token operator">==</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>

    pixels      <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>mom<span class="token punctuation">.</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tex         <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>mom<span class="token punctuation">.</span>tex<span class="token punctuation">)</span><span class="token punctuation">;</span>

    bUseTexture <span class="token operator">=</span> mom<span class="token punctuation">.</span>bUseTexture<span class="token punctuation">;</span>
    width       <span class="token operator">=</span> mom<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    height      <span class="token operator">=</span> mom<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    bpp         <span class="token operator">=</span> mom<span class="token punctuation">.</span>bpp<span class="token punctuation">;</span>
    type        <span class="token operator">=</span> mom<span class="token punctuation">.</span>type<span class="token punctuation">;</span>

    mom<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//clear remaining flags and sizes from the mom</span>

    <span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
    <span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">#<span class="token directive keyword">endif</span></span>

    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token operator">~</span><span class="token function">ofImage_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofFile <span class="token operator">&</span> file<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> fileName<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token keyword">bool</span> bLoadedOk <span class="token operator">=</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bLoadedOk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadImage(): couldn't load image from \""</span> <span class="token operator">&lt;&lt;</span> fileName <span class="token operator">&lt;&lt;</span> <span class="token string">"\""</span><span class="token punctuation">;</span>
		<span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> bLoadedOk<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&</span> fileName<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> <span class="token keyword">const</span> ofImageLoadSettings <span class="token operator">&</span>settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token keyword">bool</span> bLoadedOk <span class="token operator">=</span> <span class="token function">ofLoadImage</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bLoadedOk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"loadImage(): couldn't load image from ofBuffer"</span><span class="token punctuation">;</span>
		<span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> bLoadedOk<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>filesystem<span class="token operator">::</span>path<span class="token operator">&</span> fileName<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">save</span><span class="token punctuation">(</span>ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> ofImageFormat imageFormat<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">ofSaveImage</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> imageFormat<span class="token punctuation">,</span> qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">saveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&</span> fileName<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token function">save</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">saveImage</span><span class="token punctuation">(</span>ofBuffer <span class="token operator">&</span> buffer<span class="token punctuation">,</span> ofImageQualityType qualityLevel<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token function">save</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> OF_IMAGE_FORMAT_PNG<span class="token punctuation">,</span> qualityLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">saveImage</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofFile <span class="token operator">&</span> file<span class="token punctuation">,</span> ofImageQualityType compressionLevel<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token function">save</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span>compressionLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// we could cap these values - but it might be more useful</span>
<span class="token comment" spellcheck="true">// to be able to set anchor points outside the image</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setAnchorPercent</span><span class="token punctuation">(</span><span class="token keyword">float</span> xPct<span class="token punctuation">,</span> <span class="token keyword">float</span> yPct<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bUseTexture<span class="token punctuation">)</span>tex<span class="token punctuation">.</span><span class="token function">setAnchorPercent</span><span class="token punctuation">(</span>xPct<span class="token punctuation">,</span> yPct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setAnchorPoint</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bUseTexture<span class="token punctuation">)</span>tex<span class="token punctuation">.</span><span class="token function">setAnchorPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">resetAnchor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>bUseTexture<span class="token punctuation">)</span>tex<span class="token punctuation">.</span><span class="token function">resetAnchor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">draw</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> z<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">draw</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">const</span> glm<span class="token operator">::</span>vec3 <span class="token operator">&</span> pos<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">draw</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span>pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> w<span class="token punctuation">,</span> <span class="token keyword">float</span> h<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">draw</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> z<span class="token punctuation">,</span> <span class="token keyword">float</span> w<span class="token punctuation">,</span> <span class="token keyword">float</span> h<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">drawSubsection</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">const</span> glm<span class="token operator">::</span>vec3 <span class="token operator">&</span> pos<span class="token punctuation">,</span> <span class="token keyword">float</span> w<span class="token punctuation">,</span> <span class="token keyword">float</span> h<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">draw</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span>pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">drawSubsection</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> w<span class="token punctuation">,</span> <span class="token keyword">float</span> h<span class="token punctuation">,</span> <span class="token keyword">float</span> sx<span class="token punctuation">,</span> <span class="token keyword">float</span> sy<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">drawSubsection</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>sx<span class="token punctuation">,</span>sy<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">drawSubsection</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> w<span class="token punctuation">,</span> <span class="token keyword">float</span> h<span class="token punctuation">,</span> <span class="token keyword">float</span> sx<span class="token punctuation">,</span> <span class="token keyword">float</span> sy<span class="token punctuation">,</span> <span class="token keyword">float</span> _sw<span class="token punctuation">,</span> <span class="token keyword">float</span> _sh<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">drawSubsection</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>sx<span class="token punctuation">,</span>sy<span class="token punctuation">,</span>_sw<span class="token punctuation">,</span>_sh<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">drawSubsection</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> z<span class="token punctuation">,</span> <span class="token keyword">float</span> w<span class="token punctuation">,</span> <span class="token keyword">float</span> h<span class="token punctuation">,</span> <span class="token keyword">float</span> sx<span class="token punctuation">,</span> <span class="token keyword">float</span> sy<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">drawSubsection</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>sx<span class="token punctuation">,</span>sy<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">drawSubsection</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> z<span class="token punctuation">,</span> <span class="token keyword">float</span> w<span class="token punctuation">,</span> <span class="token keyword">float</span> h<span class="token punctuation">,</span> <span class="token keyword">float</span> sx<span class="token punctuation">,</span> <span class="token keyword">float</span> sy<span class="token punctuation">,</span> <span class="token keyword">float</span> sw<span class="token punctuation">,</span> <span class="token keyword">float</span> sh<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token function">ofGetCurrentRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>sx<span class="token punctuation">,</span>sy<span class="token punctuation">,</span>sw<span class="token punctuation">,</span>sh<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">,</span> ofImageType newType<span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>width <span class="token operator">==</span> w <span class="token operator">&&</span> height <span class="token operator">==</span> h <span class="token operator">&&</span> newType <span class="token operator">==</span> type<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofAddListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	pixels<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> newType<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// take care of texture allocation --</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pixels<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&&</span> bUseTexture<span class="token punctuation">)</span><span class="token punctuation">{</span>
		tex<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	width	<span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	height	<span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bpp		<span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getBitsPerPixel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	type	<span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getImageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">bAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> pixels<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined(TARGET_ANDROID)</span>
	<span class="token function">ofRemoveListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>unloadTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofRemoveListener</span><span class="token punctuation">(</span><span class="token function">ofxAndroidEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reloadGL<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&</span>ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	pixels<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bUseTexture<span class="token punctuation">)</span>	tex<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	width					<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	height					<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	bpp						<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	type 					<span class="token operator">=</span> OF_IMAGE_UNDEFINED<span class="token punctuation">;</span>
	bUseTexture 			<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>		<span class="token comment" spellcheck="true">// the default is, yes, use a texture</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span>  ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getPixelsRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getPixelsRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token keyword">operator</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofTexture <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> tex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">const</span> ofTexture <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> tex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token comment" spellcheck="true">// for getting a reference to the texture</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofTexture <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getTextureReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">getTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">const</span> ofTexture <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getTextureReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">getTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> textureLocation<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bUseTexture <span class="token operator">&&</span> tex<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		tex<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>textureLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">unbind</span><span class="token punctuation">(</span><span class="token keyword">int</span> textureLocation<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bUseTexture <span class="token operator">&&</span> tex<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		tex<span class="token punctuation">.</span><span class="token function">unbind</span><span class="token punctuation">(</span>textureLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofColor_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofColor_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> pixels<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">const</span> ofColor_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pixels<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">const</span> ofColor_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pixels<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofColor_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">&</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pixels<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span>  ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setFromPixels</span><span class="token punctuation">(</span><span class="token keyword">const</span> PixelType <span class="token operator">*</span> newPixels<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">,</span> ofImageType newType<span class="token punctuation">,</span> <span class="token keyword">bool</span> bOrderIsRGB<span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token function">allocate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> newType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pixels<span class="token punctuation">.</span><span class="token function">setFromPixels</span><span class="token punctuation">(</span>newPixels<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>newType<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bOrderIsRGB <span class="token operator">&&</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PixelType<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		pixels<span class="token punctuation">.</span><span class="token function">swapRgb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setFromPixels</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> pixels<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">setFromPixels</span><span class="token punctuation">(</span>pixels<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pixels<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pixels<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pixels<span class="token punctuation">.</span><span class="token function">getImageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> pixels<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">setFromPixels</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	width <span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	height <span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bpp <span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getBitsPerPixel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	type <span class="token operator">=</span> pixels<span class="token punctuation">.</span><span class="token function">getImageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pixels<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&&</span> bUseTexture<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">int</span> glInternalFormat <span class="token operator">=</span> <span class="token function">ofGetGLInternalFormat</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>tex<span class="token punctuation">.</span><span class="token function">isAllocated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> tex<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> width <span class="token operator">||</span> tex<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> height <span class="token operator">||</span> tex<span class="token punctuation">.</span><span class="token function">getTextureData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>glInternalFormat <span class="token operator">!=</span> glInternalFormat<span class="token punctuation">)</span><span class="token punctuation">{</span>
			tex<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			tex<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setUseTexture</span><span class="token punctuation">(</span><span class="token keyword">bool</span> bUse<span class="token punctuation">)</span><span class="token punctuation">{</span>
	bUseTexture <span class="token operator">=</span> bUse<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">bool</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">isUsingTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> bUseTexture<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">grabScreen</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>
	std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>ofBaseGLRenderer<span class="token operator">></span> renderer <span class="token operator">=</span> <span class="token function">ofGetGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">{</span>
		renderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">saveScreen</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>pixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">ofGrabScreen</span><span class="token punctuation">(</span>ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> pixels<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>
	ofPixels p<span class="token punctuation">;</span>
	std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>ofBaseGLRenderer<span class="token operator">></span> renderer <span class="token operator">=</span> <span class="token function">ofGetGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">{</span>
		renderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">saveScreen</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pixels <span class="token operator">=</span> p<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">ofGrabScreen</span><span class="token punctuation">(</span>ofPixels <span class="token operator">&</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>
	std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>ofBaseGLRenderer<span class="token operator">></span> renderer <span class="token operator">=</span> <span class="token function">ofGetGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">{</span>
		renderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">saveScreen</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">grabScreen</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">ofGrabScreen</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setImageType</span><span class="token punctuation">(</span>ofImageType newType<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">changeTypeOfPixels</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> newType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
ofImageType ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getImageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> type<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> newWidth<span class="token punctuation">,</span> <span class="token keyword">int</span> newHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>newWidth <span class="token operator">==</span> width <span class="token operator">&&</span> newHeight <span class="token operator">==</span> height<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token function">resizePixels</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> newWidth<span class="token punctuation">,</span> newHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">crop</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>
	w <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	h <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	pixels<span class="token punctuation">.</span><span class="token function">crop</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">cropFrom</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span> otherImage<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>
	w <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">(</span>otherImage<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	h <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">(</span>otherImage<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	otherImage<span class="token punctuation">.</span>pixels<span class="token punctuation">.</span><span class="token function">cropTo</span><span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">rotate90</span><span class="token punctuation">(</span><span class="token keyword">int</span> nRotations<span class="token punctuation">)</span><span class="token punctuation">{</span>
	pixels<span class="token punctuation">.</span><span class="token function">rotate90</span><span class="token punctuation">(</span>nRotations<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">mirror</span><span class="token punctuation">(</span><span class="token keyword">bool</span> vertical<span class="token punctuation">,</span> <span class="token keyword">bool</span> horizontal<span class="token punctuation">)</span><span class="token punctuation">{</span>
	pixels<span class="token punctuation">.</span><span class="token function">mirror</span><span class="token punctuation">(</span>vertical<span class="token punctuation">,</span> horizontal<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>






<span class="token comment" spellcheck="true">//----------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//----------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">//----------------------------------------------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// freeImage based code & utilities:</span>


<span class="token comment" spellcheck="true">//----------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">resizePixels</span><span class="token punctuation">(</span>ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span>pix<span class="token punctuation">,</span> <span class="token keyword">int</span> newWidth<span class="token punctuation">,</span> <span class="token keyword">int</span> newHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>

	FIBITMAP <span class="token operator">*</span> bmp					<span class="token operator">=</span> <span class="token function">getBmpFromPixels</span><span class="token punctuation">(</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	FIBITMAP <span class="token operator">*</span> convertedBmp			<span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

	convertedBmp <span class="token operator">=</span> <span class="token function">FreeImage_Rescale</span><span class="token punctuation">(</span>bmp<span class="token punctuation">,</span> newWidth<span class="token punctuation">,</span> newHeight<span class="token punctuation">,</span> FILTER_BICUBIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putBmpIntoPixels</span><span class="token punctuation">(</span>convertedBmp<span class="token punctuation">,</span> pix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>				<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>convertedBmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>convertedBmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">changeTypeOfPixels</span><span class="token punctuation">(</span>ofPixels_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span> <span class="token operator">&</span>pix<span class="token punctuation">,</span> ofImageType newType<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> oldType <span class="token operator">=</span> pix<span class="token punctuation">.</span><span class="token function">getImageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>oldType <span class="token operator">==</span> newType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// no need to reallocate</span>
	<span class="token punctuation">}</span>

	FIBITMAP <span class="token operator">*</span> bmp <span class="token operator">=</span> <span class="token function">getBmpFromPixels</span><span class="token punctuation">(</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	FIBITMAP <span class="token operator">*</span> convertedBmp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

	<span class="token keyword">switch</span> <span class="token punctuation">(</span>newType<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">case</span> OF_IMAGE_GRAYSCALE<span class="token operator">:</span>
			convertedBmp <span class="token operator">=</span> <span class="token function">FreeImage_ConvertToGreyscale</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> OF_IMAGE_COLOR<span class="token operator">:</span>
			convertedBmp <span class="token operator">=</span> <span class="token function">FreeImage_ConvertTo24Bits</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> OF_IMAGE_COLOR_ALPHA<span class="token operator">:</span>
			convertedBmp <span class="token operator">=</span> <span class="token function">FreeImage_ConvertTo32Bits</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofImage"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"changeTypeOfPixels(): unknown image type: "</span>
				<span class="token operator">&lt;&lt;</span> <span class="token function">ofToString</span><span class="token punctuation">(</span>newType<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

    <span class="token function">putBmpIntoPixels</span><span class="token punctuation">(</span>convertedBmp<span class="token punctuation">,</span> pix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>convertedBmp <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">FreeImage_Unload</span><span class="token punctuation">(</span>convertedBmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">unloadTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	tex<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">float</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">float</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> width<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//----------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// Sosolimited: texture compression</span>
<span class="token comment" spellcheck="true">// call this function before you call loadImage()</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PixelType<span class="token operator">></span>
<span class="token keyword">void</span> ofImage_<span class="token operator">&lt;</span>PixelType<span class="token operator">></span><span class="token operator">::</span><span class="token function">setCompression</span><span class="token punctuation">(</span>ofTexCompression compression<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>bUseTexture<span class="token punctuation">)</span><span class="token punctuation">{</span>
		tex<span class="token punctuation">.</span><span class="token function">setCompression</span><span class="token punctuation">(</span> compression <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token keyword">class</span> <span class="token class-name">ofImage_</span><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">template</span> <span class="token keyword">class</span> <span class="token class-name">ofImage_</span><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">template</span> <span class="token keyword">class</span> <span class="token class-name">ofImage_</span><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">></span>
std<span class="token operator">::</span>string <span class="token function">ofToString</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofImageType <span class="token operator">&</span> imgType<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>imgType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> OF_IMAGE_GRAYSCALE<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"OF_IMAGE_GRAYSCALE"</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> OF_IMAGE_COLOR<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"OF_IMAGE_COLOR"</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span>  OF_IMAGE_COLOR_ALPHA<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"OF_IMAGE_COLOR_ALPHA"</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> OF_IMAGE_UNDEFINED<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"OF_IMAGE_UNDEFINED"</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token string">"OF_IMAGE_UNDEFINED"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div></div></div></div></div></div><script defer src="/_nuxt/payloads/1583566544124/openframeworks/graphics/ofImage_cpp/payload.js"></script><script src="/_nuxt/cede893bee7aedd34019.js" defer></script><script src="/_nuxt/3517dc6c150c1f5be417.js" defer></script><script src="/_nuxt/561e36663ec83bdcd2ac.js" defer></script><script src="/_nuxt/26c5a70906ce7aaac460.js" defer></script><script src="/_nuxt/2c5d9034468f7212e81b.js" defer></script>
  </body>
</html>
