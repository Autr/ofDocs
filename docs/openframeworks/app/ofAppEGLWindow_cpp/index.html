<!doctype html>
<html data-n-head-ssr>
  <head>
    <meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" data-hid="keyword" name="keyword" content=""><meta data-n-head="ssr" property="og:description" content="" vmid="og:description"><meta data-n-head="ssr" property="og:title" content="" vmid="og:title"><meta data-n-head="ssr" property="og:image" content="" vmid="og:image"><link rel="preload" href="/_nuxt/76844c096ee4b2a8e8b3.js" as="script"><link rel="preload" href="/_nuxt/561e36663ec83bdcd2ac.js" as="script"><link rel="preload" href="/_nuxt/fe12c0cb7395fa1032f4.css" as="style"><link rel="preload" href="/_nuxt/26c5a70906ce7aaac460.js" as="script"><link rel="preload" href="/_nuxt/75259d9b56378e7dbe47.css" as="style"><link rel="preload" href="/_nuxt/af3debaf278e0e1fd9de.js" as="script"><link rel="preload" href="/_nuxt/74971516fa343f955f83.css" as="style"><link rel="preload" href="/_nuxt/0128aba013e56fe5f14b.js" as="script"><link rel="stylesheet" href="/_nuxt/fe12c0cb7395fa1032f4.css"><link rel="stylesheet" href="/_nuxt/75259d9b56378e7dbe47.css"><link rel="stylesheet" href="/_nuxt/74971516fa343f955f83.css">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="app" class="unknown"><div id="menu"><h1 class="of"><div class="inner"><span><a href="/" class="nuxt-link-active"><div class="txt"><span class="docs f7 questrial">ofDocs </span><span class="version">0.11.0</span></div></a></span></div></h1><div id="search"><div class="inner"><div class="field text"><div class="field-inner"><svg viewbox="0 0 36 36" x="0px" y="0px" enable-background="new 0 0 36 36" xml:space="preserve"><path d="M35.525,31.228l-8.88-8.882c1.444-2.238,2.298-4.895,2.298-7.752c0-7.909-6.438-14.343-14.346-14.343						c-7.911,0-14.343,6.434-14.343,14.343c0,7.911,6.433,14.344,14.343,14.344c2.856,0,5.513-0.849,7.752-2.294l8.88,8.88						c0.295,0.297,0.782,0.297,1.076,0l3.22-3.221C35.824,32.008,35.824,31.523,35.525,31.228z M4.81,14.593						c0-5.396,4.391-9.788,9.788-9.788c5.398,0,9.787,4.392,9.787,9.788c0,5.398-4.389,9.789-9.787,9.789						C9.2,24.382,4.81,19.991,4.81,14.593z"></path></svg><!----><div class="text-wrapper"><input id="search_field" name="search_field" placeholder="Search (Alt+F)" autocomplete="off" tabindex="0"></div><!----><!----></div></div></div><div id="results" class="mt1"></div></div><div id="lists" class="menu-inner mt1"><div class="inner"><div class="item"><a href="/documentation/" title="/documentation/"><!----><span>documentation</span></a><!----></div><div class="item"><a href="/examples/" title="/examples/"><!----><span>examples</span></a><!----></div><div class="item"><a href="/openframeworks/" title="/openframeworks/" class="nuxt-link-active"><!----><span>openFrameworks</span></a><div class="list"><div class="item"><a href="/openframeworks/3d/" title="/openframeworks/3d/"><!----><span>3d</span></a><!----></div><div class="item"><a href="/openframeworks/app/" title="/openframeworks/app/" class="nuxt-link-active"><!----><span>app</span></a><div class="list"><div class="item"><a href="/openframeworks/app/ofAppBaseWindow_h" title="/openframeworks/app/ofAppBaseWindow.h"><!----><span>ofAppBaseWindow.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppEGLWindow_cpp" title="/openframeworks/app/ofAppEGLWindow.cpp" class="nuxt-link-exact-active nuxt-link-active"><!----><span>ofAppEGLWindow.cpp</span></a><div class="list"></div></div><div class="item"><a href="/openframeworks/app/ofAppEGLWindow_h" title="/openframeworks/app/ofAppEGLWindow.h"><!----><span>ofAppEGLWindow.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppGLFWWindow_cpp" title="/openframeworks/app/ofAppGLFWWindow.cpp"><!----><span>ofAppGLFWWindow.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppGLFWWindow_h" title="/openframeworks/app/ofAppGLFWWindow.h"><!----><span>ofAppGLFWWindow.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppGlutWindow_cpp" title="/openframeworks/app/ofAppGlutWindow.cpp"><!----><span>ofAppGlutWindow.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppGlutWindow_h" title="/openframeworks/app/ofAppGlutWindow.h"><!----><span>ofAppGlutWindow.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppNoWindow_cpp" title="/openframeworks/app/ofAppNoWindow.cpp"><!----><span>ofAppNoWindow.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppNoWindow_h" title="/openframeworks/app/ofAppNoWindow.h"><!----><span>ofAppNoWindow.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppRunner_cpp" title="/openframeworks/app/ofAppRunner.cpp"><!----><span>ofAppRunner.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofAppRunner_h" title="/openframeworks/app/ofAppRunner.h"><!----><span>ofAppRunner.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofBaseApp_cpp" title="/openframeworks/app/ofBaseApp.cpp"><!----><span>ofBaseApp.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofBaseApp_h" title="/openframeworks/app/ofBaseApp.h"><!----><span>ofBaseApp.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofIcon_h" title="/openframeworks/app/ofIcon.h"><!----><span>ofIcon.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofMainLoop_cpp" title="/openframeworks/app/ofMainLoop.cpp"><!----><span>ofMainLoop.cpp</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofMainLoop_h" title="/openframeworks/app/ofMainLoop.h"><!----><span>ofMainLoop.h</span></a><!----></div><div class="item"><a href="/openframeworks/app/ofWindowSettings_h" title="/openframeworks/app/ofWindowSettings.h"><!----><span>ofWindowSettings.h</span></a><!----></div></div></div><div class="item"><a href="/openframeworks/communication/" title="/openframeworks/communication/"><!----><span>communication</span></a><!----></div><div class="item"><a href="/openframeworks/events/" title="/openframeworks/events/"><!----><span>events</span></a><!----></div><div class="item"><a href="/openframeworks/gl/" title="/openframeworks/gl/"><!----><span>gl</span></a><!----></div><div class="item"><a href="/openframeworks/graphics/" title="/openframeworks/graphics/"><!----><span>graphics</span></a><!----></div><div class="item"><a href="/openframeworks/math/" title="/openframeworks/math/"><!----><span>math</span></a><!----></div><div class="item"><a href="/openframeworks/sound/" title="/openframeworks/sound/"><!----><span>sound</span></a><!----></div><div class="item"><a href="/openframeworks/types/" title="/openframeworks/types/"><!----><span>types</span></a><!----></div><div class="item"><a href="/openframeworks/utils/" title="/openframeworks/utils/"><!----><span>utils</span></a><!----></div><div class="item"><a href="/openframeworks/video/" title="/openframeworks/video/"><!----><span>video</span></a><!----></div></div></div><div class="item"><a href="/addons/" title="/addons/"><!----><span>addons</span></a><!----></div><div class="item"><a href="/guides/" title="/guides/"><!----><span>guides</span></a><!----></div></div></div></div><div id="document"><div id="renderer" class="main"><div absolute="/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/app/ofAppEGLWindow.cpp" route="/openframeworks/app/ofAppEGLWindow.cpp" dir="../libs/openFrameworks/app" ext="cpp" type="source" id="209" parent="207" siblings="" translations="[object Object]" class="doc-header"><div class="doc-header-inner"><div class="inner"><div class="mt2 mb2"><span class="breadcrumbs"><span class="crumb"><a href="/" class="pink nuxt-link-active">ofDocs</a><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/" class="pink nuxt-link-active">openframeworks </a><!----><span class="chevron right"></span></span><span class="crumb"><a href="/openframeworks/app/" class="pink nuxt-link-active">app </a><!----><span class="chevron right"></span></span><span class="crumb"><!----><span class="link">ofAppEGLWindow.cpp </span><!----></span></span></div></div></div></div><div id="code-page" class="markdown"><div id="side-menu"><!----><div id="see-also" filename="app" absolute="/Users/Gilbert/Code/openFrameworks/libs/openFrameworks/app" dir="../libs/openFrameworks" route="/openframeworks/app/" ext="" type="folder" children="208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224" parent="195" breadcrumbs="195" class="see-also"><h4>See also</h4><div class="also"><a href="/documentation/application/"><span class="origin">documentation</span><span class="name">application</span></a></div></div></div><div id="code-render" id="code-inner"><div class="inner"><pre><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofAppEGLWindow.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofGraphics.h"</span> </span><span class="token comment" spellcheck="true">// used in runAppViaInfiniteLoop()</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofAppRunner.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofUtils.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofFileUtils.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofGLProgrammableRenderer.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofGLRenderer.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ofVectorMath.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;assert.h></span></span>
<span class="token comment" spellcheck="true">// x11</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;X11/Xutil.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;EGL/egl.h></span></span>

<span class="token comment" spellcheck="true">// include includes for both native and X11 possibilities</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;libudev.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span> </span><span class="token comment" spellcheck="true">// sprintf</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span>  </span><span class="token comment" spellcheck="true">// malloc</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span>  </span><span class="token comment" spellcheck="true">// open fcntl</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span> </span><span class="token comment" spellcheck="true">// read close</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;linux/joystick.h></span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"linux/kd.h"</span>	</span><span class="token comment" spellcheck="true">// keyboard stuff...</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"termios.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sys/ioctl.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span> </span><span class="token comment" spellcheck="true">// strlen</span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// native events</span>
<span class="token keyword">struct</span> udev<span class="token operator">*</span> udev<span class="token punctuation">;</span>
<span class="token keyword">struct</span> udev_monitor<span class="token operator">*</span> mon<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> udev_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> device<span class="token punctuation">;</span>
<span class="token keyword">static</span> device inputDevices<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// minimal map</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> lowercase_map<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'1'</span><span class="token punctuation">,</span>  <span class="token string">'2'</span><span class="token punctuation">,</span>  <span class="token string">'3'</span><span class="token punctuation">,</span>  <span class="token string">'4'</span><span class="token punctuation">,</span>  <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span>  <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
		<span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'\b'</span><span class="token punctuation">,</span> <span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">,</span>  <span class="token string">'w'</span><span class="token punctuation">,</span>  <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span>  <span class="token string">'t'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span>
		<span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'['</span><span class="token punctuation">,</span>  <span class="token string">']'</span><span class="token punctuation">,</span>  <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">,</span>  <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span>
		<span class="token string">'j'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">,</span>  <span class="token string">';'</span><span class="token punctuation">,</span>  <span class="token string">'\''</span><span class="token punctuation">,</span>  <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'v'</span><span class="token punctuation">,</span>
		<span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span>  <span class="token string">','</span><span class="token punctuation">,</span>  <span class="token string">'.'</span><span class="token punctuation">,</span>  <span class="token string">'/'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'*'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'\r'</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// minimal keyboard map</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> uppercase_map<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'!'</span><span class="token punctuation">,</span>  <span class="token string">'@'</span><span class="token punctuation">,</span>  <span class="token string">'#'</span><span class="token punctuation">,</span>  <span class="token string">'$'</span><span class="token punctuation">,</span>  <span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">'^'</span><span class="token punctuation">,</span>  <span class="token string">'&'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">,</span>
		<span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'\b'</span><span class="token punctuation">,</span> <span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">,</span>  <span class="token string">'W'</span><span class="token punctuation">,</span>  <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">,</span>  <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">,</span>
		<span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">,</span> <span class="token string">'{'</span><span class="token punctuation">,</span>  <span class="token string">'}'</span><span class="token punctuation">,</span>  <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span>  <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">,</span>
		<span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">,</span>  <span class="token string">':'</span><span class="token punctuation">,</span>  <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'Z'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">,</span>
		<span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span>  <span class="token string">'&lt;'</span><span class="token punctuation">,</span>  <span class="token string">'>'</span><span class="token punctuation">,</span>  <span class="token string">'?'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'*'</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token string">'\r'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// keep track of a few things ...</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token keyword">bool</span> shiftPressed<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> capsLocked<span class="token punctuation">;</span>
<span class="token punctuation">}</span> KeyboardState<span class="token punctuation">;</span>

<span class="token keyword">static</span> KeyboardState kb<span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">struct</span> termios tc<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">struct</span> termios ots<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> mouseButtonState<span class="token punctuation">;</span>
<span class="token punctuation">}</span> MouseState<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// TODO, make this match the upcoming additions to ofWindow</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MOUSE_BUTTON_LEFT_MASK		1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MOUSE_BUTTON_MIDDLE_MASK 1 &lt;&lt; 1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MOUSE_BUTTON_RIGHT_MASK  2 &lt;&lt; 1</span>

<span class="token keyword">static</span> MouseState mb<span class="token punctuation">;</span>
ofAppEGLWindow<span class="token operator">*</span> ofAppEGLWindow<span class="token operator">::</span>instance <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">string_ends_with</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>suffix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>str <span class="token operator">||</span> <span class="token operator">!</span>suffix<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	size_t lenstr <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	size_t lensuffix <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>lensuffix <span class="token operator">></span> lenstr<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">strncmp</span><span class="token punctuation">(</span>str <span class="token operator">+</span> lenstr <span class="token operator">-</span> lensuffix<span class="token punctuation">,</span> suffix<span class="token punctuation">,</span> lensuffix<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">string_begins_with</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>str <span class="token operator">||</span> <span class="token operator">!</span>prefix<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	size_t lenstr <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	size_t lenprefix <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>lenprefix <span class="token operator">></span> lenstr<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">strncmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> lenprefix<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// native</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MOUSE_CURSOR_RUN_LENGTH_DECODE(image_buf, rle_data, size, bpp) do \
		{ unsigned int __bpp; unsigned char *__ip; const unsigned char *__il, *__rd; \
		__bpp = (bpp); __ip = (image_buf); __il = __ip + (size) * __bpp; \
		__rd = (rle_data); \
		while (__ip &lt; __il) { unsigned int __l = *(__rd++); \
		if (__l & 128) { __l = __l - 128; \
		do { memcpy (__ip, __rd, 4); __ip += 4; } while (--__l); __rd += 4; \
		} else { __l *= 4; memcpy (__ip, __rd, __l); \
		__ip += __l; __rd += __l; } } \
		} while (0)</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> width<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> height<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> bpp<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 2:RGB16, 3:RGB, 4:RGBA */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> rle_pixel_data<span class="token punctuation">[</span><span class="token number">382</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> mouse_cursor_data <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
		<span class="token string">"\1\0\0\0\377\213\377\377\377\0\202\0\0\0\377\212\377\377\377\0\3\0\0\0\377"</span>
		<span class="token string">"\377\377\377\377\0\0\0\377\211\377\377\377\0\1\0\0\0\377\202\377\377\377"</span>
		<span class="token string">"\377\1\0\0\0\377\210\377\377\377\0\1\0\0\0\377\203\377\377\377\377\1\0\0"</span>
		<span class="token string">"\0\377\207\377\377\377\0\1\0\0\0\377\204\377\377\377\377\1\0\0\0\377\206"</span>
		<span class="token string">"\377\377\377\0\1\0\0\0\377\205\377\377\377\377\1\0\0\0\377\205\377\377\377"</span>
		<span class="token string">"\0\1\0\0\0\377\206\377\377\377\377\1\0\0\0\377\204\377\377\377\0\1\0\0\0"</span>
		<span class="token string">"\377\207\377\377\377\377\1\0\0\0\377\203\377\377\377\0\1\0\0\0\377\210\377"</span>
		<span class="token string">"\377\377\377\1\0\0\0\377\202\377\377\377\0\1\0\0\0\377\211\377\377\377\377"</span>
		<span class="token string">"\3\0\0\0\377\377\377\377\0\0\0\0\377\212\377\377\377\377\202\0\0\0\377\206"</span>
		<span class="token string">"\377\377\377\377\206\0\0\0\377\203\377\377\377\377\1\0\0\0\377\202\377\377"</span>
		<span class="token string">"\377\377\1\0\0\0\377\204\377\377\377\0\1\0\0\0\377\202\377\377\377\377\3"</span>
		<span class="token string">"\0\0\0\377\377\377\377\0\0\0\0\377\202\377\377\377\377\1\0\0\0\377\203\377"</span>
		<span class="token string">"\377\377\0\3\0\0\0\377\377\377\377\377\0\0\0\377\202\377\377\377\0\1\0\0"</span>
		<span class="token string">"\0\377\202\377\377\377\377\1\0\0\0\377\203\377\377\377\0\202\0\0\0\377\204"</span>
		<span class="token string">"\377\377\377\0\1\0\0\0\377\202\377\377\377\377\1\0\0\0\377\210\377\377\377"</span>
		<span class="token string">"\0\1\0\0\0\377\202\377\377\377\377\1\0\0\0\377\211\377\377\377\0\202\0\0"</span>
		<span class="token string">"\0\377\203\377\377\377\0"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// from http://cantuna.googlecode.com/svn-history/r16/trunk/src/screen.cpp</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CASE_STR(x,y) case x: str = y; break</span>

<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>EGLint err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	string str<span class="token punctuation">;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_SUCCESS<span class="token punctuation">,</span> <span class="token string">"no error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_NOT_INITIALIZED<span class="token punctuation">,</span> <span class="token string">"EGL not, or could not be, initialized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_ACCESS<span class="token punctuation">,</span> <span class="token string">"access violation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_ALLOC<span class="token punctuation">,</span> <span class="token string">"could not allocate resources"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_ATTRIBUTE<span class="token punctuation">,</span> <span class="token string">"invalid attribute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_CONTEXT<span class="token punctuation">,</span> <span class="token string">"invalid context specified"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_CONFIG<span class="token punctuation">,</span> <span class="token string">"invald frame buffer configuration specified"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_CURRENT_SURFACE<span class="token punctuation">,</span> <span class="token string">"current window, pbuffer or pixmap surface is no longer valid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_DISPLAY<span class="token punctuation">,</span> <span class="token string">"invalid display specified"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_SURFACE<span class="token punctuation">,</span> <span class="token string">"invalid surface specified"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_MATCH<span class="token punctuation">,</span> <span class="token string">"bad argument match"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_PARAMETER<span class="token punctuation">,</span> <span class="token string">"invalid paramater"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_NATIVE_PIXMAP<span class="token punctuation">,</span> <span class="token string">"invalid NativePixmap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_BAD_NATIVE_WINDOW<span class="token punctuation">,</span> <span class="token string">"invalid NativeWindow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">CASE_STR</span><span class="token punctuation">(</span>EGL_CONTEXT_LOST<span class="token punctuation">,</span> <span class="token string">"APM event caused context loss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span> str <span class="token operator">=</span> <span class="token string">"unknown error "</span> <span class="token operator">+</span> err<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">// X11 events</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;X11/XKBlib.h></span></span>


<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI</span>
<span class="token comment" spellcheck="true">// TODO: remove these when they enter system headers</span>
<span class="token comment" spellcheck="true">// From : https://github.com/raspberrypi/userland/blob/master/interface/vmcs_host/vc_vchi_dispmanx.h</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> ELEMENT_CHANGE_LAYER</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ELEMENT_CHANGE_LAYER		  (1&lt;&lt;0)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> ELEMENT_CHANGE_OPACITY</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ELEMENT_CHANGE_OPACITY		(1&lt;&lt;1)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> ELEMENT_CHANGE_DEST_RECT</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ELEMENT_CHANGE_DEST_RECT	  (1&lt;&lt;2)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> ELEMENT_CHANGE_SRC_RECT</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ELEMENT_CHANGE_SRC_RECT	   (1&lt;&lt;3)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> ELEMENT_CHANGE_MASK_RESOURCE</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ELEMENT_CHANGE_MASK_RESOURCE  (1&lt;&lt;4)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> ELEMENT_CHANGE_TRANSFORM</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ELEMENT_CHANGE_TRANSFORM	  (1&lt;&lt;5)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>


<span class="token comment" spellcheck="true">//-------------------------------------------------------------------------------------</span>
ofAppEGLWindowSettings<span class="token operator">::</span><span class="token function">ofAppEGLWindowSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">:</span><span class="token function">ofGLESWindowSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	eglWindowPreference <span class="token operator">=</span> OF_APP_WINDOW_AUTO<span class="token punctuation">;</span>
	eglWindowOpacity <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// these are usually set as default, but set them here just to be sure</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_RED_SIZE<span class="token punctuation">]</span>	 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for red</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_GREEN_SIZE<span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for green</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_BLUE_SIZE<span class="token punctuation">]</span>	<span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for blue</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_ALPHA_SIZE<span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for alpha</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_LUMINANCE_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> EGL_DONT_CARE<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for alpha</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_DEPTH_SIZE<span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 24 bits for depth</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_STENCIL_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for stencil</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_SAMPLES<span class="token punctuation">]</span>	  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	initialClearColor <span class="token operator">=</span> <span class="token function">ofColor</span><span class="token punctuation">(</span><span class="token number">0.15</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0.15</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0.15</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	screenNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 0 = LCD on the raspberry pi */</span>
	layer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ofAppEGLWindowSettings<span class="token operator">::</span><span class="token function">ofAppEGLWindowSettings</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofGLESWindowSettings <span class="token operator">&</span> settings<span class="token punctuation">)</span>
<span class="token operator">:</span><span class="token function">ofGLESWindowSettings</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	eglWindowPreference <span class="token operator">=</span> OF_APP_WINDOW_AUTO<span class="token punctuation">;</span>
	eglWindowOpacity <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// these are usually set as default, but set them here just to be sure</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_RED_SIZE<span class="token punctuation">]</span>	 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for red</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_GREEN_SIZE<span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for green</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_BLUE_SIZE<span class="token punctuation">]</span>	<span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for blue</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_ALPHA_SIZE<span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for alpha</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_LUMINANCE_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> EGL_DONT_CARE<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for alpha</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_DEPTH_SIZE<span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 24 bits for depth</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_STENCIL_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 8 bits for stencil</span>
	frameBufferAttributes<span class="token punctuation">[</span>EGL_SAMPLES<span class="token punctuation">]</span>	  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	initialClearColor <span class="token operator">=</span> <span class="token function">ofColor</span><span class="token punctuation">(</span><span class="token number">0.15</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0.15</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0.15</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	screenNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 0 = LCD on the raspberry pi */</span>
	layer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
ofAppEGLWindow<span class="token operator">::</span><span class="token function">ofAppEGLWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	keyboardDetected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	mouseDetected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	threadTimeout <span class="token operator">=</span> ofThread<span class="token operator">::</span>INFINITE_JOIN_TIMEOUT<span class="token punctuation">;</span>
	bNewScreenMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	buttonInUse <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	bEnableSetupScreen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	bShowCursor <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	nFramesSinceWindowResized <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	mouseScaleX <span class="token operator">=</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
	mouseScaleY <span class="token operator">=</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
	isUsingX11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	isWindowInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	isSurfaceInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	x11Display <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	x11Screen <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	x11ScreenNum <span class="token operator">=</span> <span class="token number">0l</span><span class="token punctuation">;</span>
	glesVersion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"trying to create more than one instance"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
ofAppEGLWindow<span class="token operator">::</span><span class="token operator">~</span><span class="token function">ofAppEGLWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLDisplay ofAppEGLWindow<span class="token operator">::</span><span class="token function">getEglDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> eglDisplay<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLSurface ofAppEGLWindow<span class="token operator">::</span><span class="token function">getEglSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> eglSurface<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLContext ofAppEGLWindow<span class="token operator">::</span><span class="token function">getEglContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> eglContext<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">ifndef</span> TARGET_RASPBERRY_PI_LEGACY</span>
<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
Display<span class="token operator">*</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">getX11Display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> x11Display<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
Window ofAppEGLWindow<span class="token operator">::</span><span class="token function">getX11Window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> x11Window<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLConfig ofAppEGLWindow<span class="token operator">::</span><span class="token function">getEglConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> eglConfig<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLint ofAppEGLWindow<span class="token operator">::</span><span class="token function">getEglVersionMajor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> eglVersionMajor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLint ofAppEGLWindow<span class="token operator">::</span><span class="token function">getEglVersionMinor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> eglVersionMinor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">initNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
	<span class="token function">initRPiNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">exitNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
	<span class="token function">exitRPiNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLNativeWindowType ofAppEGLWindow<span class="token operator">::</span><span class="token function">getNativeWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isWindowInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getNativeDisplay(): window not initialized, returning NULL"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>EGLNativeWindowType<span class="token punctuation">)</span>x11Window<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>EGLNativeWindowType<span class="token punctuation">)</span><span class="token operator">&</span>dispman_native_window<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getNativeWindow(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
EGLNativeDisplayType ofAppEGLWindow<span class="token operator">::</span><span class="token function">getNativeDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isWindowInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getNativeDisplay(): window not initialized, returning NULL"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>EGLNativeDisplayType<span class="token punctuation">)</span>x11Display<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>EGLNativeDisplayType<span class="token punctuation">)</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getNativeDisplay(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofGLESWindowSettings <span class="token operator">&</span> settings<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> Settings <span class="token operator">*</span> glSettings <span class="token operator">=</span> <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span><span class="token keyword">const</span> Settings<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>glSettings<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">setup</span><span class="token punctuation">(</span><span class="token operator">*</span>glSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token function">setup</span><span class="token punctuation">(</span><span class="token function">Settings</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofAppEGLWindowSettings <span class="token operator">&</span> _settings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	settings <span class="token operator">=</span> _settings<span class="token punctuation">;</span>
	windowMode <span class="token operator">=</span> OF_WINDOW<span class="token punctuation">;</span>
	bNewScreenMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	nFramesSinceWindowResized <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	buttonInUse	<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	bEnableSetupScreen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	eglDisplayString <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
	orientation <span class="token operator">=</span> OF_ORIENTATION_DEFAULT<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//TODO: 2.0f is an arbitrary factor that makes mouse speed ok at 1024x768,</span>
	<span class="token comment" spellcheck="true">// to be totally correct we might need to take into account screen size</span>
	<span class="token comment" spellcheck="true">// and add acceleration</span>
	mouseScaleX <span class="token operator">=</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
	mouseScaleY <span class="token operator">=</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>

	isUsingX11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	isWindowInited  <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	isSurfaceInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	eglDisplay <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	eglSurface <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	eglContext <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	eglConfig  <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	eglVersionMajor <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	eglVersionMinor <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	glesVersion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// X11 check</span>
	<span class="token comment" spellcheck="true">// char * pDisplay;</span>
	<span class="token comment" spellcheck="true">// pDisplay = getenv ("DISPLAY");</span>
	<span class="token comment" spellcheck="true">// bool bIsX11Available = (pDisplay != NULL);</span>

	<span class="token keyword">bool</span> bIsX11Available <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"DISPLAY"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>eglWindowPreference <span class="token operator">==</span> OF_APP_WINDOW_AUTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>bIsX11Available<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			isUsingX11 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			isUsingX11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>eglWindowPreference <span class="token operator">==</span> OF_APP_WINDOW_NATIVE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		isUsingX11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>eglWindowPreference <span class="token operator">==</span> OF_APP_WINDOW_X11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		isUsingX11 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>bIsX11Available<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			isUsingX11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"init(): X11 window requested, but X11 is not available"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">////////////////</span>
	<span class="token comment" spellcheck="true">// TODO remove the following ifdef once x11 is accelerated on RPI</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		isUsingX11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"init(): X11 not availble on RPI yet, using a native window instead"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token comment" spellcheck="true">////////////////</span>

	<span class="token function">initNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	glesVersion <span class="token operator">=</span> settings<span class="token punctuation">.</span>glesVersion<span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">// we set this here, and if we need to make a fullscreen</span>
	<span class="token comment" spellcheck="true">// app, we do it during the first loop.</span>
	windowMode <span class="token operator">=</span> settings<span class="token punctuation">.</span>windowMode<span class="token punctuation">;</span>
	bShowCursor <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	nonFullscreenWindowRect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>settings<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>settings<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	nonFullscreenWindowRect<span class="token punctuation">.</span><span class="token function">standardize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	ofRectangle startRect <span class="token operator">=</span> nonFullscreenWindowRect<span class="token punctuation">;</span>
	bNewScreenMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>windowMode <span class="token operator">==</span> OF_GAME_MODE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogWarning</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupOpenGL(): OF_GAME_MODE not supported, using OF_WINDOW"</span><span class="token punctuation">;</span>
		startRect <span class="token operator">=</span> nonFullscreenWindowRect<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>windowMode <span class="token operator">==</span> OF_FULLSCREEN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		startRect <span class="token operator">=</span> <span class="token function">getScreenRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	isWindowInited <span class="token operator">=</span> <span class="token function">createWindow</span><span class="token punctuation">(</span>startRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
	isSurfaceInited <span class="token operator">=</span> <span class="token function">createSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isWindowInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span>  <span class="token operator">&lt;&lt;</span> <span class="token string">"setupOpenGL(): screen creation failed, window not inited"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">setupPeripherals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	nFramesSinceWindowResized <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>glesVersion<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		currentRenderer <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>ofGLProgrammableRenderer<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		currentRenderer <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>ofGLRenderer<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">makeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>ofGLProgrammableRenderer<span class="token operator">::</span>TYPE<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">static_cast</span><span class="token operator">&lt;</span>ofGLProgrammableRenderer<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>currentRenderer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setup</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>glesVersion<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token keyword">static_cast</span><span class="token operator">&lt;</span>ofGLRenderer<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>currentRenderer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setupPeripherals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// roll our own cursor!</span>
		mouseCursor<span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>mouse_cursor_data<span class="token punctuation">.</span>width<span class="token punctuation">,</span>mouse_cursor_data<span class="token punctuation">.</span>height<span class="token punctuation">,</span>OF_IMAGE_COLOR_ALPHA<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">MOUSE_CURSOR_RUN_LENGTH_DECODE</span><span class="token punctuation">(</span>mouseCursor<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>mouse_cursor_data<span class="token punctuation">.</span>rle_pixel_data<span class="token punctuation">,</span>mouse_cursor_data<span class="token punctuation">.</span>width<span class="token operator">*</span>mouse_cursor_data<span class="token punctuation">.</span>height<span class="token punctuation">,</span>mouse_cursor_data<span class="token punctuation">.</span>bpp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mouseCursor<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupPeripherals(): peripheral setup complete"</span><span class="token punctuation">;</span>
		<span class="token function">setupNativeEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupPeripherals(): native event setup complete"</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupPeripherals(): peripherals not supported on X11"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">createSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	EGLNativeWindowType nativeWindow <span class="token operator">=</span> <span class="token function">getNativeWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	EGLNativeDisplayType display <span class="token operator">=</span> <span class="token function">getNativeDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): setting up EGL Display"</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">// get an EGL eglDisplay connection</span>

	isSurfaceInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	EGLint result<span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>display<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		eglDisplay <span class="token operator">=</span> <span class="token function">eglGetDisplay</span><span class="token punctuation">(</span>EGL_DEFAULT_DISPLAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		eglDisplay <span class="token operator">=</span> <span class="token function">eglGetDisplay</span><span class="token punctuation">(</span>display<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>eglDisplay <span class="token operator">==</span> EGL_NO_DISPLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): eglGetDisplay returned: "</span> <span class="token operator">&lt;&lt;</span> eglDisplay<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): EGL Display correctly set "</span> <span class="token operator">&lt;&lt;</span> eglDisplay<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// initialize the EGL eglDisplay connection</span>
	result <span class="token operator">=</span> <span class="token function">eglInitialize</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span>
			<span class="token operator">&</span>eglVersionMajor<span class="token punctuation">,</span>
			<span class="token operator">&</span>eglVersionMinor<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> EGL_BAD_DISPLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">//  eglDisplay is not an EGL connection</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): eglInitialize returned EGL_BAD_DISPLAY"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> EGL_NOT_INITIALIZED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// eglDisplay cannot be intitialized</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): eglInitialize returned EGL_NOT_INITIALIZED"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> EGL_FALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// eglinitialize was not initialiezd</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): eglInitialize returned EGL_FALSE"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// result == EGL_TRUE</span>
		<span class="token comment" spellcheck="true">// success!</span>
	<span class="token punctuation">}</span>

	EGLint glesVersion<span class="token punctuation">;</span>
	<span class="token keyword">int</span> glesVersionForContext<span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ofGetCurrentRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): current renderer type: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">ofGetCurrentRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): no current renderer selected"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>glesVersion<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		glesVersion <span class="token operator">=</span> EGL_OPENGL_ES2_BIT<span class="token punctuation">;</span>
		glesVersionForContext <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): GLES2 renderer detected"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		glesVersion <span class="token operator">=</span> EGL_OPENGL_ES_BIT<span class="token punctuation">;</span>
		glesVersionForContext <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): default renderer detected"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	ofEGLAttributeListIterator iter<span class="token punctuation">,</span> iterEnd<span class="token punctuation">;</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// each attribute has 2 values, and we need one extra for the EGL_NONE terminator</span>
	EGLint attribute_list_framebuffer_config<span class="token punctuation">[</span>settings<span class="token punctuation">.</span>frameBufferAttributes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	iter <span class="token operator">=</span> settings<span class="token punctuation">.</span>frameBufferAttributes<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	iterEnd <span class="token operator">=</span> settings<span class="token punctuation">.</span>frameBufferAttributes<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> iterEnd<span class="token punctuation">;</span> iter<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		attribute_list_framebuffer_config<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> iter<span class="token operator">-</span><span class="token operator">></span>first<span class="token punctuation">;</span>
		attribute_list_framebuffer_config<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> iter<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	attribute_list_framebuffer_config<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> EGL_RENDERABLE_TYPE<span class="token punctuation">;</span>
	attribute_list_framebuffer_config<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> glesVersion<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//openGL ES version</span>
	attribute_list_framebuffer_config<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> EGL_NONE<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// add the terminator</span>

	EGLint num_configs<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// get an appropriate EGL frame buffer configuration</span>
	<span class="token comment" spellcheck="true">// http://www.khronos.org/registry/egl/sdk/docs/man/xhtml/eglChooseConfig.html</span>
	result <span class="token operator">=</span> <span class="token function">eglChooseConfig</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span>
			attribute_list_framebuffer_config<span class="token punctuation">,</span>
			<span class="token operator">&</span>eglConfig<span class="token punctuation">,</span>
			<span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// we only want the first one.  if we want more,</span>
			<span class="token comment" spellcheck="true">// we need to pass in an array.</span>
			<span class="token comment" spellcheck="true">// we are optimistic and don't give it more chances</span>
			<span class="token comment" spellcheck="true">// to find a good configuration</span>
			<span class="token operator">&</span>num_configs<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> EGL_FALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		EGLint error <span class="token operator">=</span> <span class="token function">eglGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error finding valid configuration based on settings: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>num_configs <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> eglConfig <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): no matching configs were found, num_configs: "</span> <span class="token operator">&lt;&lt;</span> num_configs<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment" spellcheck="true">// each attribute has 2 values, and we need one extra for the EGL_NONE terminator</span>
	EGLint attribute_list_window_surface<span class="token punctuation">[</span>settings<span class="token punctuation">.</span>windowSurfaceAttributes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	iter <span class="token operator">=</span> settings<span class="token punctuation">.</span>windowSurfaceAttributes<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	iterEnd <span class="token operator">=</span> settings<span class="token punctuation">.</span>windowSurfaceAttributes<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> iterEnd<span class="token punctuation">;</span> iter<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		attribute_list_window_surface<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> iter<span class="token operator">-</span><span class="token operator">></span>first<span class="token punctuation">;</span>
		attribute_list_window_surface<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> iter<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	attribute_list_window_surface<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> EGL_NONE<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// add the terminator</span>

	<span class="token comment" spellcheck="true">// create a surface</span>
	eglSurface <span class="token operator">=</span> <span class="token function">eglCreateWindowSurface</span><span class="token punctuation">(</span> eglDisplay<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// our display handle</span>
			eglConfig<span class="token punctuation">,</span>	<span class="token comment" spellcheck="true">// our first config</span>
			nativeWindow<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// our native window</span>
			attribute_list_window_surface<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// surface attribute list</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>eglSurface <span class="token operator">==</span> EGL_NO_SURFACE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		EGLint error <span class="token operator">=</span> <span class="token function">eglGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">switch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> EGL_BAD_MATCH<span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error creating surface: EGL_BAD_MATCH "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): check window and EGLConfig attributes to determine compatibility, "</span><span class="token punctuation">;</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): or verify that the EGLConfig supports rendering to a window"</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> EGL_BAD_CONFIG<span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error creating surface: EGL_BAD_CONFIG "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): verify that provided EGLConfig is valid"</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> EGL_BAD_NATIVE_WINDOW<span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error creating surface: EGL_BAD_NATIVE_WINDOW "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): verify that provided EGLNativeWindow is valid"</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> EGL_BAD_ALLOC<span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error creating surface: EGL_BAD_ALLOC "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): not enough resources available"</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error creating surface: &lt;&lt; "</span> <span class="token operator">&lt;&lt;</span> error <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): surface created correctly"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// get an appropriate EGL frame buffer configuration</span>
	result <span class="token operator">=</span> <span class="token function">eglBindAPI</span><span class="token punctuation">(</span>EGL_OPENGL_ES_API<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> EGL_FALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error binding API: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span><span class="token function">eglGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): API bound correctly"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// create an EGL rendering eglContext</span>
	EGLint attribute_list_surface_context<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
			EGL_CONTEXT_CLIENT_VERSION<span class="token punctuation">,</span> glesVersionForContext<span class="token punctuation">,</span>
			EGL_NONE
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	eglContext <span class="token operator">=</span> <span class="token function">eglCreateContext</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span>
			eglConfig<span class="token punctuation">,</span>
			EGL_NO_CONTEXT<span class="token punctuation">,</span>
			attribute_list_surface_context<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>eglContext <span class="token operator">==</span> EGL_NO_CONTEXT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		EGLint error <span class="token operator">=</span> <span class="token function">eglGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>error <span class="token operator">==</span> EGL_BAD_CONFIG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error creating context: EGL_BAD_CONFIG "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): error creating context: "</span> <span class="token operator">&lt;&lt;</span> error <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// connect the eglContext to the eglSurface</span>
	result <span class="token operator">=</span> <span class="token function">eglMakeCurrent</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span>
			eglSurface<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// draw surface</span>
			eglSurface<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// read surface</span>
			eglContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>eglContext <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		EGLint error <span class="token operator">=</span> <span class="token function">eglGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): couldn't making current surface: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// Set background color and clear buffers</span>
	<span class="token function">glClearColor</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>initialClearColor<span class="token punctuation">.</span>r <span class="token operator">/</span> <span class="token number">255.0f</span><span class="token punctuation">,</span>
			settings<span class="token punctuation">.</span>initialClearColor<span class="token punctuation">.</span>g <span class="token operator">/</span> <span class="token number">255.0f</span><span class="token punctuation">,</span>
			settings<span class="token punctuation">.</span>initialClearColor<span class="token punctuation">.</span>b <span class="token operator">/</span> <span class="token number">255.0f</span><span class="token punctuation">,</span>
			settings<span class="token punctuation">.</span>initialClearColor<span class="token punctuation">.</span>a <span class="token operator">/</span> <span class="token number">255.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glClear</span><span class="token punctuation">(</span> GL_COLOR_BUFFER_BIT <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glClear</span><span class="token punctuation">(</span> GL_DEPTH_BUFFER_BIT <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): -----EGL-----"</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): EGL_VERSION_MAJOR = "</span> <span class="token operator">&lt;&lt;</span> eglVersionMajor<span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): EGL_VERSION_MINOR = "</span> <span class="token operator">&lt;&lt;</span> eglVersionMinor<span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): EGL_CLIENT_APIS = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglQueryString</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> EGL_CLIENT_APIS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): EGL_VENDOR = "</span>  <span class="token operator">&lt;&lt;</span> <span class="token function">eglQueryString</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> EGL_VENDOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): EGL_VERSION = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglQueryString</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> EGL_VERSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): EGL_EXTENSIONS = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglQueryString</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> EGL_EXTENSIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): GL_RENDERER = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">glGetString</span><span class="token punctuation">(</span>GL_RENDERER<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): GL_VERSION  = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">glGetString</span><span class="token punctuation">(</span>GL_VERSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): GL_VENDOR   = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">glGetString</span><span class="token punctuation">(</span>GL_VENDOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createSurface(): -------------"</span><span class="token punctuation">;</span>

	isSurfaceInited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">destroySurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>isSurfaceInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"destroySurface(): destroying EGL surface"</span><span class="token punctuation">;</span>
		<span class="token function">eglSwapBuffers</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> eglSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">eglMakeCurrent</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> EGL_NO_SURFACE<span class="token punctuation">,</span> EGL_NO_SURFACE<span class="token punctuation">,</span> EGL_NO_CONTEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">eglDestroySurface</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> eglSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">eglDestroyContext</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> eglContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">eglTerminate</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">)</span><span class="token punctuation">;</span>
		isSurfaceInited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

		eglDisplay <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		eglSurface <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		eglContext <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		eglConfig  <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		eglVersionMinor <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		eglVersionMinor <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"destroySurface(): attempted to destroy uninitialized window"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">destroyWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>isWindowInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment" spellcheck="true">// TODO: double check</span>
			<span class="token function">XDestroyWindow</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span>x11Window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// or XCloseWindow?</span>
			<span class="token function">XFree</span><span class="token punctuation">(</span>x11Screen<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
			dispman_update <span class="token operator">=</span> <span class="token function">vc_dispmanx_update_start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>dispman_element <span class="token operator">!=</span> DISPMANX_NO_HANDLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">vc_dispmanx_element_remove</span><span class="token punctuation">(</span>dispman_update<span class="token punctuation">,</span> dispman_element<span class="token punctuation">)</span><span class="token punctuation">;</span>
				dispman_element <span class="token operator">=</span> DISPMANX_NO_HANDLE<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token function">vc_dispmanx_update_submit_sync</span><span class="token punctuation">(</span>dispman_update<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>dispman_display <span class="token operator">!=</span> DISPMANX_NO_HANDLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">vc_dispmanx_display_close</span><span class="token punctuation">(</span>dispman_display<span class="token punctuation">)</span><span class="token punctuation">;</span>
				dispman_display <span class="token operator">=</span> DISPMANX_NO_HANDLE<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"destroyWindow(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"destroyWindow(): destroying (uninited) native window (not implemented yet)"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">destroyNativeEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// we got a terminate ... so clean up.</span>
	<span class="token function">destroySurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">destroyWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">exitNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notifyExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">makeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">eglMakeCurrent</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span>
			eglSurface<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// draw surface</span>
			eglSurface<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// read surface</span>
			eglContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">swapBuffers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	EGLBoolean success <span class="token operator">=</span> <span class="token function">eglSwapBuffers</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> eglSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		GLint error <span class="token operator">=</span> <span class="token function">eglGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"display(): eglSwapBuffers failed: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">startRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//--------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">finishRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">finishRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	coreEvents<span class="token punctuation">.</span><span class="token function">notifyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">// take care of any requests for a new screen mode</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>windowMode <span class="token operator">!=</span> OF_GAME_MODE <span class="token operator">&&</span> bNewScreenMode<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> windowMode <span class="token operator">==</span> OF_FULLSCREEN<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">setWindowRect</span><span class="token punctuation">(</span><span class="token function">getScreenRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> windowMode <span class="token operator">==</span> OF_WINDOW <span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">setWindowRect</span><span class="token punctuation">(</span>nonFullscreenWindowRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		bNewScreenMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">startRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> bEnableSetupScreen <span class="token punctuation">)</span> currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">setupScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	coreEvents<span class="token punctuation">.</span><span class="token function">notifyDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>bShowCursor<span class="token punctuation">)</span><span class="token punctuation">{</span>
			GLboolean bIsDepthTestEnabled <span class="token operator">=</span> GL_FALSE<span class="token punctuation">;</span>
			<span class="token function">glGetBooleanv</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">,</span> <span class="token operator">&</span>bIsDepthTestEnabled<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span><span class="token punctuation">(</span>bIsDepthTestEnabled <span class="token operator">==</span> GL_TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">glDisable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">bool</span> isUsingNormalizedTexCoords <span class="token operator">=</span> <span class="token function">ofGetUsingNormalizedTexCoords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingNormalizedTexCoords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofDisableNormalizedTexCoords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">pushStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">setBlendMode</span><span class="token punctuation">(</span>OF_BLENDMODE_ADD<span class="token punctuation">)</span><span class="token punctuation">;</span>
			currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mouseCursor<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token function">ofGetMouseX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">ofGetMouseY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">popStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span><span class="token punctuation">(</span>bIsDepthTestEnabled <span class="token operator">==</span> GL_TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingNormalizedTexCoords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofEnableNormalizedTexCoords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	currentRenderer<span class="token operator">-</span><span class="token operator">></span><span class="token function">finishRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	EGLBoolean success <span class="token operator">=</span> <span class="token function">eglSwapBuffers</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> eglSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		GLint error <span class="token operator">=</span> <span class="token function">eglGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"display(): eglSwapBuffers failed: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">eglErrorString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	nFramesSinceWindowResized<span class="token operator">++</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
ofCoreEvents <span class="token operator">&</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> coreEvents<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
shared_ptr<span class="token operator">&lt;</span>ofBaseRenderer<span class="token operator">></span> <span class="token operator">&</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> currentRenderer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setupNativeEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setupNativeUDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setupNativeInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">startThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">destroyNativeEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">destroyNativeUDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">destroyNativeInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">waitForThread</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> threadTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setWindowRect</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofRectangle<span class="token operator">&</span> requestedWindowRect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isWindowInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowRect(): window not inited"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	ofRectangle newRect <span class="token operator">=</span> requestedWindowRect<span class="token punctuation">.</span><span class="token function">getStandardized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>newRect <span class="token operator">!=</span> currentWindowRect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ofRectangle oldWindowRect <span class="token operator">=</span> currentWindowRect<span class="token punctuation">;</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">XMoveResizeWindow</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span>
					x11Window<span class="token punctuation">,</span>
					<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
					<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
					<span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
					<span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> BadValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowRect(): XMoveResizeWindow returned BadValue"</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> BadWindow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowRect(): XMoveResizeWindow returned BadWindow"</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment" spellcheck="true">// all is good</span>
				currentWindowRect <span class="token operator">=</span> newRect<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>

			VC_RECT_T dst_rect<span class="token punctuation">;</span>
			dst_rect<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			dst_rect<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
			dst_rect<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			dst_rect<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

			VC_RECT_T src_rect<span class="token punctuation">;</span>
			src_rect<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			src_rect<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			src_rect<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>width <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span>
			src_rect<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>height <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span>

			DISPMANX_UPDATE_HANDLE_T dispman_update <span class="token operator">=</span> <span class="token function">vc_dispmanx_update_start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">vc_dispmanx_element_change_attributes</span><span class="token punctuation">(</span>dispman_update<span class="token punctuation">,</span>
					dispman_element<span class="token punctuation">,</span>
					ELEMENT_CHANGE_SRC_RECT<span class="token operator">|</span>ELEMENT_CHANGE_DEST_RECT<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// we do both when resizing</span>
					<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// layer (we aren't changing it here)</span>
					<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// opactiy (we aren't changing it here)</span>
					<span class="token operator">&</span>dst_rect<span class="token punctuation">,</span>
					<span class="token operator">&</span>src_rect<span class="token punctuation">,</span>
					<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// mask (we aren't changing it here)</span>
					<span class="token punctuation">(</span>DISPMANX_TRANSFORM_T<span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


			<span class="token function">vc_dispmanx_update_submit_sync</span><span class="token punctuation">(</span>dispman_update<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment" spellcheck="true">// next time swapBuffers is called, it will be resized based on this eglwindow size data</span>
			dispman_native_window<span class="token punctuation">.</span>element <span class="token operator">=</span> dispman_element<span class="token punctuation">;</span>
			dispman_native_window<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			dispman_native_window<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>newRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// don't forget!</span>

			currentWindowRect <span class="token operator">=</span> newRect<span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">else</span></span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createEGLWindow(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>oldWindowRect<span class="token punctuation">.</span>width  <span class="token operator">!=</span> currentWindowRect<span class="token punctuation">.</span>width <span class="token operator">||</span> oldWindowRect<span class="token punctuation">.</span>height <span class="token operator">!=</span> currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			coreEvents<span class="token punctuation">.</span><span class="token function">notifyWindowResized</span><span class="token punctuation">(</span>currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">,</span>	currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			nFramesSinceWindowResized <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofRectangle<span class="token operator">&</span> requestedWindowRect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">createX11NativeWindow</span><span class="token punctuation">(</span>requestedWindowRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
		<span class="token keyword">return</span> <span class="token function">createRPiNativeWindow</span><span class="token punctuation">(</span>requestedWindowRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"createEGLWindow(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">int</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">getWindowWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">int</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">getWindowHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">pollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token operator">-</span><span class="token operator">></span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			XEvent event<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">::</span><span class="token function">XCheckWindowEvent</span><span class="token punctuation">(</span>instance<span class="token operator">-</span><span class="token operator">></span>x11Display<span class="token punctuation">,</span> instance<span class="token operator">-</span><span class="token operator">></span>x11Window<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">handleX11Event</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">::</span><span class="token function">XCheckTypedEvent</span><span class="token punctuation">(</span>instance<span class="token operator">-</span><span class="token operator">></span>x11Display<span class="token punctuation">,</span> ClientMessage<span class="token punctuation">,</span> <span class="token operator">&</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">handleX11Event</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		queue<span class="token operator">&lt;</span>ofMouseEventArgs<span class="token operator">></span> mouseEventsCopy<span class="token punctuation">;</span>
		instance<span class="token operator">-</span><span class="token operator">></span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mouseEventsCopy <span class="token operator">=</span> instance<span class="token operator">-</span><span class="token operator">></span>mouseEvents<span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token operator">-</span><span class="token operator">></span>mouseEvents<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			instance<span class="token operator">-</span><span class="token operator">></span>mouseEvents<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		instance<span class="token operator">-</span><span class="token operator">></span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>mouseEventsCopy<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			instance<span class="token operator">-</span><span class="token operator">></span>coreEvents<span class="token punctuation">.</span><span class="token function">notifyMouseEvent</span><span class="token punctuation">(</span>mouseEventsCopy<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mouseEventsCopy<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment" spellcheck="true">// KEYBOARD EVENTS</span>
		queue<span class="token operator">&lt;</span>ofKeyEventArgs<span class="token operator">></span> keyEventsCopy<span class="token punctuation">;</span>
		instance<span class="token operator">-</span><span class="token operator">></span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		keyEventsCopy <span class="token operator">=</span> instance<span class="token operator">-</span><span class="token operator">></span>keyEvents<span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token operator">-</span><span class="token operator">></span>keyEvents<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			instance<span class="token operator">-</span><span class="token operator">></span>keyEvents<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		instance<span class="token operator">-</span><span class="token operator">></span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>keyEventsCopy<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			instance<span class="token operator">-</span><span class="token operator">></span>coreEvents<span class="token punctuation">.</span><span class="token function">notifyKeyEvent</span><span class="token punctuation">(</span>keyEventsCopy<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			keyEventsCopy<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">hideCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	bShowCursor <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">showCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	bShowCursor <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span>string title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowTitle(): not implemented"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
glm<span class="token operator">::</span>vec2 ofAppEGLWindow<span class="token operator">::</span><span class="token function">getWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">,</span> currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
glm<span class="token operator">::</span>vec2 ofAppEGLWindow<span class="token operator">::</span><span class="token function">getWindowPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> glm<span class="token operator">::</span><span class="token function">vec2</span><span class="token punctuation">(</span>currentWindowRect<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
glm<span class="token operator">::</span>vec2 ofAppEGLWindow<span class="token operator">::</span><span class="token function">getScreenSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> screenWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> screenHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// TODO, there must be a way to get screensize if the window is not inited</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>isWindowInited <span class="token operator">&&</span> x11Screen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			screenWidth  <span class="token operator">=</span> <span class="token function">XWidthOfScreen</span><span class="token punctuation">(</span>x11Screen<span class="token punctuation">)</span><span class="token punctuation">;</span>
			screenHeight <span class="token operator">=</span> <span class="token function">XHeightOfScreen</span><span class="token punctuation">(</span>x11Screen<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getScreenSize(): tried to get display size but failed, x11Screen is not inited"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
		<span class="token keyword">int</span> success <span class="token operator">=</span> <span class="token function">graphics_get_display_size</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>screenNum<span class="token punctuation">,</span> <span class="token operator">&</span>screenWidth<span class="token punctuation">,</span> <span class="token operator">&</span>screenHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>success <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getScreenSize(): tried to get display size but failed"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">else</span></span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"getScreenSize(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token punctuation">{</span>screenWidth<span class="token punctuation">,</span> screenHeight<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">int</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> orientation <span class="token operator">==</span> OF_ORIENTATION_DEFAULT <span class="token operator">||</span> orientation <span class="token operator">==</span> OF_ORIENTATION_180 <span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">int</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> orientation <span class="token operator">==</span> OF_ORIENTATION_DEFAULT <span class="token operator">||</span> orientation <span class="token operator">==</span> OF_ORIENTATION_180 <span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setOrientation</span><span class="token punctuation">(</span>ofOrientation orientationIn<span class="token punctuation">)</span><span class="token punctuation">{</span>
	orientation <span class="token operator">=</span> orientationIn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
ofOrientation ofAppEGLWindow<span class="token operator">::</span><span class="token function">getOrientation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> orientation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">doesHWOrientation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setWindowPosition</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isWindowInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): window not inited"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">XMoveWindow</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span>
				x11Window<span class="token punctuation">,</span>
				x<span class="token punctuation">,</span>
				y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> BadValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): XMoveWindow returned BadValue"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> BadWindow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): XMoveWindow returned BadWindow"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			currentWindowRect<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
			currentWindowRect<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
			nonFullscreenWindowRect <span class="token operator">=</span> currentWindowRect<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>

		<span class="token comment" spellcheck="true">// keep it in bounds</span>
		<span class="token keyword">auto</span> screenSize <span class="token operator">=</span> <span class="token function">getScreenSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		x <span class="token operator">=</span> <span class="token function">ofClamp</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> screenSize<span class="token punctuation">.</span>x <span class="token operator">-</span> currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
		y <span class="token operator">=</span> <span class="token function">ofClamp</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> screenSize<span class="token punctuation">.</span>y <span class="token operator">-</span> currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

		VC_RECT_T dst_rect<span class="token punctuation">;</span>
		dst_rect<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>x<span class="token punctuation">;</span>
		dst_rect<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>y<span class="token punctuation">;</span>
		dst_rect<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
		dst_rect<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

		dispman_update <span class="token operator">=</span> <span class="token function">vc_dispmanx_update_start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">vc_dispmanx_element_change_attributes</span><span class="token punctuation">(</span>dispman_update<span class="token punctuation">,</span>
				dispman_native_window<span class="token punctuation">.</span>element<span class="token punctuation">,</span>
				ELEMENT_CHANGE_DEST_RECT<span class="token punctuation">,</span>
				<span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token operator">&</span>dst_rect<span class="token punctuation">,</span>
				<span class="token constant">NULL</span><span class="token punctuation">,</span>
				<span class="token number">0</span><span class="token punctuation">,</span>
				<span class="token punctuation">(</span>DISPMANX_TRANSFORM_T<span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">vc_dispmanx_update_submit_sync</span><span class="token punctuation">(</span>dispman_update<span class="token punctuation">)</span><span class="token punctuation">;</span>

currentWindowRect<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
currentWindowRect<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
nonFullscreenWindowRect <span class="token operator">=</span> currentWindowRect<span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">else</span></span>
	<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setWindowShape</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isWindowInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): window not inited"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>isUsingX11<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">XResizeWindow</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span>
				x11Window<span class="token punctuation">,</span>
				<span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>w<span class="token punctuation">,</span>
				<span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> BadValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): XMoveWindow returned BadValue"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> BadWindow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): XMoveWindow returned BadWindow"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			currentWindowRect<span class="token punctuation">.</span>width <span class="token operator">=</span> w<span class="token punctuation">;</span>
			currentWindowRect<span class="token punctuation">.</span>height <span class="token operator">=</span> h<span class="token punctuation">;</span>
			nonFullscreenWindowRect <span class="token operator">=</span> currentWindowRect<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
		<span class="token function">setWindowRect</span><span class="token punctuation">(</span><span class="token function">ofRectangle</span><span class="token punctuation">(</span>currentWindowRect<span class="token punctuation">.</span>x<span class="token punctuation">,</span>currentWindowRect<span class="token punctuation">.</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		nonFullscreenWindowRect <span class="token operator">=</span> currentWindowRect<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setWindowPosition(): no native window type for this system, perhaps try X11?"</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
ofWindowMode ofAppEGLWindow<span class="token operator">::</span><span class="token function">getWindowMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> windowMode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">toggleFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> windowMode <span class="token operator">==</span> OF_GAME_MODE<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span> windowMode <span class="token operator">==</span> OF_WINDOW <span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">setFullscreen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token function">setFullscreen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setFullscreen</span><span class="token punctuation">(</span><span class="token keyword">bool</span> fullscreen<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span> windowMode <span class="token operator">==</span> OF_GAME_MODE<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>fullscreen <span class="token operator">&&</span> windowMode <span class="token operator">!=</span> OF_FULLSCREEN<span class="token punctuation">)</span><span class="token punctuation">{</span>
		bNewScreenMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		windowMode <span class="token operator">=</span> OF_FULLSCREEN<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fullscreen <span class="token operator">&&</span> windowMode <span class="token operator">!=</span> OF_WINDOW<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		bNewScreenMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		windowMode <span class="token operator">=</span> OF_WINDOW<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">enableSetupScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	bEnableSetupScreen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">disableSetupScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	bEnableSetupScreen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
ofRectangle ofAppEGLWindow<span class="token operator">::</span><span class="token function">getScreenRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">auto</span> screenSize <span class="token operator">=</span> <span class="token function">getScreenSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">ofRectangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>screenSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span>screenSize<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setVerticalSync</span><span class="token punctuation">(</span><span class="token keyword">bool</span> enabled<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">eglSwapInterval</span><span class="token punctuation">(</span>eglDisplay<span class="token punctuation">,</span> enabled <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">threadedFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">// TODO: a way to setup mouse and keyboard if</span>
	<span class="token comment" spellcheck="true">// they are not plugged in upon start</span>
	<span class="token comment" spellcheck="true">// This can be done with our udev device callbacks</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isThreadRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">readNativeUDevEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">readNativeInputEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// sleep briefly</span>
		<span class="token function">ofSleepMillis</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// PLATFORM SPECIFIC RPI</span>
<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setupNativeUDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	udev <span class="token operator">=</span> <span class="token function">udev_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// create new udev object</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>udev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupNativeUDev(): couldn't create udev object"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupNativeUDev(): created udev object"</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// setup udev to monitor for input devices</span>
		mon <span class="token operator">=</span> <span class="token function">udev_monitor_new_from_netlink</span><span class="token punctuation">(</span>udev<span class="token punctuation">,</span> <span class="token string">"udev"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// just listen for input devices</span>
		<span class="token function">udev_monitor_filter_add_match_subsystem_devtype</span><span class="token punctuation">(</span>mon<span class="token punctuation">,</span> <span class="token string">"input"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">udev_monitor_enable_receiving</span><span class="token punctuation">(</span>mon<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment" spellcheck="true">// get the file descriptor for the mon (used w/ select);</span>
		udev_fd <span class="token operator">=</span> <span class="token function">udev_monitor_get_fd</span><span class="token punctuation">(</span>mon<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>udev_fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupNativeUDev(): did not create udev object, udev_fd &lt; 0"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">destroyNativeUDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">udev_unref</span><span class="token punctuation">(</span>udev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// clean up</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">setupNativeInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">struct</span> udev_enumerate <span class="token operator">*</span>enumerate<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> udev_list_entry <span class="token operator">*</span>devices<span class="token punctuation">,</span> <span class="token operator">*</span>entry<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> udev_device <span class="token operator">*</span>dev<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> isMouse<span class="token punctuation">;</span>

	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupNativeInput()"</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">/* Create a list of the devices in the 'input' subsystem. */</span>
	enumerate <span class="token operator">=</span> <span class="token function">udev_enumerate_new</span><span class="token punctuation">(</span>udev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">udev_enumerate_add_match_subsystem</span><span class="token punctuation">(</span>enumerate<span class="token punctuation">,</span> <span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">udev_enumerate_scan_devices</span><span class="token punctuation">(</span>enumerate<span class="token punctuation">)</span><span class="token punctuation">;</span>

	devices <span class="token operator">=</span> <span class="token function">udev_enumerate_get_list_entry</span><span class="token punctuation">(</span>enumerate<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">udev_list_entry_foreach</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> devices<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">/* Get the filename of the /sys entry for the device
			and create a udev_device object (dev) representing it */</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> name <span class="token operator">=</span> <span class="token function">udev_list_entry_get_name</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>

		dev <span class="token operator">=</span> <span class="token function">udev_device_new_from_syspath</span><span class="token punctuation">(</span>udev<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> sysname <span class="token operator">=</span> <span class="token function">udev_device_get_sysname</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> devnode <span class="token operator">=</span> <span class="token function">udev_device_get_devnode</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> devpath <span class="token operator">=</span> <span class="token function">udev_device_get_devpath</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> devtype <span class="token operator">=</span> <span class="token function">udev_device_get_devtype</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dev_t devnum <span class="token operator">=</span> <span class="token function">udev_device_get_devnum</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> driver <span class="token operator">=</span> <span class="token function">udev_device_get_driver</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> prop_keyboard <span class="token operator">=</span> <span class="token function">udev_device_get_property_value</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"ID_INPUT_KEYBOARD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> prop_mouse <span class="token operator">=</span> <span class="token function">udev_device_get_property_value</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"ID_INPUT_MOUSE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Got device"</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - node: "</span> <span class="token operator">&lt;&lt;</span> devnode<span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - sysname: "</span> <span class="token operator">&lt;&lt;</span> sysname<span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - devpath: "</span> <span class="token operator">&lt;&lt;</span> devpath<span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - devtype: "</span> <span class="token operator">&lt;&lt;</span> devtype<span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - driver: "</span> <span class="token operator">&lt;&lt;</span> driver<span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - devnum: "</span> <span class="token operator">&lt;&lt;</span> devnum<span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - ID_INPUT_KEYBOARD: "</span> <span class="token operator">&lt;&lt;</span> prop_keyboard<span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - ID_INPUT_MOUSE: "</span> <span class="token operator">&lt;&lt;</span> prop_mouse<span class="token punctuation">;</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>prop_mouse<span class="token punctuation">)</span><span class="token punctuation">{</span>
			isMouse <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			isMouse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>devnode <span class="token operator">&&</span> <span class="token punctuation">(</span>prop_keyboard <span class="token operator">||</span> prop_mouse<span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token function">string_begins_with</span><span class="token punctuation">(</span>sysname<span class="token punctuation">,</span> <span class="token string">"event"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">addInput</span><span class="token punctuation">(</span>devnode<span class="token punctuation">,</span> isMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>prop_keyboard<span class="token punctuation">)</span><span class="token punctuation">{</span>
			keyboardDetected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>prop_mouse<span class="token punctuation">)</span><span class="token punctuation">{</span>
			mouseDetected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">udev_device_unref</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment" spellcheck="true">/* Free the enumerator object */</span>
	<span class="token function">udev_enumerate_unref</span><span class="token punctuation">(</span>enumerate<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>mouseDetected<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupNativeInput(): did not open mouse"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>keyboardDetected<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupKeyboard(): did not open keyboard"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// save current terminal settings</span>
	<span class="token function">tcgetattr</span> <span class="token punctuation">(</span>STDIN_FILENO<span class="token punctuation">,</span> <span class="token operator">&</span>tc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ots <span class="token operator">=</span> tc<span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">// disable echo on our temporary settings</span>
	tc<span class="token punctuation">.</span>c_lflag <span class="token operator">&</span><span class="token operator">=</span> <span class="token operator">~</span>ECHO<span class="token punctuation">;</span>
	tc<span class="token punctuation">.</span>c_lflag <span class="token operator">|</span><span class="token operator">=</span> ECHONL<span class="token punctuation">;</span>
	<span class="token function">tcsetattr</span><span class="token punctuation">(</span>STDIN_FILENO<span class="token punctuation">,</span> TCSAFLUSH<span class="token punctuation">,</span> <span class="token operator">&</span>tc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	kb<span class="token punctuation">.</span>shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	kb<span class="token punctuation">.</span>capsLocked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token function">printInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">addInput</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> node<span class="token punctuation">,</span> <span class="token keyword">bool</span> isMouse<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">removeInput</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> O_RDONLY <span class="token operator">|</span> O_NONBLOCK<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">char</span> deviceNameBuffer<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Unknown Device"</span><span class="token punctuation">;</span>
		<span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token function">EVIOCGNAME</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>deviceNameBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> deviceNameBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"addInput(): input device name = "</span> <span class="token operator">&lt;&lt;</span> deviceNameBuffer<span class="token punctuation">;</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>isMouse<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">struct</span> input_absinfo mabsx<span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token function">EVIOCGABS</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&</span>mabsx<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"ioctl GABS failed"</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				mouseAbsXMin <span class="token operator">=</span> mabsx<span class="token punctuation">.</span>minimum<span class="token punctuation">;</span>
				mouseAbsXMax <span class="token operator">=</span> mabsx<span class="token punctuation">.</span>maximum<span class="token punctuation">;</span>
				<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"mouse x axis min, max: "</span> <span class="token operator">&lt;&lt;</span> mouseAbsXMin <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> mouseAbsXMax<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment" spellcheck="true">// Do that for the y axis. EVIOCGABS(1): 1 stands for y axis.</span>
			<span class="token keyword">struct</span> input_absinfo mabsy<span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token function">EVIOCGABS</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&</span>mabsy<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"ioctl GABS failed"</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				mouseAbsYMin <span class="token operator">=</span> mabsy<span class="token punctuation">.</span>minimum<span class="token punctuation">;</span>
				mouseAbsYMax <span class="token operator">=</span> mabsy<span class="token punctuation">.</span>maximum<span class="token punctuation">;</span>
				<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"mouse y axis min, max: "</span> <span class="token operator">&lt;&lt;</span> mouseAbsYMin <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> mouseAbsYMax<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		inputDevices<span class="token punctuation">[</span>node<span class="token punctuation">]</span> <span class="token operator">=</span> fd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">removeInput</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> node<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

	device<span class="token operator">::</span>iterator iter <span class="token operator">=</span> inputDevices<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>iter <span class="token operator">!=</span> inputDevices<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">(</span>iter<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
		inputDevices<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">printInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"--- Input Device List ---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>device<span class="token operator">::</span>iterator iter <span class="token operator">=</span> inputDevices<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> inputDevices<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span> <span class="token operator">&lt;&lt;</span> iter<span class="token operator">-</span><span class="token operator">></span>first<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"-------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">destroyNativeInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"destroyNativeInput()"</span><span class="token punctuation">;</span>
	
	<span class="token keyword">for</span><span class="token punctuation">(</span>device<span class="token operator">::</span>iterator iter <span class="token operator">=</span> inputDevices<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> inputDevices<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>iter<span class="token operator">-</span><span class="token operator">></span>second <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">(</span>iter<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	inputDevices<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">tcsetattr</span> <span class="token punctuation">(</span>STDIN_FILENO<span class="token punctuation">,</span> TCSAFLUSH<span class="token punctuation">,</span> <span class="token operator">&</span>ots<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">processInput</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> node<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">// http://www.diegm.uniud.it/loghi/CE2/kbd.pdf</span>
	<span class="token comment" spellcheck="true">// http://cgit.freedesktop.org/~whot/evtest/plain/evtest.c</span>
	<span class="token comment" spellcheck="true">// https://strcpy.net/b/archives/2010/11/17/abusing_the_linux_input_subsystem/index.html</span>
	<span class="token keyword">static</span> ofKeyEventArgs keyEvent<span class="token punctuation">;</span>
	<span class="token keyword">static</span> ofMouseEventArgs mouseEvent<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> input_event ev<span class="token punctuation">;</span>
	<span class="token keyword">char</span> key <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">bool</span> pushKeyEvent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">bool</span> pushMouseEvent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">bool</span> axisValuePending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> nBytesRead <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&</span>ev<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> input_event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>nBytesRead <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">// ofLogNotice("Input event ") &lt;&lt; "dev: " &lt;&lt; node &lt;&lt; " ,type: " &lt;&lt; ev.type &lt;&lt; " ,code: " &lt;&lt; ev.code &lt;&lt; " ,value: " &lt;&lt; ev.value &lt;&lt; " ,pending: " &lt;&lt; axisValuePending;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_KEY<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>code <span class="token operator">==</span> BTN_LEFT<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// release</span>
					mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> OF_MOUSE_BUTTON_LEFT<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Released<span class="token punctuation">;</span>
					mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">&</span><span class="token operator">=</span> <span class="token operator">~</span>MOUSE_BUTTON_LEFT_MASK<span class="token punctuation">;</span>
					pushMouseEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// press</span>
					mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">|</span><span class="token operator">=</span> MOUSE_BUTTON_LEFT_MASK<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Pressed<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> OF_MOUSE_BUTTON_LEFT<span class="token punctuation">;</span>
					pushMouseEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>code <span class="token operator">==</span> BTN_MIDDLE<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// release</span>
					mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> OF_MOUSE_BUTTON_MIDDLE<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Released<span class="token punctuation">;</span>
					mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">&</span><span class="token operator">=</span> <span class="token operator">~</span>MOUSE_BUTTON_MIDDLE_MASK<span class="token punctuation">;</span>
					pushMouseEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// press</span>
					mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">|</span><span class="token operator">=</span> MOUSE_BUTTON_MIDDLE_MASK<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Pressed<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> OF_MOUSE_BUTTON_MIDDLE<span class="token punctuation">;</span>
					pushMouseEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>code <span class="token operator">==</span> BTN_RIGHT<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// release</span>
					mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> OF_MOUSE_BUTTON_RIGHT<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Released<span class="token punctuation">;</span>
					mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">&</span><span class="token operator">=</span> <span class="token operator">~</span>MOUSE_BUTTON_RIGHT_MASK<span class="token punctuation">;</span>
					pushMouseEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// press</span>
					mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">|</span><span class="token operator">=</span> MOUSE_BUTTON_RIGHT_MASK<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Pressed<span class="token punctuation">;</span>
					mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> OF_MOUSE_BUTTON_RIGHT<span class="token punctuation">;</span>
					pushMouseEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// key released</span>
					keyEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofKeyEventArgs<span class="token operator">::</span>Released<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// key pressed</span>
					keyEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofKeyEventArgs<span class="token operator">::</span>Pressed<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// key repeated</span>
					keyEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofKeyEventArgs<span class="token operator">::</span>Pressed<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// unknown ev.value</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">case</span> KEY_RIGHTSHIFT<span class="token operator">:</span>
					<span class="token keyword">case</span> KEY_LEFTSHIFT<span class="token operator">:</span>
						kb<span class="token punctuation">.</span>shiftPressed <span class="token operator">=</span> ev<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_RIGHTCTRL<span class="token operator">:</span>
					<span class="token keyword">case</span> KEY_LEFTCTRL<span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_CAPSLOCK<span class="token operator">:</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>kb<span class="token punctuation">.</span>capsLocked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								kb<span class="token punctuation">.</span>capsLocked <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
								kb<span class="token punctuation">.</span>capsLocked <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_ESC<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_ESC<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_BACKSPACE<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_BACKSPACE<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_DELETE<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_DEL<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F1<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F1<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F2<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F2<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F3<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F3<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F4<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F4<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F5<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F5<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F6<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F6<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F7<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F7<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F8<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F8<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F9<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F9<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F10<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F10<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F11<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F11<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_F12<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_F12<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_LEFT<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_LEFT<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_UP<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_UP<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_RIGHT<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_RIGHT<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_DOWN<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_DOWN<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_PAGEUP<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_PAGE_UP<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_PAGEDOWN<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_PAGE_DOWN<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_HOME<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_HOME<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_END<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_END<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_INSERT<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_INSERT<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> KEY_ENTER<span class="token operator">:</span>
					<span class="token keyword">case</span> KEY_KPENTER<span class="token operator">:</span>
						pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_RETURN<span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">default</span><span class="token operator">:</span>
						<span class="token comment" spellcheck="true">// VERY RUDIMENTARY KEY MAPPING WITH MAPS ABOVE</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>code <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>lowercase_map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>kb<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span><span class="token punctuation">{</span>
								key <span class="token operator">=</span> uppercase_map<span class="token punctuation">[</span>ev<span class="token punctuation">.</span>code<span class="token punctuation">]</span><span class="token punctuation">;</span>
								<span class="token keyword">if</span><span class="token punctuation">(</span>kb<span class="token punctuation">.</span>capsLocked<span class="token punctuation">)</span> keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token function">tolower</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
								keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
								pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
								key <span class="token operator">=</span> lowercase_map<span class="token punctuation">[</span>ev<span class="token punctuation">.</span>code<span class="token punctuation">]</span><span class="token punctuation">;</span>
								<span class="token keyword">if</span><span class="token punctuation">(</span>kb<span class="token punctuation">.</span>capsLocked<span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
								keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
								pushKeyEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
							<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"readKeyboardEvents(): input_event.code is outside of our small range"</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>	
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_REL <span class="token operator">||</span> ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_ABS<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">int</span> axis <span class="token operator">=</span> ev<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
			<span class="token keyword">int</span> amount <span class="token operator">=</span> ev<span class="token punctuation">.</span>value<span class="token punctuation">;</span>

			<span class="token keyword">switch</span><span class="token punctuation">(</span>axis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_REL<span class="token punctuation">)</span><span class="token punctuation">{</span>
						mouseEvent<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> amount <span class="token operator">*</span> mouseScaleX<span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
						mouseEvent<span class="token punctuation">.</span>x <span class="token operator">=</span> amount <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>currentWindowRect<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>mouseAbsXMax<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					mouseEvent<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">ofClamp</span><span class="token punctuation">(</span>mouseEvent<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> currentWindowRect<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
					axisValuePending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_REL<span class="token punctuation">)</span><span class="token punctuation">{</span>
						mouseEvent<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> amount <span class="token operator">*</span> mouseScaleY<span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
						mouseEvent<span class="token punctuation">.</span>y <span class="token operator">=</span> amount <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>currentWindowRect<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>mouseAbsYMax<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					mouseEvent<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">ofClamp</span><span class="token punctuation">(</span>mouseEvent<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> currentWindowRect<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
					axisValuePending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">default</span><span class="token operator">:</span>
					<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"readMouseEvents(): unknown mouse axis (perhaps it's the scroll wheel?)"</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_MSC<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_SYN<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment" spellcheck="true">// EV_SYN Used as markers to separate events. Events may be</span>
			<span class="token comment" spellcheck="true">// separated in time or in space, such as with the multitouch protocol.</span>

			<span class="token comment" spellcheck="true">// EV_SYN events are sent when axis value (one or a pair) are changed</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>axisValuePending<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment" spellcheck="true">// ofLog() &lt;&lt; "EV_SYN pending end : " &lt;&lt; iter->second;</span>
				<span class="token comment" spellcheck="true">// TODO, this state doesn't make as much sense when the mouse is not dragging</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>mb<span class="token punctuation">.</span>mouseButtonState <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// dragging (what if dragging w/ more than one button?)</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Dragged<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment" spellcheck="true">// just moving</span>
					mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Moved<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> mb<span class="token punctuation">.</span>mouseButtonState<span class="token punctuation">;</span>

				pushMouseEvent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				axisValuePending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment" spellcheck="true">//ofLogVerbose("ofAppEGLWindow") &lt;&lt; "readMouseEvents(): EV_SYN";</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>pushKeyEvent<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			keyEvents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>keyEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pushKeyEvent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>pushMouseEvent<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment" spellcheck="true">// lock the thread for a moment while we copy the data</span>
			<span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mouseEvents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>mouseEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pushMouseEvent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		nBytesRead <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&</span>ev<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> input_event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">readNativeUDevEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment" spellcheck="true">// look for devices being attatched / detatched</span>
	fd_set fds<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> timeval tv<span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> udev_device <span class="token operator">*</span>dev<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> is_mouse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token function">FD_ZERO</span><span class="token punctuation">(</span><span class="token operator">&</span>fds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">FD_SET</span><span class="token punctuation">(</span>udev_fd<span class="token punctuation">,</span> <span class="token operator">&</span>fds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	tv<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	tv<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	ret <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>udev_fd<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&</span>fds<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&</span>tv<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">/* Check if our file descriptor has received data. */</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&&</span> <span class="token function">FD_ISSET</span><span class="token punctuation">(</span>udev_fd<span class="token punctuation">,</span> <span class="token operator">&</span>fds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">/* Make the call to receive the device.
		   select() ensured that this will not block. */</span>
		dev <span class="token operator">=</span> <span class="token function">udev_monitor_receive_device</span><span class="token punctuation">(</span>mon<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> devnode <span class="token operator">=</span> <span class="token function">udev_device_get_devnode</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> devpath <span class="token operator">=</span> <span class="token function">udev_device_get_devpath</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> sysname <span class="token operator">=</span> <span class="token function">udev_device_get_sysname</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> subsystem <span class="token operator">=</span> <span class="token function">udev_device_get_subsystem</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> devtype <span class="token operator">=</span> <span class="token function">udev_device_get_devtype</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			dev_t devnum <span class="token operator">=</span> <span class="token function">udev_device_get_devnum</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> driver <span class="token operator">=</span> <span class="token function">udev_device_get_driver</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> action <span class="token operator">=</span> <span class="token function">udev_device_get_action</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> prop_keyboard <span class="token operator">=</span> <span class="token function">udev_device_get_property_value</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"ID_INPUT_KEYBOARD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> prop_mouse <span class="token operator">=</span> <span class="token function">udev_device_get_property_value</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"ID_INPUT_MOUSE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"readNativeUDevEvents"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"udev monitor receive devixe"</span><span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - node: "</span> <span class="token operator">&lt;&lt;</span> devnode<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - devpath: "</span> <span class="token operator">&lt;&lt;</span> devpath<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - sysname: "</span> <span class="token operator">&lt;&lt;</span> sysname<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - subsystem: "</span> <span class="token operator">&lt;&lt;</span> subsystem<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - devtype: "</span> <span class="token operator">&lt;&lt;</span> devtype<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - devnum: "</span> <span class="token operator">&lt;&lt;</span> devnum<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - driver: "</span> <span class="token operator">&lt;&lt;</span> driver<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - action: "</span> <span class="token operator">&lt;&lt;</span> action<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - ID_INPUT_KEYBOARD: "</span> <span class="token operator">&lt;&lt;</span> prop_keyboard<span class="token punctuation">;</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" - ID_INPUT_MOUSE: "</span> <span class="token operator">&lt;&lt;</span> prop_mouse<span class="token punctuation">;</span>

			<span class="token keyword">if</span><span class="token punctuation">(</span>prop_mouse<span class="token punctuation">)</span><span class="token punctuation">{</span>
				is_mouse <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>devnode <span class="token operator">&&</span> <span class="token punctuation">(</span>prop_keyboard <span class="token operator">||</span> prop_mouse<span class="token punctuation">)</span> <span class="token operator">&&</span> <span class="token function">string_begins_with</span><span class="token punctuation">(</span>sysname<span class="token punctuation">,</span> <span class="token string">"event"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token string">"add"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">addInput</span><span class="token punctuation">(</span>devnode<span class="token punctuation">,</span> is_mouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token string">"remove"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">removeInput</span><span class="token punctuation">(</span>devnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
			
			<span class="token function">udev_device_unref</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"readNativeUDevEvents(): device returned by receive_device() is NULL"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">readNativeInputEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>device<span class="token operator">::</span>iterator iter <span class="token operator">=</span> inputDevices<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> inputDevices<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">processInput</span><span class="token punctuation">(</span>iter<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">,</span> iter<span class="token operator">-</span><span class="token operator">></span>first<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">ifdef</span> TARGET_RASPBERRY_PI_LEGACY</span>
<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">initRPiNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">bcm_host_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&</span>dispman_native_window<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>EGL_DISPMANX_WINDOW_T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	dispman_element <span class="token operator">=</span> DISPMANX_NO_HANDLE<span class="token punctuation">;</span>
	dispman_display <span class="token operator">=</span> DISPMANX_NO_HANDLE<span class="token punctuation">;</span>
	dispman_update  <span class="token operator">=</span> DISPMANX_NO_HANDLE<span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&</span>dispman_clamp<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DISPMANX_CLAMP_T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	dispman_transform <span class="token operator">=</span> DISPMANX_NO_ROTATE<span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&</span>dispman_alpha<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>VC_DISPMANX_ALPHA_T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// zero dispman_alpha</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">exitRPiNative</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">bcm_host_deinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">createRPiNativeWindow</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofRectangle<span class="token operator">&</span> requestedWindowRect<span class="token punctuation">)</span><span class="token punctuation">{</span>

	ofRectangle screenRect <span class="token operator">=</span> <span class="token function">getScreenRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// make sure our requested window rectangle does not exceed the native</span>
	<span class="token comment" spellcheck="true">// screen size, or start outside of it.</span>
	ofRectangle windowRect <span class="token operator">=</span> screenRect<span class="token punctuation">.</span><span class="token function">getIntersection</span><span class="token punctuation">(</span>requestedWindowRect<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupRPiNativeWindow(): screenRect: "</span> <span class="token operator">&lt;&lt;</span> screenRect<span class="token punctuation">.</span>width <span class="token operator">&lt;&lt;</span> <span class="token string">"x"</span> <span class="token operator">&lt;&lt;</span> screenRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
	<span class="token function">ofLogNotice</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupRPiNativeWindow(): windowRect: "</span> <span class="token operator">&lt;&lt;</span> windowRect<span class="token punctuation">.</span>width <span class="token operator">&lt;&lt;</span> <span class="token string">"x"</span> <span class="token operator">&lt;&lt;</span> windowRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//////////////////////////</span>
	VC_RECT_T dst_rect<span class="token punctuation">;</span>

	dst_rect<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
	dst_rect<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
	dst_rect<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
	dst_rect<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

	VC_RECT_T src_rect<span class="token punctuation">;</span>

	src_rect<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	src_rect<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	src_rect<span class="token punctuation">.</span>width  <span class="token operator">=</span> dst_rect<span class="token punctuation">.</span>width <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span>
	src_rect<span class="token punctuation">.</span>height <span class="token operator">=</span> dst_rect<span class="token punctuation">.</span>height <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span>

	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&</span>dispman_alpha<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>VC_DISPMANX_ALPHA_T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// zero dispman_alpha</span>
	dispman_alpha<span class="token punctuation">.</span>flags <span class="token operator">=</span> DISPMANX_FLAGS_ALPHA_FIXED_ALL_PIXELS<span class="token punctuation">;</span>
	dispman_alpha<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token function">ofClamp</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>eglWindowOpacity<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	dispman_alpha<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&</span>dispman_clamp<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DISPMANX_CLAMP_T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// there are other values for dispman_transform, but they do not seem to have an effect</span>
	dispman_transform <span class="token operator">=</span> DISPMANX_NO_ROTATE<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// get the zero display</span>
	dispman_display <span class="token operator">=</span> <span class="token function">vc_dispmanx_display_open</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>screenNum<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// begin the display manager interaction</span>
	dispman_update  <span class="token operator">=</span> <span class="token function">vc_dispmanx_update_start</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// add a "display manager element" with our parameters so</span>
	<span class="token comment" spellcheck="true">// that it can fill in the structures.  we will pass this</span>
	<span class="token comment" spellcheck="true">// filled dispman_element to our native window, which will</span>
	<span class="token comment" spellcheck="true">// be used to construct the EGL surface, etc.</span>
	dispman_element <span class="token operator">=</span> <span class="token function">vc_dispmanx_element_add</span> <span class="token punctuation">(</span> dispman_update<span class="token punctuation">,</span>
			dispman_display<span class="token punctuation">,</span>
			settings<span class="token punctuation">.</span>layer<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// layer</span>
			<span class="token operator">&</span>dst_rect<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// dst rect</span>
			<span class="token punctuation">(</span>DISPMANX_RESOURCE_HANDLE_T<span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// src</span>
			<span class="token operator">&</span>src_rect<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// src rect</span>
			DISPMANX_PROTECTION_NONE<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// ?</span>
			<span class="token operator">&</span>dispman_alpha<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// alpha</span>
			<span class="token operator">&</span>dispman_clamp<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// clamp</span>
			dispman_transform <span class="token comment" spellcheck="true">// transform</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>dispman_element <span class="token operator">==</span> DISPMANX_NO_HANDLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupRPiNativeWindow(): dispman_element == DISPMANX_NO_HANDLE"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dispman_element <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span>DISPMANX_INVALID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"setupRPiNativeWindow(): dispman_element == DISPMANX_INVALID"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment" spellcheck="true">// set dispman_native_window to zero</span>
	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&</span>dispman_native_window<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>EGL_DISPMANX_WINDOW_T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	dispman_native_window<span class="token punctuation">.</span>element <span class="token operator">=</span> dispman_element<span class="token punctuation">;</span>
	dispman_native_window<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
	dispman_native_window<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>int32_t<span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// set background to black (not required)</span>
	<span class="token function">vc_dispmanx_display_set_background</span><span class="token punctuation">(</span>dispman_update<span class="token punctuation">,</span> dispman_display<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// finished with display manager update, so sync</span>
	<span class="token function">vc_dispmanx_update_submit_sync</span><span class="token punctuation">(</span> dispman_update <span class="token punctuation">)</span><span class="token punctuation">;</span>

	currentWindowRect <span class="token operator">=</span> windowRect<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token comment" spellcheck="true">// X11 BELOW</span>
<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">bool</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">createX11NativeWindow</span><span class="token punctuation">(</span><span class="token keyword">const</span> ofRectangle<span class="token operator">&</span> requestedWindowRect<span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token comment" spellcheck="true">// X11 variables</span>
	x11Window <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	x11Display <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	x11ScreenNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// TODO: settings.screenNum?</span>
	x11Screen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	XVisualInfo<span class="token operator">*</span> x11Visual <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// TODO does this need to be deleted?</span>
	Colormap x11Colormap <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">/*
	Step 0 - Create a NativeWindowType that we can use it for OpenGL ES output
	 */</span>
	Window sRootWindow<span class="token punctuation">;</span>
	XSetWindowAttributes sWA<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> ui32Mask<span class="token punctuation">;</span>
	<span class="token keyword">int</span> i32Depth<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//ofRectangle screenRect = getScreenRect();</span>

	<span class="token comment" spellcheck="true">// make sure our requested window rectangle does not exceed the native</span>
	<span class="token comment" spellcheck="true">// screen size, or start outside of it.</span>
	ofRectangle windowRect <span class="token operator">=</span> requestedWindowRect<span class="token punctuation">.</span><span class="token function">getStandardized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//screenRect.getIntersection(requestedWindowRect);</span>

	<span class="token comment" spellcheck="true">// Initializes the display and screen</span>
	x11Display <span class="token operator">=</span> <span class="token function">XOpenDisplay</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>x11Display<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"unable to open X display"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	x11ScreenNum <span class="token operator">=</span> <span class="token function">XDefaultScreen</span><span class="token punctuation">(</span> x11Display <span class="token punctuation">)</span><span class="token punctuation">;</span>

	x11Screen <span class="token operator">=</span> <span class="token function">XDefaultScreenOfDisplay</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// Gets the window parameters</span>
	sRootWindow <span class="token operator">=</span> <span class="token function">RootWindow</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span> x11ScreenNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
	i32Depth <span class="token operator">=</span> <span class="token function">DefaultDepth</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span> x11ScreenNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
	x11Visual <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">XVisualInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">XMatchVisualInfo</span><span class="token punctuation">(</span> x11Display<span class="token punctuation">,</span>
			x11ScreenNum<span class="token punctuation">,</span>
			i32Depth<span class="token punctuation">,</span>
			TrueColor<span class="token punctuation">,</span>
			x11Visual<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>x11Visual<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">ofLogError</span><span class="token punctuation">(</span><span class="token string">"ofAppEGLWindow"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"unable to acquire XVisualInfo"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	x11Colormap <span class="token operator">=</span> <span class="token function">XCreateColormap</span><span class="token punctuation">(</span> x11Display<span class="token punctuation">,</span> sRootWindow<span class="token punctuation">,</span> x11Visual<span class="token operator">-</span><span class="token operator">></span>visual<span class="token punctuation">,</span> AllocNone <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">delete</span> x11Visual<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// set the colormap window attribuet</span>
	sWA<span class="token punctuation">.</span>colormap <span class="token operator">=</span> x11Colormap<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// Add to these for handling other events</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">|</span><span class="token operator">=</span> StructureNotifyMask<span class="token punctuation">;</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">|</span><span class="token operator">=</span> ExposureMask<span class="token punctuation">;</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">|</span><span class="token operator">=</span> ButtonPressMask<span class="token punctuation">;</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">|</span><span class="token operator">=</span> ButtonReleaseMask<span class="token punctuation">;</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">|</span><span class="token operator">=</span> PointerMotionMask<span class="token punctuation">;</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">|</span><span class="token operator">=</span> KeyPressMask<span class="token punctuation">;</span>
	sWA<span class="token punctuation">.</span>event_mask <span class="token operator">|</span><span class="token operator">=</span> KeyReleaseMask<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// setup background pixel attributes</span>
	ui32Mask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	ui32Mask <span class="token operator">|</span><span class="token operator">=</span> CWBackPixel<span class="token punctuation">;</span>
	ui32Mask <span class="token operator">|</span><span class="token operator">=</span> CWBorderPixel<span class="token punctuation">;</span>
	ui32Mask <span class="token operator">|</span><span class="token operator">=</span> CWEventMask<span class="token punctuation">;</span>
	ui32Mask <span class="token operator">|</span><span class="token operator">=</span> CWColormap<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// Creates the X11 window</span>
	x11Window <span class="token operator">=</span> <span class="token function">XCreateWindow</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specifies the connection to the X server.</span>
			sRootWindow<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specifies the parent window.</span>
			<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specify the x and y coordinates,</span>
			<span class="token comment" spellcheck="true">// which are the top-left outside corner</span>
			<span class="token comment" spellcheck="true">// of the window's borders and are relative</span>
			<span class="token comment" spellcheck="true">// to the inside of the parent window's borders.</span>
			<span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>windowRect<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specify the width and height, which are the</span>
			<span class="token comment" spellcheck="true">// created window's inside dimensions and do</span>
			<span class="token comment" spellcheck="true">// not include the created window's borders.</span>
			<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specifies the width of the created</span>
			<span class="token comment" spellcheck="true">// window's border in pixels.</span>
			CopyFromParent<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specifies the window's depth.</span>
			<span class="token comment" spellcheck="true">// A depth of CopyFromParent means</span>
			<span class="token comment" spellcheck="true">// the depth is taken from the parent.</span>
			InputOutput<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specifies the created window's class.</span>
			<span class="token comment" spellcheck="true">// You can pass InputOutput, InputOnly,</span>
			<span class="token comment" spellcheck="true">// or CopyFromParent. A class of CopyFromParent</span>
			<span class="token comment" spellcheck="true">// means the class is taken from the parent.</span>
			CopyFromParent<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specifies the visual type.</span>
			<span class="token comment" spellcheck="true">// A visual of CopyFromParent means the visual type</span>
			<span class="token comment" spellcheck="true">// is taken from the parent.</span>
			ui32Mask<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// Specifies which window attributes are</span>
			<span class="token comment" spellcheck="true">// defined in the attributes argument. This mask is</span>
			<span class="token comment" spellcheck="true">// the bitwise inclusive OR of the valid attribute</span>
			<span class="token comment" spellcheck="true">// mask bits. If valuemask is zero, the attributes</span>
			<span class="token comment" spellcheck="true">// are ignored and are not referenced.</span>
			<span class="token operator">&</span>sWA <span class="token comment" spellcheck="true">//Specifies the background pixel value of the window.</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">XMapWindow</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">,</span> x11Window<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">XFlush</span><span class="token punctuation">(</span>x11Display<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">// check success?</span>
	currentWindowRect <span class="token operator">=</span> windowRect<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">static</span> KeySym <span class="token function">KeyCodeToKeySym</span><span class="token punctuation">(</span>Display <span class="token operator">*</span> display<span class="token punctuation">,</span> KeyCode keycode<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> event_mask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	KeySym keysym <span class="token operator">=</span> NoSymbol<span class="token punctuation">;</span>

	<span class="token comment" spellcheck="true">//Get the map</span>
	XkbDescPtr keyboard_map <span class="token operator">=</span> <span class="token function">XkbGetMap</span><span class="token punctuation">(</span>display<span class="token punctuation">,</span> XkbAllClientInfoMask<span class="token punctuation">,</span> XkbUseCoreKbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>keyboard_map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment" spellcheck="true">//What is diff between XkbKeyGroupInfo and XkbKeyNumGroups?</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span> info <span class="token operator">=</span> <span class="token function">XkbKeyGroupInfo</span><span class="token punctuation">(</span>keyboard_map<span class="token punctuation">,</span> keycode<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> num_groups <span class="token operator">=</span> <span class="token function">XkbKeyNumGroups</span><span class="token punctuation">(</span>keyboard_map<span class="token punctuation">,</span> keycode<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment" spellcheck="true">//Get the group</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> group <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token function">XkbOutOfRangeGroupAction</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> XkbRedirectIntoRange<span class="token operator">:</span>
			<span class="token comment" spellcheck="true">/* If the RedirectIntoRange flag is set, the four least significant
			 * bits of the groups wrap control specify the index of a group to
			 * which all illegal groups correspond. If the specified group is
			 * also out of range, all illegal groups map to Group1.
			 */</span>
			group <span class="token operator">=</span> <span class="token function">XkbOutOfRangeGroupInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>group <span class="token operator">>=</span> num_groups<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				group <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>

		<span class="token keyword">case</span> XkbClampIntoRange<span class="token operator">:</span>
			<span class="token comment" spellcheck="true">/* If the ClampIntoRange flag is set, out-of-range groups correspond
			 * to the nearest legal group. Effective groups larger than the
			 * highest supported group are mapped to the highest supported group;
			 * effective groups less than Group1 are mapped to Group1 . For
			 * example, a key with two groups of symbols uses Group2 type and
			 * symbols if the global effective group is either Group3 or Group4.
			 */</span>
			group <span class="token operator">=</span> num_groups <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>

		<span class="token keyword">case</span> XkbWrapIntoRange<span class="token operator">:</span>
			<span class="token comment" spellcheck="true">/* If neither flag is set, group is wrapped into range using integer
			 * modulus. For example, a key with two groups of symbols for which
			 * groups wrap uses Group1 symbols if the global effective group is
			 * Group3 or Group2 symbols if the global effective group is Group4.
			 */</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>num_groups <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				group <span class="token operator">%</span><span class="token operator">=</span> num_groups<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		XkbKeyTypePtr key_type <span class="token operator">=</span> <span class="token function">XkbKeyKeyType</span><span class="token punctuation">(</span>keyboard_map<span class="token punctuation">,</span> keycode<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> active_mods <span class="token operator">=</span> event_mask <span class="token operator">&</span> key_type<span class="token operator">-</span><span class="token operator">></span>mods<span class="token punctuation">.</span>mask<span class="token punctuation">;</span>

		<span class="token keyword">int</span> i<span class="token punctuation">,</span> level <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> key_type<span class="token operator">-</span><span class="token operator">></span>map_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>key_type<span class="token operator">-</span><span class="token operator">></span>map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>active <span class="token operator">&&</span> key_type<span class="token operator">-</span><span class="token operator">></span>map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>mods<span class="token punctuation">.</span>mask <span class="token operator">==</span> active_mods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				level <span class="token operator">=</span> key_type<span class="token operator">-</span><span class="token operator">></span>map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>level<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		keysym <span class="token operator">=</span> <span class="token function">XkbKeySymEntry</span><span class="token punctuation">(</span>keyboard_map<span class="token punctuation">,</span> keycode<span class="token punctuation">,</span> level<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">XkbFreeClientMap</span><span class="token punctuation">(</span>keyboard_map<span class="token punctuation">,</span> XkbAllClientInfoMask<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> keysym<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//------------------------------------------------------------</span>
<span class="token keyword">void</span> ofAppEGLWindow<span class="token operator">::</span><span class="token function">handleX11Event</span><span class="token punctuation">(</span><span class="token keyword">const</span> XEvent<span class="token operator">&</span> event<span class="token punctuation">)</span><span class="token punctuation">{</span>
	ofMouseEventArgs mouseEvent<span class="token punctuation">;</span>
	ofKeyEventArgs keyEvent<span class="token punctuation">;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">case</span> KeyPress<span class="token operator">:</span>
	<span class="token keyword">case</span> KeyRelease<span class="token operator">:</span>
	<span class="token punctuation">{</span>
		KeySym key <span class="token operator">=</span> <span class="token function">KeyCodeToKeySym</span><span class="token punctuation">(</span>instance<span class="token operator">-</span><span class="token operator">></span>x11Display<span class="token punctuation">,</span>event<span class="token punctuation">.</span>xkey<span class="token punctuation">.</span>keycode<span class="token punctuation">,</span>event<span class="token punctuation">.</span>xkey<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
		keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> KeyPress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			keyEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofKeyEventArgs<span class="token operator">::</span>Pressed<span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">65307</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				keyEvent<span class="token punctuation">.</span>key <span class="token operator">=</span> OF_KEY_ESC<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> KeyRelease<span class="token punctuation">)</span><span class="token punctuation">{</span>
			keyEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofKeyEventArgs<span class="token operator">::</span>Released<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		instance<span class="token operator">-</span><span class="token operator">></span>coreEvents<span class="token punctuation">.</span><span class="token function">notifyKeyEvent</span><span class="token punctuation">(</span>keyEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> ButtonPress<span class="token operator">:</span>
	<span class="token keyword">case</span> ButtonRelease<span class="token operator">:</span>
		mouseEvent<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>xbutton<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mouseEvent<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>xbutton<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> event<span class="token punctuation">.</span>xbutton<span class="token punctuation">.</span>button<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> ButtonPress<span class="token punctuation">)</span><span class="token punctuation">{</span>
			mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Pressed<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Released<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		instance<span class="token operator">-</span><span class="token operator">></span>coreEvents<span class="token punctuation">.</span><span class="token function">notifyMouseEvent</span><span class="token punctuation">(</span>mouseEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> MotionNotify<span class="token operator">:</span>
		<span class="token comment" spellcheck="true">//cout &lt;&lt; "motion notify" &lt;&lt; endl;</span>
		mouseEvent<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>xmotion<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mouseEvent<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">></span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>xmotion<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mouseEvent<span class="token punctuation">.</span>button <span class="token operator">=</span> event<span class="token punctuation">.</span>xbutton<span class="token punctuation">.</span>button<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ofGetMousePressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Dragged<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			mouseEvent<span class="token punctuation">.</span>type <span class="token operator">=</span> ofMouseEventArgs<span class="token operator">::</span>Moved<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		instance<span class="token operator">-</span><span class="token operator">></span>coreEvents<span class="token punctuation">.</span><span class="token function">notifyMouseEvent</span><span class="token punctuation">(</span>mouseEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> ConfigureNotify<span class="token operator">:</span>
		instance<span class="token operator">-</span><span class="token operator">></span>currentWindowRect<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span>xconfigure<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
		instance<span class="token operator">-</span><span class="token operator">></span>currentWindowRect<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span>xconfigure<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
		instance<span class="token operator">-</span><span class="token operator">></span>currentWindowRect<span class="token punctuation">.</span>width <span class="token operator">=</span> event<span class="token punctuation">.</span>xconfigure<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
		instance<span class="token operator">-</span><span class="token operator">></span>currentWindowRect<span class="token punctuation">.</span>height <span class="token operator">=</span> event<span class="token punctuation">.</span>xconfigure<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
		instance<span class="token operator">-</span><span class="token operator">></span>nonFullscreenWindowRect <span class="token operator">=</span> instance<span class="token operator">-</span><span class="token operator">></span>currentWindowRect<span class="token punctuation">;</span>
		instance<span class="token operator">-</span><span class="token operator">></span>coreEvents<span class="token punctuation">.</span><span class="token function">notifyWindowResized</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>xconfigure<span class="token punctuation">.</span>width<span class="token punctuation">,</span>event<span class="token punctuation">.</span>xconfigure<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token comment" spellcheck="true">/*case ClientMessage:{
		if (event.xclient.message_type == wmProtocols_ &&
		event.xclient.format == 32 &&
		event.xclient.data.l[0] == (long) wmDeleteWindow_)
		{
		if (listener())
		{
		  if (listener()->onClose(wrapper() ? *wrapper() : *(WindowInterface*)this))
			isShuttingDown_ = true;
		}
		else
		{
		  isShuttingDown_ = true;
		}
		}
		break;
	  }*/</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div></div></div></div></div></div><script defer src="/_nuxt/payloads/1583511283766/openframeworks/app/ofAppEGLWindow_cpp/payload.js"></script><script src="/_nuxt/76844c096ee4b2a8e8b3.js" defer></script><script src="/_nuxt/0128aba013e56fe5f14b.js" defer></script><script src="/_nuxt/561e36663ec83bdcd2ac.js" defer></script><script src="/_nuxt/26c5a70906ce7aaac460.js" defer></script><script src="/_nuxt/af3debaf278e0e1fd9de.js" defer></script>
  </body>
</html>
